package com.iota.iri;

import com.iota.iri.conf.MainnetConfig;
import com.iota.iri.crypto.Curl;
import com.iota.iri.crypto.ISS;
import com.iota.iri.crypto.SpongeFactory;
import com.iota.iri.model.Hash;
import com.iota.iri.model.TransactionHash;
import com.iota.iri.service.snapshot.SnapshotProvider;
import com.iota.iri.service.snapshot.impl.SnapshotProviderImpl;
import com.iota.iri.storage.Tangle;
import com.iota.iri.storage.rocksDB.RocksDBPersistenceProvider;
import com.iota.iri.utils.Converter;
import com.iota.iri.controllers.TransactionViewModel;
import org.junit.*;
import org.junit.rules.TemporaryFolder;

import java.util.*;
import java.util.stream.Collectors;

import static org.junit.Assert.*;

public class BundleValidatorTest {
    private static Tangle tangle = new Tangle();
    private static SnapshotProvider snapshotProvider;
    private static BundleValidator bundleValidator = new BundleValidator();

    @Before
    public void setUp() throws Exception {
        TemporaryFolder dbFolder = new TemporaryFolder();
        TemporaryFolder logFolder = new TemporaryFolder();
        dbFolder.create();
        logFolder.create();
        tangle.addPersistenceProvider(
                new RocksDBPersistenceProvider(dbFolder.getRoot().getAbsolutePath(),
                        logFolder.getRoot().getAbsolutePath(), 1000, Tangle.COLUMN_FAMILIES,
                        Tangle.METADATA_COLUMN_FAMILY));
        tangle.init();
        snapshotProvider = new SnapshotProviderImpl().init(new MainnetConfig());
    }

    @After
    public void tearDown() throws Exception {
        tangle.shutdown();
        snapshotProvider.shutdown();
    }

    private List<TransactionViewModel> persistAndMapTxs(String[] trytes) {
        return Arrays.stream(trytes)
                .map(Converter::allocatingTritsFromTrytes)
                .map(t -> new TransactionViewModel(t, TransactionHash.calculate(SpongeFactory.Mode.CURLP81, t)))
                .peek(t -> {
                    try {
                        t.store(tangle, snapshotProvider.getInitialSnapshot());
                    } catch (Exception e) {
                        e.printStackTrace();
                    }
                }).collect(Collectors.toList());
    }

    @Test
    public void checkInconsistencyOfInconsistentBundle() {
        // input transaction value changed to 123
        String[] trytes = {
                "999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999GNXKWQPHMFCEZZCKUCCD9PROQVPCTBVVAPHCLVOPYYQLQRMPGTQXBVZLKGGT9NXHUAASFIAVEOZTBSM9DA99999999999999999999999999RENGLE9BEAT9999999999999999FDKW9AD99999999999B99999999RJPQGE9AXNBBLPQ9IFJXFJTXJAIGDDXAWXGAVU9PJQNYFADJDIDBTJKSAEBBX9NWJGZVAVXYWXPCEFFH9DKZYSMJAQRLXZHCNPTJPJLOONNDZHGNTBIINGYKZQAAWF9LWQTHUQSAXMLQN9DKCQWHIJXNGLGQVA9999XIFVJWCABR9XQKOWCXJAZDZWMWWBVHROBOPISAWDIJTSFPVAUZNJUMNUCOFIBIAAVIOWDTCNIPRVA9999TANGLE9BEAT9999999999999999SVIDBWNOF999999999K99999999POWSRVIO9VMIJ99UGNETMNPNNNE",
                "YU9WINMHSBIJ9HRBKDEHZYOCDGOZ9HZSSVXAYYOD9AMAFBCROMLSFDFIAQKEXAVFDLJYVABRSONSTTXLCQJTSDRFDEXZIORLRSQDZQODNCHAAFUPGBCEVYNRSJQGUZRAQIIEZPFQGWPQIBMDVNZGQAKCU9VLHGYSNDPHCMOCTRYQOYHFPRQSGHSDEF9MSHGXYGUTHSBSF9SOSJQFOZXMQGCUXAYWLBJHXOHTOM9ITZPISEXLAYAZBHTZDDCOIHKDBL9AAXZEDFHDYCPXLDGR9JTVXDXBC9DRDVREEEVGVPWVEZHJBYQYTGDEWQHVEDTAVLWW9WBXOIGDGUAAAVKFMPVKSYBVOIWPYGCMACEAAHGUIQVFLFMSCPKTYQWJDGMDNLMDIUUYI9SZOFQPLKKACESSWIXPFYZWDHETYUGEVASPHBGQPJPWVESSUUEVUYDYNQUQURSMCEPKIHYXNFHZSHIIDTMEZQ9IPSHTBDK9UHRSIIEJRILBCMVUMGAGBMHKEMUUKQDCYAVIAN9MBWJCAUSSJRSAUEUBGEFFCFSOBVGLXBAIDOH9NXWQUSIFUINEVZUWELLVIOSSQRVHMTDBCATBWFSDJJDLURAUKEQEIRICSCXAOJNPWHQKYVTRLCRKHLFHHHPYSMUEAPMQPMPS9CHCIYXEYRNIOOGRWKVHUGIWJZIGPWGZGBGYTVC9UVEJ9JBIYMDHYXLWIDXHZVFCCPLYXDPQPJGMKNZMMONGNXSNNPCGEGRJTMCPTJONGPAEDMSHMGAPGBDWVCSCTJAECSHTEGBMVCDZMQYZ9IHERWGCKAIMFOJRAEDRDSWJASV9XYS9CTOEETPQHRKJZ9FPWTVCGLEJQJXVVDTYZ9DNSHQAINKROQQIPTFGTABEELYPBQHGNNB9NCL9BVTG9MH99BPIRNNGC9MQQRH9YUDYSUJIDSZKCIGEKFSJ9PXUYKVPUZYFIREUAMUZE9EIMJK9YGAZXZBPRXIRDCEVDHWOCFIJTVRCRZRRJGFLILKVNMJAX9MUMTXCWTUTP9NXBZUMAYYY9DNVZTCROBCMMHVKSQRXMGROCMMCDENWQWBV9LEIJONWTQXOUQZOTGEJHJELYZOPICLDWPHVCMBFSYHPIJYZQDEGYITVPYNQMXPRTPKADLUKW9AEMSMGIWCUMOQMUDN9HZGYKTNVVNLOQAFVETEDJMJVKYCE9RE9AJP9RMYFKGDEC9GIGAFXEXIYXPFBOMRPULVJMYTQEPDMMIABDHJGRNNCKADZAUFV9WCWFYFHXLCED9E9SKKYHVKDTGNCHEKFJL9YJHTSRUVKEPHPCQSFNBXKOJNGBSEOZLVVGNUQTRACVGEKDSORUHVSDSQNUZASWXRADGAUDYDPODDEDNDDT9OAEARSBLPVSYAOEYYZJIZIZDENQOKMXATCTD9NEFVQWNCET9N9IXWCCWHYUBDTDJUZFXWMATRYSGJUQAFKAPIQIIXVFFEFNLGDPAIGKONUWLUTQTKZJYDEGPASTOMM9QTGOMYHFUKMNEVWPCMTLPDSOEEWDBRHZPZJIFMBUTY9QPRLPSVURIRMCWLH9YIZBOTJQMMF9ZP9VCCEGWVKSSQNANP9ZXVCAFGAVBXDJHUMKTKUBZRNKUGJTVUPDZMUK9KZI9EKY9DQDUNA9ZVPCROKYYPISSTDOJZJXMXZWSGZBEPKAUYPBPUTDVQKUYXWYTZXLYTCLLKLJUUJGFFCMZFKDTJET9KEDRMWZSAEFCSXLMRHRLG9EKLRZJ9NZQEONGFQSKSQMWRZXWVEGHCF9ZKGQITDLGFTZLCQMXVGVYIPKSUPPAOIKVWARJHAEJUZOOJFCFJTGQZWROSCEQSITQWZTQDFKECATBWSIRDFVWH9TXXUVEBRRKOTFSGBMGCMZDK9BJRVEUYOVNSLZNNSTWOB9CFNDJHJENDWSTIMMSWD9HSA9LDGTJDJFRGQCWOHYJNMFFLLDMVQEMCMNVQWMOGCEZUTK9MPULTDMKTIVFNVWXDNTRHNREHEDWIZCCRFVM9TXCTLBLYEKTRVVWHKZDOSYOBNLEKPNXMDZGLSVBBNBJIBZYBXZCENKVIXMNGUJUYFGFYFBKELSBZROQWKMESZTWDEEUCSXOWFSNJUGGJANMJFCBJV9GMDDJCAJHWKYQFJLFWZESTSIRBZQWYHGQDFUUWF9F9HXSBZRKBDLRWXSMKW99KPWJOQYPMHB9KWALSVLFNANYSMNWSJLUOCBKAWAJHNWMLPLXHVEPTKBPWLWHMDOE9999999999999999999999999999999999999999999999999999FDKW9AD99A99999999B99999999RJPQGE9AXNBBLPQ9IFJXFJTXJAIGDDXAWXGAVU9PJQNYFADJDIDBTJKSAEBBX9NWJGZVAVXYWXPCEFFH99XJLIVAZYJGPKEHANESX9DORLEIOIFL9WVQBBNUDRZDGJMVSRTSFKOJPIMEXPBCPGKUUEKRGAXOB99999XIFVJWCABR9XQKOWCXJAZDZWMWWBVHROBOPISAWDIJTSFPVAUZNJUMNUCOFIBIAAVIOWDTCNIPRVA9999999999999999999999999999999RSIDBWNOF999999999K99999999POWSRVIO9VMIJ99FKKNKGPNNNNP",
                "COSNPEACSPESTKTUS9CSMOCWVUBLERQJQGLLA9AYRRXMOVOBULQZZZJPLNELEX9EVZDAFOHBB9FBAYOTDB9YGJAVTDWNPJVVGEPFJ9QBYLXAYZEETY9GMYQRIRAIPWMJUFMFRSQRCEIOWISMBJKGCIGIIYNMXAYLXZIBNKANT9DSQXPBUPWGUJTOMD9JKSNFZJJFBZYBWRWQIZFOZXQWNJTRZTUPHVEGTAOLMBEPXOB9TCEBNIWXQUHNQJZHAOWGVOOOTSCTEUEMXJUODZP9CDLCMEXAW9YJGVNREENETEYXOAKZVRJVUSCRUSRCNZUGUOLCNHQITWYPJVJGPVULASTONDZRDVCNGJSN9DMMUORCOIBTITSPBXSAVTOHSAXHMGH99APRTQIVCEI9NWYKDOZCCWBNZGGCUCISSMGJHJ9OVSFBZVFMBODKRKSLIDESGFDQITCYFARWYTLFKSPLNVQ9LTYFODCHBAJKCWVZNBLOJH9ABFGDFOXHDNHZILINMYMVZYWTFJJOLADPTZRPJEMGPFQNYTFDGOKMDTDSKPTHIDWLMRSSACZMTHUCWVZHCYSPJRATABZ9JHWEBGTTQORGFOYDWUIYFYGOGGTYGYYI9RPKPMCTYNYKHHNWQKJTDQDHTRUYQPMCDDLVUUHUBPWGPMNQYPKHDHGIUSXJGNUXIYGZRGVYPTTV9KXJDLGVVXRIWIGKZJVCQ9DUWAYNDRKYCGKZDEOKZQCXELSQXLGLAPBDIWRTKGSIRNAZ9XFEGMWOWLPUA9TSGYRDOU9GKY9JJDKCJKKGJCRARGSNECJ9SEVAGPPJMBTMGNWSLNSFBOEYMIQBKOVSCTDIWCOQTHBVTZOFNNIYKKJLAROKIRFFPCLSOWO9BVNNJSXEYLJASPUEFKCEI9SGWADNGS9MZAKFTCAYNRVKGDIGYDTPGJXWFAEFGG9BX9XCNBZGQULH9IPPIQ9VFVAXGELUMCTE9TOFOGCTFYBYEBFOKKAESIIHEWLYLQKWDHPYNELJKMZHDSDSK9ZWFP99FQFLUXGTSVDMGHIFZFUCYTYPVEFEDM9TOHCQVIBXARYWZEKTWEOVSBYZTJZRUFZJCLRBTOWPTKY99CYQTGPMAKFYALIWPEQLUB9RGANTKDDMSDSJOTNPFZCXKJUGTJWWPK9FAJGPJOEBRHL9ZU9XRBDJBVMFIZIZFGKETH9RJUSDIOWDZIXFOJLT9DSIAWSCEYBNOGOAZQPZKVZTBXGACCBVQGFNGXNQFTVPUGUOHNBKTUERLSTDXGRKZSATIRHDBSXARYATBHOLUHCQGPRMQGSJUAXUCWKDXAUGORHFVVVDZQEYYGSV9IUM9VTMHJCIKBQD9TQLLYTZHAKDHPFGYMRGJOEDJKQTBBNFCKDEPYTPWUJEOPRJWHAILMVW9AXS9HAT9GCGRXZEHWNDOVGKGPWFXFC9IKLVZJCTGZUJFRHGL9FZWZYP9TPOWGOUTQ9INYBVTD9N9OV9AM9GYRJ99MRWRWLOAKJXMDTFNS9NZQAYGVZRJ9WVSIDRRQLGKH9VPUVKFWZMSRVVLKXUGJAZESC9LEYDNNDWS9WTWNFPCR9YKPOMIJAVHCRCJVBDFWSTDN9BPJRDMGZFXWTY9GUX9WEPJQMXSECFPREXAJ9DU9OLMNQFTF99QYZOGDUTMBHMNMCNUQTU9FTNEUNBT9NQO9YADGY9C9LQR9DYVJZE9GMMYAOUSWUIVJ9EAR9EEFCO9SZTQ9JQHPIJGXIOQZHOSUSVMHBOLTYSEONVLRISNAN9KJHHFFISTYIHYVAMXLPNALDELETXVSWGUWOIVKNAKZKNNRVNJKE9WMNQBXFGXSYZQQSIODAKINA9CPBOGAYKJ9V9GS9HERXSVYPEILYXC9GURBREBCXRZJVXHUOPGYFLPIFBCOTMHFTAAUQUZVEKOWYFFGSCXDFDBTSGZRMPQR9EYSZYGQETCWFDRXVOXXCUBOQTBQGVLAONSTSLURFYSDPAVNCXNWVPQOUORMVSLYISQUQKXFYYMJSGHQP9VAAZABEAGJMCPIEBZQSYCPS9CNKFBDRDTDA9C9MVKGUISRX9ODVUJNPDWMZ9ESYXJ99ETDGSTJZMZYJEGRUWTORMCLNHLDQ9YIJWPMDYGGJQHMFPJ9VKINJUESTCBJQXFTCJFNUXPZONVKXJRAYGKIWHXSBZRKBDLRWXSMKW99KPWJOQYPMHB9KWALSVLFNANYSMNWSJLUOCBKAWAJHNWMLPLXHVEPTKBPWLWHMD999999999999999999999999999999999999999999999999999999FDKW9AD99B99999999B99999999RJPQGE9AXNBBLPQ9IFJXFJTXJAIGDDXAWXGAVU9PJQNYFADJDIDBTJKSAEBBX9NWJGZVAVXYWXPCEFFH9XIFVJWCABR9XQKOWCXJAZDZWMWWBVHROBOPISAWDIJTSFPVAUZNJUMNUCOFIBIAAVIOWDTCNIPRVA9999FTXZAEQIKGFJABOGCCQGOMKNASGWCQWMNIMRDTHKPJMTKDGMEQNZOAYARIYEWFZYJALRKFODOITTZ9999999999999999999999999999999LLHDBWNOF999999999K99999999POWSRVIO9VMIJ99UMGMTTTPNNNV",
        };
        List<TransactionViewModel> transactions = persistAndMapTxs(trytes);
        assertTrue("should be true as bundle is inconsistent", BundleValidator.isInconsistent(transactions));
    }

    @Test
    public void checkInconsistencyOfConsistentBundle() {
        String[] trytes = {
                "999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999GNXKWQPHMFCEZZCKUCCD9PROQVPCTBVVAPHCLVOPYYQLQRMPGTQXBVZLKGGT9NXHUAASFIAVEOZTBSM9DA99999999999999999999999999RENGLE9BEAT9999999999999999FDKW9AD99999999999B99999999RJPQGE9AXNBBLPQ9IFJXFJTXJAIGDDXAWXGAVU9PJQNYFADJDIDBTJKSAEBBX9NWJGZVAVXYWXPCEFFH9DKZYSMJAQRLXZHCNPTJPJLOONNDZHGNTBIINGYKZQAAWF9LWQTHUQSAXMLQN9DKCQWHIJXNGLGQVA9999XIFVJWCABR9XQKOWCXJAZDZWMWWBVHROBOPISAWDIJTSFPVAUZNJUMNUCOFIBIAAVIOWDTCNIPRVA9999TANGLE9BEAT9999999999999999SVIDBWNOF999999999K99999999POWSRVIO9VMIJ99UGNETMNPNNNE",
                "YU9WINMHSBIJ9HRBKDEHZYOCDGOZ9HZSSVXAYYOD9AMAFBCROMLSFDFIAQKEXAVFDLJYVABRSONSTTXLCQJTSDRFDEXZIORLRSQDZQODNCHAAFUPGBCEVYNRSJQGUZRAQIIEZPFQGWPQIBMDVNZGQAKCU9VLHGYSNDPHCMOCTRYQOYHFPRQSGHSDEF9MSHGXYGUTHSBSF9SOSJQFOZXMQGCUXAYWLBJHXOHTOM9ITZPISEXLAYAZBHTZDDCOIHKDBL9AAXZEDFHDYCPXLDGR9JTVXDXBC9DRDVREEEVGVPWVEZHJBYQYTGDEWQHVEDTAVLWW9WBXOIGDGUAAAVKFMPVKSYBVOIWPYGCMACEAAHGUIQVFLFMSCPKTYQWJDGMDNLMDIUUYI9SZOFQPLKKACESSWIXPFYZWDHETYUGEVASPHBGQPJPWVESSUUEVUYDYNQUQURSMCEPKIHYXNFHZSHIIDTMEZQ9IPSHTBDK9UHRSIIEJRILBCMVUMGAGBMHKEMUUKQDCYAVIAN9MBWJCAUSSJRSAUEUBGEFFCFSOBVGLXBAIDOH9NXWQUSIFUINEVZUWELLVIOSSQRVHMTDBCATBWFSDJJDLURAUKEQEIRICSCXAOJNPWHQKYVTRLCRKHLFHHHPYSMUEAPMQPMPS9CHCIYXEYRNIOOGRWKVHUGIWJZIGPWGZGBGYTVC9UVEJ9JBIYMDHYXLWIDXHZVFCCPLYXDPQPJGMKNZMMONGNXSNNPCGEGRJTMCPTJONGPAEDMSHMGAPGBDWVCSCTJAECSHTEGBMVCDZMQYZ9IHERWGCKAIMFOJRAEDRDSWJASV9XYS9CTOEETPQHRKJZ9FPWTVCGLEJQJXVVDTYZ9DNSHQAINKROQQIPTFGTABEELYPBQHGNNB9NCL9BVTG9MH99BPIRNNGC9MQQRH9YUDYSUJIDSZKCIGEKFSJ9PXUYKVPUZYFIREUAMUZE9EIMJK9YGAZXZBPRXIRDCEVDHWOCFIJTVRCRZRRJGFLILKVNMJAX9MUMTXCWTUTP9NXBZUMAYYY9DNVZTCROBCMMHVKSQRXMGROCMMCDENWQWBV9LEIJONWTQXOUQZOTGEJHJELYZOPICLDWPHVCMBFSYHPIJYZQDEGYITVPYNQMXPRTPKADLUKW9AEMSMGIWCUMOQMUDN9HZGYKTNVVNLOQAFVETEDJMJVKYCE9RE9AJP9RMYFKGDEC9GIGAFXEXIYXPFBOMRPULVJMYTQEPDMMIABDHJGRNNCKADZAUFV9WCWFYFHXLCED9E9SKKYHVKDTGNCHEKFJL9YJHTSRUVKEPHPCQSFNBXKOJNGBSEOZLVVGNUQTRACVGEKDSORUHVSDSQNUZASWXRADGAUDYDPODDEDNDDT9OAEARSBLPVSYAOEYYZJIZIZDENQOKMXATCTD9NEFVQWNCET9N9IXWCCWHYUBDTDJUZFXWMATRYSGJUQAFKAPIQIIXVFFEFNLGDPAIGKONUWLUTQTKZJYDEGPASTOMM9QTGOMYHFUKMNEVWPCMTLPDSOEEWDBRHZPZJIFMBUTY9QPRLPSVURIRMCWLH9YIZBOTJQMMF9ZP9VCCEGWVKSSQNANP9ZXVCAFGAVBXDJHUMKTKUBZRNKUGJTVUPDZMUK9KZI9EKY9DQDUNA9ZVPCROKYYPISSTDOJZJXMXZWSGZBEPKAUYPBPUTDVQKUYXWYTZXLYTCLLKLJUUJGFFCMZFKDTJET9KEDRMWZSAEFCSXLMRHRLG9EKLRZJ9NZQEONGFQSKSQMWRZXWVEGHCF9ZKGQITDLGFTZLCQMXVGVYIPKSUPPAOIKVWARJHAEJUZOOJFCFJTGQZWROSCEQSITQWZTQDFKECATBWSIRDFVWH9TXXUVEBRRKOTFSGBMGCMZDK9BJRVEUYOVNSLZNNSTWOB9CFNDJHJENDWSTIMMSWD9HSA9LDGTJDJFRGQCWOHYJNMFFLLDMVQEMCMNVQWMOGCEZUTK9MPULTDMKTIVFNVWXDNTRHNREHEDWIZCCRFVM9TXCTLBLYEKTRVVWHKZDOSYOBNLEKPNXMDZGLSVBBNBJIBZYBXZCENKVIXMNGUJUYFGFYFBKELSBZROQWKMESZTWDEEUCSXOWFSNJUGGJANMJFCBJV9GMDDJCAJHWKYQFJLFWZESTSIRBZQWYHGQDFUUWF9F9HXSBZRKBDLRWXSMKW99KPWJOQYPMHB9KWALSVLFNANYSMNWSJLUOCBKAWAJHNWMLPLXHVEPTKBPWLWHMDZ99999999999999999999999999999999999999999999999999999FDKW9AD99A99999999B99999999RJPQGE9AXNBBLPQ9IFJXFJTXJAIGDDXAWXGAVU9PJQNYFADJDIDBTJKSAEBBX9NWJGZVAVXYWXPCEFFH99XJLIVAZYJGPKEHANESX9DORLEIOIFL9WVQBBNUDRZDGJMVSRTSFKOJPIMEXPBCPGKUUEKRGAXOB99999XIFVJWCABR9XQKOWCXJAZDZWMWWBVHROBOPISAWDIJTSFPVAUZNJUMNUCOFIBIAAVIOWDTCNIPRVA9999999999999999999999999999999RSIDBWNOF999999999K99999999POWSRVIO9VMIJ99FKKNKGPNNNNP",
                "COSNPEACSPESTKTUS9CSMOCWVUBLERQJQGLLA9AYRRXMOVOBULQZZZJPLNELEX9EVZDAFOHBB9FBAYOTDB9YGJAVTDWNPJVVGEPFJ9QBYLXAYZEETY9GMYQRIRAIPWMJUFMFRSQRCEIOWISMBJKGCIGIIYNMXAYLXZIBNKANT9DSQXPBUPWGUJTOMD9JKSNFZJJFBZYBWRWQIZFOZXQWNJTRZTUPHVEGTAOLMBEPXOB9TCEBNIWXQUHNQJZHAOWGVOOOTSCTEUEMXJUODZP9CDLCMEXAW9YJGVNREENETEYXOAKZVRJVUSCRUSRCNZUGUOLCNHQITWYPJVJGPVULASTONDZRDVCNGJSN9DMMUORCOIBTITSPBXSAVTOHSAXHMGH99APRTQIVCEI9NWYKDOZCCWBNZGGCUCISSMGJHJ9OVSFBZVFMBODKRKSLIDESGFDQITCYFARWYTLFKSPLNVQ9LTYFODCHBAJKCWVZNBLOJH9ABFGDFOXHDNHZILINMYMVZYWTFJJOLADPTZRPJEMGPFQNYTFDGOKMDTDSKPTHIDWLMRSSACZMTHUCWVZHCYSPJRATABZ9JHWEBGTTQORGFOYDWUIYFYGOGGTYGYYI9RPKPMCTYNYKHHNWQKJTDQDHTRUYQPMCDDLVUUHUBPWGPMNQYPKHDHGIUSXJGNUXIYGZRGVYPTTV9KXJDLGVVXRIWIGKZJVCQ9DUWAYNDRKYCGKZDEOKZQCXELSQXLGLAPBDIWRTKGSIRNAZ9XFEGMWOWLPUA9TSGYRDOU9GKY9JJDKCJKKGJCRARGSNECJ9SEVAGPPJMBTMGNWSLNSFBOEYMIQBKOVSCTDIWCOQTHBVTZOFNNIYKKJLAROKIRFFPCLSOWO9BVNNJSXEYLJASPUEFKCEI9SGWADNGS9MZAKFTCAYNRVKGDIGYDTPGJXWFAEFGG9BX9XCNBZGQULH9IPPIQ9VFVAXGELUMCTE9TOFOGCTFYBYEBFOKKAESIIHEWLYLQKWDHPYNELJKMZHDSDSK9ZWFP99FQFLUXGTSVDMGHIFZFUCYTYPVEFEDM9TOHCQVIBXARYWZEKTWEOVSBYZTJZRUFZJCLRBTOWPTKY99CYQTGPMAKFYALIWPEQLUB9RGANTKDDMSDSJOTNPFZCXKJUGTJWWPK9FAJGPJOEBRHL9ZU9XRBDJBVMFIZIZFGKETH9RJUSDIOWDZIXFOJLT9DSIAWSCEYBNOGOAZQPZKVZTBXGACCBVQGFNGXNQFTVPUGUOHNBKTUERLSTDXGRKZSATIRHDBSXARYATBHOLUHCQGPRMQGSJUAXUCWKDXAUGORHFVVVDZQEYYGSV9IUM9VTMHJCIKBQD9TQLLYTZHAKDHPFGYMRGJOEDJKQTBBNFCKDEPYTPWUJEOPRJWHAILMVW9AXS9HAT9GCGRXZEHWNDOVGKGPWFXFC9IKLVZJCTGZUJFRHGL9FZWZYP9TPOWGOUTQ9INYBVTD9N9OV9AM9GYRJ99MRWRWLOAKJXMDTFNS9NZQAYGVZRJ9WVSIDRRQLGKH9VPUVKFWZMSRVVLKXUGJAZESC9LEYDNNDWS9WTWNFPCR9YKPOMIJAVHCRCJVBDFWSTDN9BPJRDMGZFXWTY9GUX9WEPJQMXSECFPREXAJ9DU9OLMNQFTF99QYZOGDUTMBHMNMCNUQTU9FTNEUNBT9NQO9YADGY9C9LQR9DYVJZE9GMMYAOUSWUIVJ9EAR9EEFCO9SZTQ9JQHPIJGXIOQZHOSUSVMHBOLTYSEONVLRISNAN9KJHHFFISTYIHYVAMXLPNALDELETXVSWGUWOIVKNAKZKNNRVNJKE9WMNQBXFGXSYZQQSIODAKINA9CPBOGAYKJ9V9GS9HERXSVYPEILYXC9GURBREBCXRZJVXHUOPGYFLPIFBCOTMHFTAAUQUZVEKOWYFFGSCXDFDBTSGZRMPQR9EYSZYGQETCWFDRXVOXXCUBOQTBQGVLAONSTSLURFYSDPAVNCXNWVPQOUORMVSLYISQUQKXFYYMJSGHQP9VAAZABEAGJMCPIEBZQSYCPS9CNKFBDRDTDA9C9MVKGUISRX9ODVUJNPDWMZ9ESYXJ99ETDGSTJZMZYJEGRUWTORMCLNHLDQ9YIJWPMDYGGJQHMFPJ9VKINJUESTCBJQXFTCJFNUXPZONVKXJRAYGKIWHXSBZRKBDLRWXSMKW99KPWJOQYPMHB9KWALSVLFNANYSMNWSJLUOCBKAWAJHNWMLPLXHVEPTKBPWLWHMD999999999999999999999999999999999999999999999999999999FDKW9AD99B99999999B99999999RJPQGE9AXNBBLPQ9IFJXFJTXJAIGDDXAWXGAVU9PJQNYFADJDIDBTJKSAEBBX9NWJGZVAVXYWXPCEFFH9XIFVJWCABR9XQKOWCXJAZDZWMWWBVHROBOPISAWDIJTSFPVAUZNJUMNUCOFIBIAAVIOWDTCNIPRVA9999FTXZAEQIKGFJABOGCCQGOMKNASGWCQWMNIMRDTHKPJMTKDGMEQNZOAYARIYEWFZYJALRKFODOITTZ9999999999999999999999999999999LLHDBWNOF999999999K99999999POWSRVIO9VMIJ99UMGMTTTPNNNV",
        };
        List<TransactionViewModel> transactions = persistAndMapTxs(trytes);
        assertFalse("should be false because bundle is consistent", BundleValidator.isInconsistent(transactions));
    }

    @Test
    public void validateValidBundle() throws Exception {
        String[] trytes = {
                "999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999GNXKWQPHMFCEZZCKUCCD9PROQVPCTBVVAPHCLVOPYYQLQRMPGTQXBVZLKGGT9NXHUAASFIAVEOZTBSM9DA99999999999999999999999999RENGLE9BEAT9999999999999999FDKW9AD99999999999B99999999RJPQGE9AXNBBLPQ9IFJXFJTXJAIGDDXAWXGAVU9PJQNYFADJDIDBTJKSAEBBX9NWJGZVAVXYWXPCEFFH9DKZYSMJAQRLXZHCNPTJPJLOONNDZHGNTBIINGYKZQAAWF9LWQTHUQSAXMLQN9DKCQWHIJXNGLGQVA9999XIFVJWCABR9XQKOWCXJAZDZWMWWBVHROBOPISAWDIJTSFPVAUZNJUMNUCOFIBIAAVIOWDTCNIPRVA9999TANGLE9BEAT9999999999999999SVIDBWNOF999999999K99999999POWSRVIO9VMIJ99UGNETMNPNNNE",
                "YU9WINMHSBIJ9HRBKDEHZYOCDGOZ9HZSSVXAYYOD9AMAFBCROMLSFDFIAQKEXAVFDLJYVABRSONSTTXLCQJTSDRFDEXZIORLRSQDZQODNCHAAFUPGBCEVYNRSJQGUZRAQIIEZPFQGWPQIBMDVNZGQAKCU9VLHGYSNDPHCMOCTRYQOYHFPRQSGHSDEF9MSHGXYGUTHSBSF9SOSJQFOZXMQGCUXAYWLBJHXOHTOM9ITZPISEXLAYAZBHTZDDCOIHKDBL9AAXZEDFHDYCPXLDGR9JTVXDXBC9DRDVREEEVGVPWVEZHJBYQYTGDEWQHVEDTAVLWW9WBXOIGDGUAAAVKFMPVKSYBVOIWPYGCMACEAAHGUIQVFLFMSCPKTYQWJDGMDNLMDIUUYI9SZOFQPLKKACESSWIXPFYZWDHETYUGEVASPHBGQPJPWVESSUUEVUYDYNQUQURSMCEPKIHYXNFHZSHIIDTMEZQ9IPSHTBDK9UHRSIIEJRILBCMVUMGAGBMHKEMUUKQDCYAVIAN9MBWJCAUSSJRSAUEUBGEFFCFSOBVGLXBAIDOH9NXWQUSIFUINEVZUWELLVIOSSQRVHMTDBCATBWFSDJJDLURAUKEQEIRICSCXAOJNPWHQKYVTRLCRKHLFHHHPYSMUEAPMQPMPS9CHCIYXEYRNIOOGRWKVHUGIWJZIGPWGZGBGYTVC9UVEJ9JBIYMDHYXLWIDXHZVFCCPLYXDPQPJGMKNZMMONGNXSNNPCGEGRJTMCPTJONGPAEDMSHMGAPGBDWVCSCTJAECSHTEGBMVCDZMQYZ9IHERWGCKAIMFOJRAEDRDSWJASV9XYS9CTOEETPQHRKJZ9FPWTVCGLEJQJXVVDTYZ9DNSHQAINKROQQIPTFGTABEELYPBQHGNNB9NCL9BVTG9MH99BPIRNNGC9MQQRH9YUDYSUJIDSZKCIGEKFSJ9PXUYKVPUZYFIREUAMUZE9EIMJK9YGAZXZBPRXIRDCEVDHWOCFIJTVRCRZRRJGFLILKVNMJAX9MUMTXCWTUTP9NXBZUMAYYY9DNVZTCROBCMMHVKSQRXMGROCMMCDENWQWBV9LEIJONWTQXOUQZOTGEJHJELYZOPICLDWPHVCMBFSYHPIJYZQDEGYITVPYNQMXPRTPKADLUKW9AEMSMGIWCUMOQMUDN9HZGYKTNVVNLOQAFVETEDJMJVKYCE9RE9AJP9RMYFKGDEC9GIGAFXEXIYXPFBOMRPULVJMYTQEPDMMIABDHJGRNNCKADZAUFV9WCWFYFHXLCED9E9SKKYHVKDTGNCHEKFJL9YJHTSRUVKEPHPCQSFNBXKOJNGBSEOZLVVGNUQTRACVGEKDSORUHVSDSQNUZASWXRADGAUDYDPODDEDNDDT9OAEARSBLPVSYAOEYYZJIZIZDENQOKMXATCTD9NEFVQWNCET9N9IXWCCWHYUBDTDJUZFXWMATRYSGJUQAFKAPIQIIXVFFEFNLGDPAIGKONUWLUTQTKZJYDEGPASTOMM9QTGOMYHFUKMNEVWPCMTLPDSOEEWDBRHZPZJIFMBUTY9QPRLPSVURIRMCWLH9YIZBOTJQMMF9ZP9VCCEGWVKSSQNANP9ZXVCAFGAVBXDJHUMKTKUBZRNKUGJTVUPDZMUK9KZI9EKY9DQDUNA9ZVPCROKYYPISSTDOJZJXMXZWSGZBEPKAUYPBPUTDVQKUYXWYTZXLYTCLLKLJUUJGFFCMZFKDTJET9KEDRMWZSAEFCSXLMRHRLG9EKLRZJ9NZQEONGFQSKSQMWRZXWVEGHCF9ZKGQITDLGFTZLCQMXVGVYIPKSUPPAOIKVWARJHAEJUZOOJFCFJTGQZWROSCEQSITQWZTQDFKECATBWSIRDFVWH9TXXUVEBRRKOTFSGBMGCMZDK9BJRVEUYOVNSLZNNSTWOB9CFNDJHJENDWSTIMMSWD9HSA9LDGTJDJFRGQCWOHYJNMFFLLDMVQEMCMNVQWMOGCEZUTK9MPULTDMKTIVFNVWXDNTRHNREHEDWIZCCRFVM9TXCTLBLYEKTRVVWHKZDOSYOBNLEKPNXMDZGLSVBBNBJIBZYBXZCENKVIXMNGUJUYFGFYFBKELSBZROQWKMESZTWDEEUCSXOWFSNJUGGJANMJFCBJV9GMDDJCAJHWKYQFJLFWZESTSIRBZQWYHGQDFUUWF9F9HXSBZRKBDLRWXSMKW99KPWJOQYPMHB9KWALSVLFNANYSMNWSJLUOCBKAWAJHNWMLPLXHVEPTKBPWLWHMDZ99999999999999999999999999999999999999999999999999999FDKW9AD99A99999999B99999999RJPQGE9AXNBBLPQ9IFJXFJTXJAIGDDXAWXGAVU9PJQNYFADJDIDBTJKSAEBBX9NWJGZVAVXYWXPCEFFH99XJLIVAZYJGPKEHANESX9DORLEIOIFL9WVQBBNUDRZDGJMVSRTSFKOJPIMEXPBCPGKUUEKRGAXOB99999XIFVJWCABR9XQKOWCXJAZDZWMWWBVHROBOPISAWDIJTSFPVAUZNJUMNUCOFIBIAAVIOWDTCNIPRVA9999999999999999999999999999999RSIDBWNOF999999999K99999999POWSRVIO9VMIJ99FKKNKGPNNNNP",
                "COSNPEACSPESTKTUS9CSMOCWVUBLERQJQGLLA9AYRRXMOVOBULQZZZJPLNELEX9EVZDAFOHBB9FBAYOTDB9YGJAVTDWNPJVVGEPFJ9QBYLXAYZEETY9GMYQRIRAIPWMJUFMFRSQRCEIOWISMBJKGCIGIIYNMXAYLXZIBNKANT9DSQXPBUPWGUJTOMD9JKSNFZJJFBZYBWRWQIZFOZXQWNJTRZTUPHVEGTAOLMBEPXOB9TCEBNIWXQUHNQJZHAOWGVOOOTSCTEUEMXJUODZP9CDLCMEXAW9YJGVNREENETEYXOAKZVRJVUSCRUSRCNZUGUOLCNHQITWYPJVJGPVULASTONDZRDVCNGJSN9DMMUORCOIBTITSPBXSAVTOHSAXHMGH99APRTQIVCEI9NWYKDOZCCWBNZGGCUCISSMGJHJ9OVSFBZVFMBODKRKSLIDESGFDQITCYFARWYTLFKSPLNVQ9LTYFODCHBAJKCWVZNBLOJH9ABFGDFOXHDNHZILINMYMVZYWTFJJOLADPTZRPJEMGPFQNYTFDGOKMDTDSKPTHIDWLMRSSACZMTHUCWVZHCYSPJRATABZ9JHWEBGTTQORGFOYDWUIYFYGOGGTYGYYI9RPKPMCTYNYKHHNWQKJTDQDHTRUYQPMCDDLVUUHUBPWGPMNQYPKHDHGIUSXJGNUXIYGZRGVYPTTV9KXJDLGVVXRIWIGKZJVCQ9DUWAYNDRKYCGKZDEOKZQCXELSQXLGLAPBDIWRTKGSIRNAZ9XFEGMWOWLPUA9TSGYRDOU9GKY9JJDKCJKKGJCRARGSNECJ9SEVAGPPJMBTMGNWSLNSFBOEYMIQBKOVSCTDIWCOQTHBVTZOFNNIYKKJLAROKIRFFPCLSOWO9BVNNJSXEYLJASPUEFKCEI9SGWADNGS9MZAKFTCAYNRVKGDIGYDTPGJXWFAEFGG9BX9XCNBZGQULH9IPPIQ9VFVAXGELUMCTE9TOFOGCTFYBYEBFOKKAESIIHEWLYLQKWDHPYNELJKMZHDSDSK9ZWFP99FQFLUXGTSVDMGHIFZFUCYTYPVEFEDM9TOHCQVIBXARYWZEKTWEOVSBYZTJZRUFZJCLRBTOWPTKY99CYQTGPMAKFYALIWPEQLUB9RGANTKDDMSDSJOTNPFZCXKJUGTJWWPK9FAJGPJOEBRHL9ZU9XRBDJBVMFIZIZFGKETH9RJUSDIOWDZIXFOJLT9DSIAWSCEYBNOGOAZQPZKVZTBXGACCBVQGFNGXNQFTVPUGUOHNBKTUERLSTDXGRKZSATIRHDBSXARYATBHOLUHCQGPRMQGSJUAXUCWKDXAUGORHFVVVDZQEYYGSV9IUM9VTMHJCIKBQD9TQLLYTZHAKDHPFGYMRGJOEDJKQTBBNFCKDEPYTPWUJEOPRJWHAILMVW9AXS9HAT9GCGRXZEHWNDOVGKGPWFXFC9IKLVZJCTGZUJFRHGL9FZWZYP9TPOWGOUTQ9INYBVTD9N9OV9AM9GYRJ99MRWRWLOAKJXMDTFNS9NZQAYGVZRJ9WVSIDRRQLGKH9VPUVKFWZMSRVVLKXUGJAZESC9LEYDNNDWS9WTWNFPCR9YKPOMIJAVHCRCJVBDFWSTDN9BPJRDMGZFXWTY9GUX9WEPJQMXSECFPREXAJ9DU9OLMNQFTF99QYZOGDUTMBHMNMCNUQTU9FTNEUNBT9NQO9YADGY9C9LQR9DYVJZE9GMMYAOUSWUIVJ9EAR9EEFCO9SZTQ9JQHPIJGXIOQZHOSUSVMHBOLTYSEONVLRISNAN9KJHHFFISTYIHYVAMXLPNALDELETXVSWGUWOIVKNAKZKNNRVNJKE9WMNQBXFGXSYZQQSIODAKINA9CPBOGAYKJ9V9GS9HERXSVYPEILYXC9GURBREBCXRZJVXHUOPGYFLPIFBCOTMHFTAAUQUZVEKOWYFFGSCXDFDBTSGZRMPQR9EYSZYGQETCWFDRXVOXXCUBOQTBQGVLAONSTSLURFYSDPAVNCXNWVPQOUORMVSLYISQUQKXFYYMJSGHQP9VAAZABEAGJMCPIEBZQSYCPS9CNKFBDRDTDA9C9MVKGUISRX9ODVUJNPDWMZ9ESYXJ99ETDGSTJZMZYJEGRUWTORMCLNHLDQ9YIJWPMDYGGJQHMFPJ9VKINJUESTCBJQXFTCJFNUXPZONVKXJRAYGKIWHXSBZRKBDLRWXSMKW99KPWJOQYPMHB9KWALSVLFNANYSMNWSJLUOCBKAWAJHNWMLPLXHVEPTKBPWLWHMD999999999999999999999999999999999999999999999999999999FDKW9AD99B99999999B99999999RJPQGE9AXNBBLPQ9IFJXFJTXJAIGDDXAWXGAVU9PJQNYFADJDIDBTJKSAEBBX9NWJGZVAVXYWXPCEFFH9XIFVJWCABR9XQKOWCXJAZDZWMWWBVHROBOPISAWDIJTSFPVAUZNJUMNUCOFIBIAAVIOWDTCNIPRVA9999FTXZAEQIKGFJABOGCCQGOMKNASGWCQWMNIMRDTHKPJMTKDGMEQNZOAYARIYEWFZYJALRKFODOITTZ9999999999999999999999999999999LLHDBWNOF999999999K99999999POWSRVIO9VMIJ99UMGMTTTPNNNV",
        };
        List<TransactionViewModel> transactions = persistAndMapTxs(trytes);
        List<TransactionViewModel> bundleTxs = bundleValidator.validate(tangle, snapshotProvider.getInitialSnapshot(),
                transactions.get(0).getHash());
        assertFalse("all txs from the valid bundle should be returned", bundleTxs.isEmpty());
        assertEquals("should have changed the validity of the tail tx to valid", 1,
                bundleTxs.get(0).getValidity());
    }

    @Test
    public void validateBiggerValidBundle() throws Exception {
        String[] trytes = {
                "BYTES9IO9MILESTONE9FOUR9999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999MGLOFJZHGVVJIWO9QPFUCVOVGUSZCVBGAXPBGJBBAUOMEAZYANMULKVRJ9D9LTXMZNZUPKOFLBOWCTMWDREIVAMPJ9999999999999999999QH99999999999999999999999999DULM9D99999999999H99999999BJVQHAHPDFGNEELCFLIEXWWKZXLPUZQMDXFGKKOGPDEGJDALESJZFVKIIRJSGKXDNWJOQBRIUEBTGACG9FUVNZIPUCUFYQTSCOBXOCVX9LPGZZYNGEIAPZKNLRIYLGR9AYZUJZXQMEEYDLMDJTRYQBEXZBTAHZ9999ABQONKFWTKFCSKMUPVGPRNYIZTWETHIUNG9MFYKXLZRJHDUVIDBAL9QVDU9B9DHTYPMMDBCEFTLRA9999QH9999999999999999999999999YQWARLVNF999999999MMMMMMMMMNCSTBBIYBOFDUIJYHSGAQYKIKSJ",
                "GREEN9IOTA9MILESTONE9ONE999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999IWDNLCKONBLEVIKAZNTWQJIKTVPTCJEPMTHJAFYSTGNTSRGWZRAVSFSSEMRJBLZXQQTHYDHTRGWHQAQXXFCRFSGVA99999999999999999999999999999999999999999999999DULM9D99A99999999H99999999BJVQHAHPDFGNEELCFLIEXWWKZXLPUZQMDXFGKKOGPDEGJDALESJZFVKIIRJSGKXDNWJOQBRIUEBTGACG99OVSHXGIGQILJBEXTGFPIHBFHZJBSHBQWDPTPLXXIERIOMKODEE9SLLPGPBCGRQFFPHGZU99DBTTA9999ABQONKFWTKFCSKMUPVGPRNYIZTWETHIUNG9MFYKXLZRJHDUVIDBAL9QVDU9B9DHTYPMMDBCEFTLRA9999999999999999999999999999999YVNARLVNF999999999MMMMMMMMMQOUCQLOLWFNBCAKXUJKWCKPHUNC",
                "CRYPTO9CORE9MILESTONE9FOUR9999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999QNLVNDCDQJTXQIWLOWFOVRHFMAEX9XUS9PEQJTEONIVYCHXYU9ZPIPVZGBVARAPRNII9UIWKNNUCLH9JAHHCQLMPC99999999999999999999999999999999999999999999999DULM9D99B99999999H99999999BJVQHAHPDFGNEELCFLIEXWWKZXLPUZQMDXFGKKOGPDEGJDALESJZFVKIIRJSGKXDNWJOQBRIUEBTGACG9MVXJKYCRJMGPVBAGVUMTNPAFNTWHKQCFDDKAHZBCWA9JIQOS9TYQCXFVVQDERHQ9TSVUCTWUYDWZ99999ABQONKFWTKFCSKMUPVGPRNYIZTWETHIUNG9MFYKXLZRJHDUVIDBAL9QVDU9B9DHTYPMMDBCEFTLRA9999999999999999999999999999999UYC9RLVNF999999999MMMMMMMMMZURSVUBYKASKBNRVXEXBIYIYKYV",
                "UNIO9CYCLUX9MILESTONE9ONE99999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999XDGJPNYMWBG9OENADBPMTWLEHLAHMDSEABARKJDYGWAXQKFCLQRKBJJPKJNTBVK9TLGHF9NGWDDWDHCOZJIMAWDXF99999999999999999999999999999999999999999999999DULM9D99C99999999H99999999BJVQHAHPDFGNEELCFLIEXWWKZXLPUZQMDXFGKKOGPDEGJDALESJZFVKIIRJSGKXDNWJOQBRIUEBTGACG9LCVWYIOLVPTCTY9MF9NE99ALRHGDBJNNUJPBHUNQYJUCQCCKXGQCKRFFXTOXXJZHOCXRPUTFCSQS99999ABQONKFWTKFCSKMUPVGPRNYIZTWETHIUNG9MFYKXLZRJHDUVIDBAL9QVDU9B9DHTYPMMDBCEFTLRA9999999999999999999999999999999IBR9RLVNF999999999MMMMMMMMMQGLJPBWI9MMLVX9BFDFZLXNZWNT",
                "UNIO9MAXIMILIAN9MILESTONE9ONE9999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999GNFKTFVHZIYKSIRCVHATQ9MCGTTMURKQCRIBUXGOC9GIA9IHJAXAGOCERUOEOADNQBEOIETPHOKEGNSABDIBQRKDD99999999999999999999999999999999999999999999999DULM9D99D99999999H99999999BJVQHAHPDFGNEELCFLIEXWWKZXLPUZQMDXFGKKOGPDEGJDALESJZFVKIIRJSGKXDNWJOQBRIUEBTGACG9SGXBOFBKLNEGCOUQPJCDPOSYEXO9LHJVDVOOIUKAQIVBGLZQIFFBSZNRCBTFHHXAGESVLTITTXHQZ9999ABQONKFWTKFCSKMUPVGPRNYIZTWETHIUNG9MFYKXLZRJHDUVIDBAL9QVDU9B9DHTYPMMDBCEFTLRA9999999999999999999999999999999TWJZRLVNF999999999MMMMMMMMMCNSKCRQQNFNIOUDOLKMOZAJJIV9",
                "UNIO9LUNFARDO9MILESTONE9ONE999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999QUBTWTFCOKKCFJPQWTAZKZU9ABNIJLHTLJOHWQVGQHBQPCZXMPRRXZHFUOPOQCIKDGEDKOTCUVOHAFZKZRUUEHNXC99999999999999999999999999999999999999999999999DULM9D99E99999999H99999999BJVQHAHPDFGNEELCFLIEXWWKZXLPUZQMDXFGKKOGPDEGJDALESJZFVKIIRJSGKXDNWJOQBRIUEBTGACG9OMOBATWEWNMOJEBNTBXCLBOCFZXPM9TYGXEXYSR9MWRULXGNYBVFSBQGMAKBJDZNAXUOZKWDNBGYZ9999ABQONKFWTKFCSKMUPVGPRNYIZTWETHIUNG9MFYKXLZRJHDUVIDBAL9QVDU9B9DHTYPMMDBCEFTLRA9999999999999999999999999999999NJAZRLVNF999999999MMMMMMMMMFYGYRTZXPAEEADAPXNRFOIAGWKI",
                "MMVKAE9FJGAGLHZNOPZMQ9AKUUFDPXPRURVTYDNE9WYBCJVBQUVWRFKWJXCNQTHHUYUTCXYMIKAVMPNTDCPPJESPVHSKBKIKT99YACLJXVBJOTKUDGJXSOYPNHNUOJSDPDALPCCJFSUGPKJD9SNNAMYZVJGCPBVQ9XKUZWGCPTFIGBTDBFCLGDJCJLB9ZHGFPQWRRPSFEOMTEPGGKXKDXDLMKXBERPDDLXKWLS9RBXMO9OZRNAACVOMQEMIUWOZBVZMTFYSSAOL9PAEHVYWXUBMCGQQZSONIQDVZMQWRKDDQO9H9VHCRVIMFYLKKCLYXDIYASCNVVHPZBXFTQZKIMQDUMTHTDWBOPNANCEKZ9UYIFFJXVCXSMJRCLEHVHKLWTGYQFV9MKUKZHUUGSI9ECIWZG9RVYXATOOLHBJEIELLBPGQTAWHVIFGOMCRMKZRAJL9OGPQVDUQZREFNKM9BVTKNWXGSWSMIXMIBJZFKLFJQXNDQK9WQS9BGXCZFMZRXEBRQPXDCOOCESUOZHIZGFOKJNNDJPSNVII9FPDJGJXXTPDVK9RBJKXBDWHPRURQHIYKTOOWJLURKDJEXJGEJCONMXKQTNDFH99IAHTHFREYACWLEBHIBRYOFUWCBNRSAEBKHSDK9PXIKQMIKGUYVTWETELKQOHLWTERSOXUHERPP9QPHWOKTQOIOOVQLEPCEXDDJJEOMBKYYGWSTXULOROJUWRV9IFSWXMWXJJNIPXPHT9HLCRFHQONWCXHRPTXZSJGKKOJUVEQGLUNL9IZMOOSVHDBFOVGXIRPQUVR9VBOSRJITRGOFGNXROUTCUSJVLIFWE9TWQISIIKWIFU9BTCIRPLOAVGRKDNKWTTOOWYWJSHIXQKHZHDHUYTZ9JYPEZKJJQNYE9MDRTDQWDOJAJIRETMQQBKQKZJHL9JHAMNSOHNLUNVCXYPWEXMMHYNDILYJPBVXLCH9WPCZEGGNNWFDJQIXWBKJMVVVEXZ9QYZECA9OJMJSCDBAZUCNSVZAQ9QAZPEKBSOPMBTZUQOFVVTDRHRQLWXAFYHUPNNEMAWBPTWAZRODRWMXNNSWJVFAOFKRYZWPZBIOLKCDQVCPOSXHJV9CFH99DMJEWSQZQCGDJSXJZCTRMGKSAUERLABMSYKYQCQMFUOGRFNMQYTB9MWFHCIREOOCEUYWFKULDLQUWWOK9KICTJTNRMRAZ9VBYFYUTNAJVHDJRTVUHTGAAOA9IMKMFGGQTPFPDTBJEMOLJFKBKXNTQYJRBZOTU9VYHWQBOMBFUNZQXSSLBHRQCTHDPPOUVXVRCEMUVHGSNILKCGGVPJEVBERMENLHDIMBVQJESVEUIMZUMWBQTSODWHGOTBXOAMFWG9EATCXFUFTMDYDSMSTGMYSNAKXSAKXS9ATMRXOQMCXKPYU9KAIWJHLUWRWPZGXODZUWUIVGOMPCYYEDQOXPQTFNOYHDYTB9EADTPVMLCZKNGIWGNETKZYWOPRPQ9VPWB9F9RHNIAKGMBUWEVVGZRPCAFLGSERIPZSIDLLHWMZNJPTLIII9RPZ9NWAYLZDOKIKGVGEY9QGZMQTNJWPQ9JHMYHZOJVDARAUSIJITOGEVYADWDUSQWXYDWNZXDQZIMBLQWYDTFTIKEZPBDL9FDYGZFQZBWPGTYQSX9FQQDWNUCPKBGDDEN9ZPPMTZBSVG9JTLOECBONJUGTXSWKKERCQFQLTQOWGXFRAMHZIVEQDPTVXXSPABYGPHQAMWAUEDVQEUOYINFUTYYCCMHUUWIWTWRKBEJSJXZQQJTZHFMHZHYQLX9YPSZHPZ99VZAAZY9BBVZSUKHDSSSPYGKNPVGUHWL9YIRLCVRUTIWODDDISRQMAHC9TUMRNAPZOUFEKRNUKZAMFMFEEMDFGAEDBUXQFGZSJ9IFWZJAWKJVMHRMFIEZI9ROANK9PSQXXGR9SYDFQ9IUJIBZSCXHTAEVXMRSVJJYWSG9YJWFCDTVWNONBDQPQRAGIGTIYOKXIXAOOFHNRUUMAOAFDU9WUHXOTVPRPVPUS9HJMPVWOIRMGOMINADOMABMAQ9LI9QKOJCHDURDPIPTOHRAPKDGCBZELDFFRUWIDCHWLUMHMCQXNNATKFNMTWXDJFVPUBQ9YUHPQDZJNRARG9KLWNIB9GXSOVLNTASCXODMESDOCVACOHGNEQXFXBTWBFGHTQJAWDORTBCJYE9G9LSFELUIILEESSERWLUAXNBLRGTXHZFHMMEGASWCECCODFBNNJC9WKG9BPKVABN9KX99999999999999999999999999999999999999999999ZEULM9D99F99999999H99999999BJVQHAHPDFGNEELCFLIEXWWKZXLPUZQMDXFGKKOGPDEGJDALESJZFVKIIRJSGKXDNWJOQBRIUEBTGACG9HPFGHSHBORRAORIIKVPLFHWHXYMZZPLYWFOSSDRDTOZGDUBDBMXTTAQAJ9BZRPURJUORJKDDUWOEZ9999ABQONKFWTKFCSKMUPVGPRNYIZTWETHIUNG9MFYKXLZRJHDUVIDBAL9QVDU9B9DHTYPMMDBCEFTLRA9999999999999999999999999999999QRAZRLVNF999999999MMMMMMMMMPRAQU9KOBJERWZHEWOFXMFORMRX",
                "QLLGAJRIPGQLYBXNEGCUCMXLKGIMSXETYTUSLIS9XYTWXCLKJMYFTHRXTUCZUSS9UNOJRVESVRNRTYUPZRQCLNLNTUHWYLRTCE9LMSWOERWCCWJMOQFJBDADQFZYOWGDDUINUVSOG9XFAHFWGRWMMFVKRIGPHKPZNCILRKLIDRQBZSXTLBXNBISEAZ9JB9UCARIYBPMYWZGGNDTWHQJUXXTBDBKVNYEVUNMOAEEOCWODCXDHVUXHNIYYAFOYVFOKGXLWNMXENKPOBYHRNOYMMBMYOOUYGNQAGXXCZPYYEYKE9RJTZCYKOSDJINCGVCVBTIUWLERVECPKGZGTEALJIQCIMOMGFTBAFRHNBHNATRIZJNCRMONNWGIK9QYTLFQOVCEDTNWPLIYPTEUQGACPXVYOWKEYANSAQOZOJS9NB9BPFJJ9HQJWWQISNDGXYDWOX9EXOOXTPEOET9FWBU9STXQWONCMDKJZSQY99XBAHOWXIBNAAGWGGXGX9OUJHIKZLDJNBVWUNIHSGQE9IDMZVHDRYKUWXRWNFKJLYMOPUIXAPYXDQBMVYDWGXDGLYANSQFEAKDCB9QWMPRC9URCIOJPYUBZFGTBJKUBLDF9TGEPQCPMU9U9MTKREH9INRLDAIDJYWTODIYHRYCXWNHKVOPTRSTVYQTSIECHXMRBXEKBTM9IHHTPOITDKZJKLBVMIKQENRYAKWYTJLDEGDTRNXUWPXZIFXWBFZ9KRDNQEXNWONISTBHUVLCFMYZVOSSXQPLLXOMIQDAB9BGNHICBNIJ9GMPVTGT9CMNQKUHLUVWRDQUUJSZKPT9HIITMUTWMIXGDPTUXSATCQMQCRFXLGMSIWRHGGHOERFHBGNZDJQBDHANEILGVCHWBQHOYBXPSSZ9GUTHELXUBBHWC9JPFWJQZJJXLQFIUMLKKPLFTJEPHCYGOECQDYVYKRHLQAEKIHCZTDQIIBLZ99MNDSXLKXMTLSMOGD9SKKYSDFTDMPTHIAKHTBJXQJJPFDABGBMD9JTXDNBQYPTDOE9RZ9WLD9WDDNWMYDZYWAQAM9PYXSQGCPKCIWLSGKISHGJ9TPAXJVOPFVLPVEQ9YYHLWWQXQUOHOFLXQNMJWWVAPFR9FIZEHTOBPZPSKYOWSREPH9CXLEEVFCPGMDYYOEJUFADPMCQGQNDSEBONQRQYXZKDYIXCXBUUYAHLYKANCARTUVSLWSGJBPROCAFBBZWHRIBVVNQMUCONOPPEVXNENSCWOYYXJYWWIDBLHDIBQSGH9XUFBKHZEOXYEAMKPWNRZ9ZASASRQQEEEUGVZBNJVEJLQJEDUMDYYPNNILLVJBYIHWKVJUOQVCBINPUMTOPONBXZGBSOTAK9GVATSSAQPZJFBNOYHWFVXCHEFHPIVQPWEWSIBYWBFNNDWTFKWJS9S9NXBA9IVYRWGGGCK9VRZLLXYSZTQKZMENOACLIUWFZDOHRMKWHS9WFMLMFCGJGZVXWEFZWSYKEYCNBCU9QTMTJOEJXTFDFSFOMKCFNPVSWHVGIPJVQPWAPHXVELPRJMOTVRJOPUNAPWBGIQEOWPXXOLJNBYICVVNMDFZAAXDUOOYJDNVJJMAKCGSYKJQB9SMUIOBXGMFTZTHAPISGEKRKROEENVROTJMTWVCWWNSV9B9WLCQASMSKCOMMXPBTFV9ZNSFIZUDVYHU9PKOJEBOSABQATXBYNJFLBDDKOSRYOEDMYROSAEVJJTZFPLI9LIBGTJQYXOMRVOXX99QQREYTN9LGTYI9GDI9DQRTCC9THBMJSJSPBGFYKNZBUGI99MEZLNVJRJRIHLDBMWQYFTXKDTETRPVQVHZUTYNQCLIJVWCGSK9VSMWPTIWUCACBZGHQLAXRQGMKAWDQATGHYDVHRWEGECJCBUZYTX9FV9SXVM9BEGUGNHTPCQUIRQYKMKDSNVEGJ9CDDDEYSJJSKBTMWYVUTMBWPGORZSQNHNYVHBGHQWDAXVILELXIFQWCDVAKUEQSPLCZFPUDBUCTTYXAHOMFWCZCEKTDDKTIDUUZSEDJKDVZRHGLLZCTLRFEE9TPSFPELRCSGAHIW9MTLLYJGDJSZHVWFAEETQHPEORKSXZVYPXZRAKLXFSOLSQMTVECTLVGE9MYWFSSUBPVJJBBEKACVPJNGUVQFT9PZSXBPBNPR9NAQUKWKPIFSPYFXBTWBFGHTQJAWDORTBCJYE9G9LSFELUIILEESSERWLUAXNBLRGTXHZFHMMEGASWCECCODFBNNJC9WKG9999999999999999999999999999999999999999999999999999999ZEULM9D99G99999999H99999999BJVQHAHPDFGNEELCFLIEXWWKZXLPUZQMDXFGKKOGPDEGJDALESJZFVKIIRJSGKXDNWJOQBRIUEBTGACG9ICQWKRZNLRACDFVCFHJPHRQ99XCSLOB9QSOPYRDZNKYZBXPQCNRDPYPMZWZLSJZPJWZFQABXS9YVZ9999ABQONKFWTKFCSKMUPVGPRNYIZTWETHIUNG9MFYKXLZRJHDUVIDBAL9QVDU9B9DHTYPMMDBCEFTLRA9999999999999999999999999999999RBQZRLVNF999999999MMMMMMMMMPVOGGTPWW9AQFIDNYXKYZRNPOUD",
                "999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999G9EQ9IARCEMSKSMKYWKHUCGSXMGCT9LAAIHBWIWNIYWFTSGJRHSLXGXQNXKHJOXNMWQHPYMKOKSRL9TDDOJCQ9QNBOC999999999999999999999999999999999999999999999EULM9D99H99999999H99999999BJVQHAHPDFGNEELCFLIEXWWKZXLPUZQMDXFGKKOGPDEGJDALESJZFVKIIRJSGKXDNWJOQBRIUEBTGACG9ABQONKFWTKFCSKMUPVGPRNYIZTWETHIUNG9MFYKXLZRJHDUVIDBAL9QVDU9B9DHTYPMMDBCEFTLRA9999RNEQYL9XYIWHGTEQHZAPXZPWRRXOGXPJXHCV9OSTYLL9AVTMEXKG9HPIPKITPXQGEWIJIXVIEUNS99999999999999999999999999999999GBMYRLVNF999999999MMMMMMMMMAYSMPUWFG9OTFD9YMETBNVGMLRA",
        };
        List<TransactionViewModel> transactions = persistAndMapTxs(trytes);
        List<TransactionViewModel> bundleTxs = bundleValidator.validate(tangle, snapshotProvider.getInitialSnapshot(),
                transactions.get(0).getHash());
        assertFalse("all txs from the valid bundle should be returned", bundleTxs.isEmpty());
        assertEquals("should have changed the validity of the tail tx to valid", 1,
                bundleTxs.get(0).getValidity());
    }

    @Test
    public void validateBundleWithInvalidSignature() throws Exception {
        // first input tx's signature's first part has no 9s (replaced with As)
        String[] trytes = {
                "999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999NSA999999999999999999999999XB9999999999999999999999999VKUIAAD99999999999C99999999DIODRCKI9IUWGBTDTILEUVUPLHEMQZAYKWIULYHGPKVYSGCI9ANDOOBQTXAXIHGSVOLLXOKTRCHZFDHIZYTYMYJULDLBXVSAK9ROSUEEDKM9ZPJZRYBIDC9QJOGHXJTKAJJXTFNCUFDPCNSQFWOMLM9NWKMRTZ9999NRBM9KWMOYBKSGKVDTVOXQSDJUTIIPVIAOMOYWFXLOFVP9OP9TBCDTJXZNYZQBALCPJCDKWKQQARZ9999999999999999999999999999999MOTRCWPOF999999999K99999999FQB9999999IGXC9999999999999",
                "KGCWXSNUPEAVGPNCFQLKKTCVRHHRNQUKNGDJWOAQCKPXYXTUWHYJKOMLKLPPAGLAJZVNHNEXKEXIAJBQADVKOXESKAAIMDEEKNNSPRRCKTHDEVWVELOJNBRUJYESSNMJHTKHNVZCAXBWIBVSHJFKPVVXBAZMFVBCYBIWPBPRKNVMMMYNPFZTUMEAITVEHCIOYYZVSJNGLPJIHAAOXCGOKJGHUUVHEVMVZJTGYMYPDUSQBDIUOQAKAUAFJUOQBXBAVUZADPVFXMBKUDNAZZJDVWNVYMZCDLAOGEKMIOATLYJWXZAUAYKPCYWUHUZZHPRAJCPZUCHLXEHAHYPBPUJOSUEESSSCLPSAZZSSMVAKXFVLXBMQSPGJOXXWSFDHPTWDEISBMMFRBJFTHXVPIJTCDTTPJDCDLPGGTLORVHRVEFNSYUSPICHKQKXXZXDDAQDPEWBHIXISLIVJIAGBBKAFNYTCBJEYWDCRGGHQAZZCIHDOMQSTUJERBDYOICLAKYGMZVHXVSKUGCFDSKLJARRTWYAXAYHURBPKIQWCHLAZYUOXXBZIZECSDWXDOAMUNOQXUVTCEOOMNIIZNEQBHTMXQLPBWPSZBUNCAACTSMPLKBLJHXNDZJQAQUTAYFWQBSULIPPCCSKBCTIOARELDNCZANDAJIGDOWTAJOCIEHXSNDPDVLAVVAVMFOHELRPNFCPBMUJEDBSJEKPRCZULMMJKXHBZAZSSNEUTZKRSELKOLQOPFELCCFNAWWDODZAAYAYAAVPXZSFCQWHAYGTGBKZELVZHODOONGUNBGFEOGLFJBLPAADXWSOCOSLCUMPUAYXFCYHTFUZOAGJGCBYNGNMEIRWKAKTUARSXOVYOCWDBAGNQXYTXARUGNCCLNGDCZLZORKHMEXLDAXGWVCQTAGAPFVQKSAETFCTMOIHSWSDXASRQXSCCNKCSDUNWJQRCBJFDSAUSMJNNTWQXJARTVALQSYABRTATSUZCSVRSJDJJUBTPWWNZNYAAYAFAPJCEYUAFLPKARMNIUAYOCKWKHNNUTMDFTRYKBGGRRAXHAGAMJDSIYKCQRZEQTPQABDTTQDLZXTWGKCEINMQAMLTJADAGBWLYHRTGUFDWYUWEJCPSMWVVNZJFKLKYCKURRRAULJJDBBGPGXKMFQHMRLYPEYRHABHUGWYNJSJERVIZXSYATIITCPLKSGBADWDOAGKWAQAOZBIKSAXNUQEDABACGSNTBUWAUMOMRUOWNCJHYSFNHLFJAZKVZVYVGAYASVHUMANJVKZTRQSCAYIEQULZQVRTYHAIYKIXMDELZTXWBXRHKCAGNDCOZWTZUOIHCPLTQFXIHAAPMWSGNAITAAXZITFARAPNSWCPKYVKYPSPGLSHLUOGYPUSAACFYJHAAAKBIOKYNZACAXFPDAWQPIJNDXWLQZQCXLUYZYNMJDGASCNPWQQQGHUQBDWKYXIWSNTGVLMXACYEENHVBHXWVHGKHENMRJVSDAFONFVQXTYTUAJYGDFPNCPWAVSDKTVWDAIYMNJLLRCRVIIPCQQBTDDRDXKWCGQDCALMXNWANNPRAEAIWAQSJSXRFRZOUNCQPNPWNUKEVPAQRLEVRAECUMRVDEXBTHKZPKAGXVXPVASULFAEEOHCFZHPGOSWTKQBTGYAWAPXGBAPTPYSUXYMVTPNAOZVHLEKWPGKBGVEALWQWSJDQCTBIYNXMCELEUCZJTGJIIQQESGWLDAKCOFEWKXSYVKOCFLHFHEDEXJGCDTWFUPTWSCSHHRKQBYNOWIRDVUAXBOSMCWXWGOBFHTFMNNVFPUUOJNMRWXCXPGUQNUBRNTDYBGLAIYQAQHSMADBVBAEKIRBXWCKODWHDEXVIADGANYDPNETVPRPYVMAETHAKYWTVKULDZAIFVWLGHLKWZRKBRIEMRAGJZEBWFWNIAONPTPBYXWDBFQNNBQFJMEYVETZDYHWWNTZJQGLSBOEZTQHWPOYCNSZZACPUVUJPFBEYODMJWQWNPDWTDBSILOURBUYDHVSNVCNCEYUUCPMLNAADMAAAQQILBWFQUIMOTPKXRQLMBVZKJCPQAJBPPOBTGVHXTDXYUNTGFWYUZRAZWOIJARTYMXJCDQTBAFVPZHXYLATATBPYFNTLASEARRTVVMARHZFIWUBFXGRPRFMKANXPTISOBJUZHNTHRXQGODFABGWYYAZP9QKSRZEMMUQ9ZIBUPTBVJCJWBPOMPRIJDRTW9UGLCAJHBOHLZRNELILWYKDD9OQHBNCZQZ999999999999999999999999999999999999999999999999999VKUIAAD99A99999999C99999999DIODRCKI9IUWGBTDTILEUVUPLHEMQZAYKWIULYHGPKVYSGCI9ANDOOBQTXAXIHGSVOLLXOKTRCHZFDHIZOJMZHMJTNFBKWKDGPCNJFRTGQEKCGTZVTLPOICEOOVPUEZLJGBNBUPAOBPBIMSZMFGAHORMOF9KAA9999NRBM9KWMOYBKSGKVDTVOXQSDJUTIIPVIAOMOYWFXLOFVP9OP9TBCDTJXZNYZQBALCPJCDKWKQQARZ9999999999999999999999999999999PQSRCWPOF999999999K99999999LAB99999999KPA9999999999999",
                "XCNVYXCIPKNMLJHILMDJURBDNYBYZDYVD9HCNUFXESXUPJYRRFJBUULGZZJJNWGTTKJOPAYRKCRGVNSAAGTYSEWBCGVAQULMSUOYLXKJACNOEGABSCGVIJVFURSYKOKS9ZHZRUPOLQMFIGWWTWOHKQSMKKQGEGYKYWXCGXKLILEEPJKCLNFCGJKMTZOHIEFUHNFUCRBBVQSMSQGQBNI9WFZGKVBRCEQGWHLQKKDIBDAHSRRISSZHWMQ9FER9RFIEAUIAGQNRYRCYRIDDSCNQSNEHKY9NLEBUYQOHZBJSABLOOZOWMSGLQTXGHKNYXKGQDQFACHFSRGFVGFEHRNBHCJEOQPSFPLSAE9YSMXCXXLKSZAGSTGF9LQUMJFEZBHTWD9DENJRJCWFNOALVJPWSDXML9YAKBPGVYEMNCYDFBWTSDIKWMLXWKAMHDMXJN9XCCMHDZWGXINYIXGYAWSAYFIKFUTIIMRRBDZKNBXV9EBEGHYNMQJXRJPDAMSOYPKZW9VWCTSUONXWXMGLKJWYTKGCK9C9UVSO9YDVNEBLEZQCQJXHLLFGELOAFSLOPY9VAGAFRVJKMKKDVXXLGBENBG9HPFRCEVRYWKSR9IFYDQYRTWTQTBUJKAZ9NNYDXJYSJV9WYCNKDIF9KDGVPFXQEEEMEYAHEMARZNDECJCPGGKUIKEYLVQWYVAFPDWIHIXJWNKRIASMJULFSNJNPLGRWNYONZIVQYANFLQMIQFSIDQOSZGILUFGESEEDWLBWDQKEDXDPPFDGMARJNFJKYICNFTRGLMPPRXGTWQ9UZRDEZANGJJCVBCCESYGMRRPLCRBKUSNHOQZAHMOFKLQQUY9ICFGSCPVAKCAALZQEBPA9IQVHDPFATEWBSBATX9XKMNPAEAFFQFNDFEK9UOWRYYZPKBD9XDSTAKLTAJEMWQQEKHKXTWHCQPWKQPVHTUKCPXFNEACENCCQMN9ZPLRGUHAKBOMMIGBEEZC9JJTRUERUGJXFDUTBXSNZJNSHUNHUAZUMZK9DCG9MNPXTFEDNFHJPYNKNOBJEDYEVUZGTMYVDLVNXNXUQKNIFGWLMLIPZEATSQCMXEWWJYUYSRJALNLBGJO9TNTUWHYFVRYXJXDIEMHYACXEW9XYTBXHNMOUKFQLGXIGCZJQFLQIQJVQVKVHPDESVDVHHLOMAHFCBERF9RECSIUZQLS9HDXNTLVEKQLWQJPLAKQBTS9VURIJRQXLNXLLCO9PQREWYCFIZKEITM9VVSUCRYR9PE9HBWIMNPQJPTFJEBOCSPVWADKSZSTUDMJAOG9LJJBVRHOUZFCWUXKM9SZZYUUTG9TSTRDKXYOZVNZKZCRSCBKMQFLMZBPVXMBLHQEDSCRUOXTML9VZZMRHRMKWONJSJQMALDQVFDWHPHXRDOWGVNKWZNDSPGJMC9FVGBAAZG9HYWSLTUNBATROOSOWTJCTVCFVWOZICS9JWKBJOYSDKCSYVWXZD9DWCDHWYPSVOMQ9TBLVVAJRW9TVQVGPRCPHIVLWCXH9GFPSZGVXNPALNJUSBBLXLJUXBKYZGIJNTLRTZTWJDMRJDNOXFGYCTZXCRYLURHQTSBEZBUNFYPYVYNTZTBKZFLOXYHEMQUDBMVUCSGMIZDKLKJJCINNUNNJ9DYCNTFBSXCYKCURMUHRNHETBKOQHRMVWCQJPPDZFUEQGZYTWXAFXYUNOPIGJEAMUYSCFTBGHOXULL9YHBWXXIYRKFWYJWFXEOGNWDIOXMMGKOOA9QFASNAIXUBGSBINAFGANTGFOBMYCLIGXKZASUQEXTIHK9VBHJNISJWVAGPOLFHLAYHIOPSSYIYGUKCOTQSMOGVZ99Z9LGWVRSMQYOZGRLZMRUDLEKFWDBKPWLDMCQE9VBXCYTNVDAXVRZMHAU9NXYGWHHSYHVSVEXXZ9EZXHNXCMBANKYUABADDQXBMTGQVCMUBDOIIFIDGBAG9QHFHCJQCBHNMGRLTDLCXINNYNJGTWWHQSHOSPAUPLRIFJWEVBDDLH9AQEERAGHNCJGHL9QMFQIUKOCRYYXMFAFKPBOBSVIYRNLMBXAJRCWPHMMOKNYPLNKDLCTWKMOJTNDTM9VODGXBUGRHOOETCAQZRFXFEQQCRUYSRMSGOFNLRYJTIRMGEABTSXFZAODIGTPEAGLAVZWLFXGUSWFWIFAALCQGODFABGWYYAZP9QKSRZEMMUQ9ZIBUPTBVJCJWBPOMPRIJDRTW9UGLCAJHBOHLZRNELILWYKDD9OQHBNC999999999999999999999999999999999999999999999999999999VKUIAAD99B99999999C99999999DIODRCKI9IUWGBTDTILEUVUPLHEMQZAYKWIULYHGPKVYSGCI9ANDOOBQTXAXIHGSVOLLXOKTRCHZFDHIZMMEHMILGJFIUITZLAONHWRLCJKJHXLOHRTDJOMFETXQPBXWHRRJ9S9ZIIVRYHNUCFRQZWGDSGLYSA9999NRBM9KWMOYBKSGKVDTVOXQSDJUTIIPVIAOMOYWFXLOFVP9OP9TBCDTJXZNYZQBALCPJCDKWKQQARZ99999999999999999999999999999999NSRCWPOF999999999K99999999LSB9999999OTB99999999999999",
                "999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999MUN9LXIQBWCSJDSWFARRJMIQGJWZMJQ9AERHUZGLTH9OAMCJBIJHPAOQIECPTNYHUWZLCSIYNKMNFHSWCNSA999999999999999999999999999999999999999999999999999VKUIAAD99C99999999C99999999DIODRCKI9IUWGBTDTILEUVUPLHEMQZAYKWIULYHGPKVYSGCI9ANDOOBQTXAXIHGSVOLLXOKTRCHZFDHIZNRBM9KWMOYBKSGKVDTVOXQSDJUTIIPVIAOMOYWFXLOFVP9OP9TBCDTJXZNYZQBALCPJCDKWKQQARZ9999FJHO9TPBCDABULPM9ERDYUZMQMNRPEFSYBDYWILOXQFRGAASGBQBBZMGICNJEPTFAC9ENSINGMURA9999999999999999999999999999999LKQRCWPOF999999999K99999999ID99999999RUTA9999999999999",
        };
        List<TransactionViewModel> transactions = persistAndMapTxs(trytes);
        List<TransactionViewModel> bundleTxs = bundleValidator.validate(tangle, snapshotProvider.getInitialSnapshot(),
                transactions.get(0).getHash());
        assertTrue("no transactions should be returned", bundleTxs.isEmpty());
        assertEquals("should have changed the validity of the tail tx to invalid", -1,
                TransactionViewModel.fromHash(tangle, transactions.get(0).getHash()).getValidity());
    }

    @Test
    public void validateBundleWithMissingNonTailTransaction() throws Exception {
        String[] trytes = {
                "999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999GNXKWQPHMFCEZZCKUCCD9PROQVPCTBVVAPHCLVOPYYQLQRMPGTQXBVZLKGGT9NXHUAASFIAVEOZTBSM9DA99999999999999999999999999RENGLE9BEAT9999999999999999FDKW9AD99999999999B99999999RJPQGE9AXNBBLPQ9IFJXFJTXJAIGDDXAWXGAVU9PJQNYFADJDIDBTJKSAEBBX9NWJGZVAVXYWXPCEFFH9DKZYSMJAQRLXZHCNPTJPJLOONNDZHGNTBIINGYKZQAAWF9LWQTHUQSAXMLQN9DKCQWHIJXNGLGQVA9999XIFVJWCABR9XQKOWCXJAZDZWMWWBVHROBOPISAWDIJTSFPVAUZNJUMNUCOFIBIAAVIOWDTCNIPRVA9999TANGLE9BEAT9999999999999999SVIDBWNOF999999999K99999999POWSRVIO9VMIJ99UGNETMNPNNNE",
                "YU9WINMHSBIJ9HRBKDEHZYOCDGOZ9HZSSVXAYYOD9AMAFBCROMLSFDFIAQKEXAVFDLJYVABRSONSTTXLCQJTSDRFDEXZIORLRSQDZQODNCHAAFUPGBCEVYNRSJQGUZRAQIIEZPFQGWPQIBMDVNZGQAKCU9VLHGYSNDPHCMOCTRYQOYHFPRQSGHSDEF9MSHGXYGUTHSBSF9SOSJQFOZXMQGCUXAYWLBJHXOHTOM9ITZPISEXLAYAZBHTZDDCOIHKDBL9AAXZEDFHDYCPXLDGR9JTVXDXBC9DRDVREEEVGVPWVEZHJBYQYTGDEWQHVEDTAVLWW9WBXOIGDGUAAAVKFMPVKSYBVOIWPYGCMACEAAHGUIQVFLFMSCPKTYQWJDGMDNLMDIUUYI9SZOFQPLKKACESSWIXPFYZWDHETYUGEVASPHBGQPJPWVESSUUEVUYDYNQUQURSMCEPKIHYXNFHZSHIIDTMEZQ9IPSHTBDK9UHRSIIEJRILBCMVUMGAGBMHKEMUUKQDCYAVIAN9MBWJCAUSSJRSAUEUBGEFFCFSOBVGLXBAIDOH9NXWQUSIFUINEVZUWELLVIOSSQRVHMTDBCATBWFSDJJDLURAUKEQEIRICSCXAOJNPWHQKYVTRLCRKHLFHHHPYSMUEAPMQPMPS9CHCIYXEYRNIOOGRWKVHUGIWJZIGPWGZGBGYTVC9UVEJ9JBIYMDHYXLWIDXHZVFCCPLYXDPQPJGMKNZMMONGNXSNNPCGEGRJTMCPTJONGPAEDMSHMGAPGBDWVCSCTJAECSHTEGBMVCDZMQYZ9IHERWGCKAIMFOJRAEDRDSWJASV9XYS9CTOEETPQHRKJZ9FPWTVCGLEJQJXVVDTYZ9DNSHQAINKROQQIPTFGTABEELYPBQHGNNB9NCL9BVTG9MH99BPIRNNGC9MQQRH9YUDYSUJIDSZKCIGEKFSJ9PXUYKVPUZYFIREUAMUZE9EIMJK9YGAZXZBPRXIRDCEVDHWOCFIJTVRCRZRRJGFLILKVNMJAX9MUMTXCWTUTP9NXBZUMAYYY9DNVZTCROBCMMHVKSQRXMGROCMMCDENWQWBV9LEIJONWTQXOUQZOTGEJHJELYZOPICLDWPHVCMBFSYHPIJYZQDEGYITVPYNQMXPRTPKADLUKW9AEMSMGIWCUMOQMUDN9HZGYKTNVVNLOQAFVETEDJMJVKYCE9RE9AJP9RMYFKGDEC9GIGAFXEXIYXPFBOMRPULVJMYTQEPDMMIABDHJGRNNCKADZAUFV9WCWFYFHXLCED9E9SKKYHVKDTGNCHEKFJL9YJHTSRUVKEPHPCQSFNBXKOJNGBSEOZLVVGNUQTRACVGEKDSORUHVSDSQNUZASWXRADGAUDYDPODDEDNDDT9OAEARSBLPVSYAOEYYZJIZIZDENQOKMXATCTD9NEFVQWNCET9N9IXWCCWHYUBDTDJUZFXWMATRYSGJUQAFKAPIQIIXVFFEFNLGDPAIGKONUWLUTQTKZJYDEGPASTOMM9QTGOMYHFUKMNEVWPCMTLPDSOEEWDBRHZPZJIFMBUTY9QPRLPSVURIRMCWLH9YIZBOTJQMMF9ZP9VCCEGWVKSSQNANP9ZXVCAFGAVBXDJHUMKTKUBZRNKUGJTVUPDZMUK9KZI9EKY9DQDUNA9ZVPCROKYYPISSTDOJZJXMXZWSGZBEPKAUYPBPUTDVQKUYXWYTZXLYTCLLKLJUUJGFFCMZFKDTJET9KEDRMWZSAEFCSXLMRHRLG9EKLRZJ9NZQEONGFQSKSQMWRZXWVEGHCF9ZKGQITDLGFTZLCQMXVGVYIPKSUPPAOIKVWARJHAEJUZOOJFCFJTGQZWROSCEQSITQWZTQDFKECATBWSIRDFVWH9TXXUVEBRRKOTFSGBMGCMZDK9BJRVEUYOVNSLZNNSTWOB9CFNDJHJENDWSTIMMSWD9HSA9LDGTJDJFRGQCWOHYJNMFFLLDMVQEMCMNVQWMOGCEZUTK9MPULTDMKTIVFNVWXDNTRHNREHEDWIZCCRFVM9TXCTLBLYEKTRVVWHKZDOSYOBNLEKPNXMDZGLSVBBNBJIBZYBXZCENKVIXMNGUJUYFGFYFBKELSBZROQWKMESZTWDEEUCSXOWFSNJUGGJANMJFCBJV9GMDDJCAJHWKYQFJLFWZESTSIRBZQWYHGQDFUUWF9F9HXSBZRKBDLRWXSMKW99KPWJOQYPMHB9KWALSVLFNANYSMNWSJLUOCBKAWAJHNWMLPLXHVEPTKBPWLWHMDZ99999999999999999999999999999999999999999999999999999FDKW9AD99A99999999B99999999RJPQGE9AXNBBLPQ9IFJXFJTXJAIGDDXAWXGAVU9PJQNYFADJDIDBTJKSAEBBX9NWJGZVAVXYWXPCEFFH99XJLIVAZYJGPKEHANESX9DORLEIOIFL9WVQBBNUDRZDGJMVSRTSFKOJPIMEXPBCPGKUUEKRGAXOB99999XIFVJWCABR9XQKOWCXJAZDZWMWWBVHROBOPISAWDIJTSFPVAUZNJUMNUCOFIBIAAVIOWDTCNIPRVA9999999999999999999999999999999RSIDBWNOF999999999K99999999POWSRVIO9VMIJ99FKKNKGPNNNNP",
        };
        List<TransactionViewModel> transactions = persistAndMapTxs(trytes);
        List<TransactionViewModel> bundleTxs = bundleValidator.validate(tangle, snapshotProvider.getInitialSnapshot(),
                transactions.get(0).getHash());
        assertTrue("no transactions should be returned", bundleTxs.isEmpty());
        assertEquals("should not have changed the validity of the tail tx since the bundle is incomplete", 0,
                TransactionViewModel.fromHash(tangle, transactions.get(0).getHash()).getValidity());
    }

    @Test
    public void validateBundleWithMissingTailTransaction() throws Exception {
        String[] trytes = {
                "YU9WINMHSBIJ9HRBKDEHZYOCDGOZ9HZSSVXAYYOD9AMAFBCROMLSFDFIAQKEXAVFDLJYVABRSONSTTXLCQJTSDRFDEXZIORLRSQDZQODNCHAAFUPGBCEVYNRSJQGUZRAQIIEZPFQGWPQIBMDVNZGQAKCU9VLHGYSNDPHCMOCTRYQOYHFPRQSGHSDEF9MSHGXYGUTHSBSF9SOSJQFOZXMQGCUXAYWLBJHXOHTOM9ITZPISEXLAYAZBHTZDDCOIHKDBL9AAXZEDFHDYCPXLDGR9JTVXDXBC9DRDVREEEVGVPWVEZHJBYQYTGDEWQHVEDTAVLWW9WBXOIGDGUAAAVKFMPVKSYBVOIWPYGCMACEAAHGUIQVFLFMSCPKTYQWJDGMDNLMDIUUYI9SZOFQPLKKACESSWIXPFYZWDHETYUGEVASPHBGQPJPWVESSUUEVUYDYNQUQURSMCEPKIHYXNFHZSHIIDTMEZQ9IPSHTBDK9UHRSIIEJRILBCMVUMGAGBMHKEMUUKQDCYAVIAN9MBWJCAUSSJRSAUEUBGEFFCFSOBVGLXBAIDOH9NXWQUSIFUINEVZUWELLVIOSSQRVHMTDBCATBWFSDJJDLURAUKEQEIRICSCXAOJNPWHQKYVTRLCRKHLFHHHPYSMUEAPMQPMPS9CHCIYXEYRNIOOGRWKVHUGIWJZIGPWGZGBGYTVC9UVEJ9JBIYMDHYXLWIDXHZVFCCPLYXDPQPJGMKNZMMONGNXSNNPCGEGRJTMCPTJONGPAEDMSHMGAPGBDWVCSCTJAECSHTEGBMVCDZMQYZ9IHERWGCKAIMFOJRAEDRDSWJASV9XYS9CTOEETPQHRKJZ9FPWTVCGLEJQJXVVDTYZ9DNSHQAINKROQQIPTFGTABEELYPBQHGNNB9NCL9BVTG9MH99BPIRNNGC9MQQRH9YUDYSUJIDSZKCIGEKFSJ9PXUYKVPUZYFIREUAMUZE9EIMJK9YGAZXZBPRXIRDCEVDHWOCFIJTVRCRZRRJGFLILKVNMJAX9MUMTXCWTUTP9NXBZUMAYYY9DNVZTCROBCMMHVKSQRXMGROCMMCDENWQWBV9LEIJONWTQXOUQZOTGEJHJELYZOPICLDWPHVCMBFSYHPIJYZQDEGYITVPYNQMXPRTPKADLUKW9AEMSMGIWCUMOQMUDN9HZGYKTNVVNLOQAFVETEDJMJVKYCE9RE9AJP9RMYFKGDEC9GIGAFXEXIYXPFBOMRPULVJMYTQEPDMMIABDHJGRNNCKADZAUFV9WCWFYFHXLCED9E9SKKYHVKDTGNCHEKFJL9YJHTSRUVKEPHPCQSFNBXKOJNGBSEOZLVVGNUQTRACVGEKDSORUHVSDSQNUZASWXRADGAUDYDPODDEDNDDT9OAEARSBLPVSYAOEYYZJIZIZDENQOKMXATCTD9NEFVQWNCET9N9IXWCCWHYUBDTDJUZFXWMATRYSGJUQAFKAPIQIIXVFFEFNLGDPAIGKONUWLUTQTKZJYDEGPASTOMM9QTGOMYHFUKMNEVWPCMTLPDSOEEWDBRHZPZJIFMBUTY9QPRLPSVURIRMCWLH9YIZBOTJQMMF9ZP9VCCEGWVKSSQNANP9ZXVCAFGAVBXDJHUMKTKUBZRNKUGJTVUPDZMUK9KZI9EKY9DQDUNA9ZVPCROKYYPISSTDOJZJXMXZWSGZBEPKAUYPBPUTDVQKUYXWYTZXLYTCLLKLJUUJGFFCMZFKDTJET9KEDRMWZSAEFCSXLMRHRLG9EKLRZJ9NZQEONGFQSKSQMWRZXWVEGHCF9ZKGQITDLGFTZLCQMXVGVYIPKSUPPAOIKVWARJHAEJUZOOJFCFJTGQZWROSCEQSITQWZTQDFKECATBWSIRDFVWH9TXXUVEBRRKOTFSGBMGCMZDK9BJRVEUYOVNSLZNNSTWOB9CFNDJHJENDWSTIMMSWD9HSA9LDGTJDJFRGQCWOHYJNMFFLLDMVQEMCMNVQWMOGCEZUTK9MPULTDMKTIVFNVWXDNTRHNREHEDWIZCCRFVM9TXCTLBLYEKTRVVWHKZDOSYOBNLEKPNXMDZGLSVBBNBJIBZYBXZCENKVIXMNGUJUYFGFYFBKELSBZROQWKMESZTWDEEUCSXOWFSNJUGGJANMJFCBJV9GMDDJCAJHWKYQFJLFWZESTSIRBZQWYHGQDFUUWF9F9HXSBZRKBDLRWXSMKW99KPWJOQYPMHB9KWALSVLFNANYSMNWSJLUOCBKAWAJHNWMLPLXHVEPTKBPWLWHMDZ99999999999999999999999999999999999999999999999999999FDKW9AD99A99999999B99999999RJPQGE9AXNBBLPQ9IFJXFJTXJAIGDDXAWXGAVU9PJQNYFADJDIDBTJKSAEBBX9NWJGZVAVXYWXPCEFFH99XJLIVAZYJGPKEHANESX9DORLEIOIFL9WVQBBNUDRZDGJMVSRTSFKOJPIMEXPBCPGKUUEKRGAXOB99999XIFVJWCABR9XQKOWCXJAZDZWMWWBVHROBOPISAWDIJTSFPVAUZNJUMNUCOFIBIAAVIOWDTCNIPRVA9999999999999999999999999999999RSIDBWNOF999999999K99999999POWSRVIO9VMIJ99FKKNKGPNNNNP",
                "COSNPEACSPESTKTUS9CSMOCWVUBLERQJQGLLA9AYRRXMOVOBULQZZZJPLNELEX9EVZDAFOHBB9FBAYOTDB9YGJAVTDWNPJVVGEPFJ9QBYLXAYZEETY9GMYQRIRAIPWMJUFMFRSQRCEIOWISMBJKGCIGIIYNMXAYLXZIBNKANT9DSQXPBUPWGUJTOMD9JKSNFZJJFBZYBWRWQIZFOZXQWNJTRZTUPHVEGTAOLMBEPXOB9TCEBNIWXQUHNQJZHAOWGVOOOTSCTEUEMXJUODZP9CDLCMEXAW9YJGVNREENETEYXOAKZVRJVUSCRUSRCNZUGUOLCNHQITWYPJVJGPVULASTONDZRDVCNGJSN9DMMUORCOIBTITSPBXSAVTOHSAXHMGH99APRTQIVCEI9NWYKDOZCCWBNZGGCUCISSMGJHJ9OVSFBZVFMBODKRKSLIDESGFDQITCYFARWYTLFKSPLNVQ9LTYFODCHBAJKCWVZNBLOJH9ABFGDFOXHDNHZILINMYMVZYWTFJJOLADPTZRPJEMGPFQNYTFDGOKMDTDSKPTHIDWLMRSSACZMTHUCWVZHCYSPJRATABZ9JHWEBGTTQORGFOYDWUIYFYGOGGTYGYYI9RPKPMCTYNYKHHNWQKJTDQDHTRUYQPMCDDLVUUHUBPWGPMNQYPKHDHGIUSXJGNUXIYGZRGVYPTTV9KXJDLGVVXRIWIGKZJVCQ9DUWAYNDRKYCGKZDEOKZQCXELSQXLGLAPBDIWRTKGSIRNAZ9XFEGMWOWLPUA9TSGYRDOU9GKY9JJDKCJKKGJCRARGSNECJ9SEVAGPPJMBTMGNWSLNSFBOEYMIQBKOVSCTDIWCOQTHBVTZOFNNIYKKJLAROKIRFFPCLSOWO9BVNNJSXEYLJASPUEFKCEI9SGWADNGS9MZAKFTCAYNRVKGDIGYDTPGJXWFAEFGG9BX9XCNBZGQULH9IPPIQ9VFVAXGELUMCTE9TOFOGCTFYBYEBFOKKAESIIHEWLYLQKWDHPYNELJKMZHDSDSK9ZWFP99FQFLUXGTSVDMGHIFZFUCYTYPVEFEDM9TOHCQVIBXARYWZEKTWEOVSBYZTJZRUFZJCLRBTOWPTKY99CYQTGPMAKFYALIWPEQLUB9RGANTKDDMSDSJOTNPFZCXKJUGTJWWPK9FAJGPJOEBRHL9ZU9XRBDJBVMFIZIZFGKETH9RJUSDIOWDZIXFOJLT9DSIAWSCEYBNOGOAZQPZKVZTBXGACCBVQGFNGXNQFTVPUGUOHNBKTUERLSTDXGRKZSATIRHDBSXARYATBHOLUHCQGPRMQGSJUAXUCWKDXAUGORHFVVVDZQEYYGSV9IUM9VTMHJCIKBQD9TQLLYTZHAKDHPFGYMRGJOEDJKQTBBNFCKDEPYTPWUJEOPRJWHAILMVW9AXS9HAT9GCGRXZEHWNDOVGKGPWFXFC9IKLVZJCTGZUJFRHGL9FZWZYP9TPOWGOUTQ9INYBVTD9N9OV9AM9GYRJ99MRWRWLOAKJXMDTFNS9NZQAYGVZRJ9WVSIDRRQLGKH9VPUVKFWZMSRVVLKXUGJAZESC9LEYDNNDWS9WTWNFPCR9YKPOMIJAVHCRCJVBDFWSTDN9BPJRDMGZFXWTY9GUX9WEPJQMXSECFPREXAJ9DU9OLMNQFTF99QYZOGDUTMBHMNMCNUQTU9FTNEUNBT9NQO9YADGY9C9LQR9DYVJZE9GMMYAOUSWUIVJ9EAR9EEFCO9SZTQ9JQHPIJGXIOQZHOSUSVMHBOLTYSEONVLRISNAN9KJHHFFISTYIHYVAMXLPNALDELETXVSWGUWOIVKNAKZKNNRVNJKE9WMNQBXFGXSYZQQSIODAKINA9CPBOGAYKJ9V9GS9HERXSVYPEILYXC9GURBREBCXRZJVXHUOPGYFLPIFBCOTMHFTAAUQUZVEKOWYFFGSCXDFDBTSGZRMPQR9EYSZYGQETCWFDRXVOXXCUBOQTBQGVLAONSTSLURFYSDPAVNCXNWVPQOUORMVSLYISQUQKXFYYMJSGHQP9VAAZABEAGJMCPIEBZQSYCPS9CNKFBDRDTDA9C9MVKGUISRX9ODVUJNPDWMZ9ESYXJ99ETDGSTJZMZYJEGRUWTORMCLNHLDQ9YIJWPMDYGGJQHMFPJ9VKINJUESTCBJQXFTCJFNUXPZONVKXJRAYGKIWHXSBZRKBDLRWXSMKW99KPWJOQYPMHB9KWALSVLFNANYSMNWSJLUOCBKAWAJHNWMLPLXHVEPTKBPWLWHMD999999999999999999999999999999999999999999999999999999FDKW9AD99B99999999B99999999RJPQGE9AXNBBLPQ9IFJXFJTXJAIGDDXAWXGAVU9PJQNYFADJDIDBTJKSAEBBX9NWJGZVAVXYWXPCEFFH9XIFVJWCABR9XQKOWCXJAZDZWMWWBVHROBOPISAWDIJTSFPVAUZNJUMNUCOFIBIAAVIOWDTCNIPRVA9999FTXZAEQIKGFJABOGCCQGOMKNASGWCQWMNIMRDTHKPJMTKDGMEQNZOAYARIYEWFZYJALRKFODOITTZ9999999999999999999999999999999LLHDBWNOF999999999K99999999POWSRVIO9VMIJ99UMGMTTTPNNNV",
        };
        List<TransactionViewModel> transactions = persistAndMapTxs(trytes);
        List<TransactionViewModel> bundleTxs = bundleValidator.validate(tangle, snapshotProvider.getInitialSnapshot(),
                transactions.get(0).getHash());
        assertTrue("no transactions should be returned", bundleTxs.isEmpty());
        // special case, since there's no tail, we don't actually update the validity in the database
        assertEquals("should not have changed the validity of the tail tx since the bundle is incomplete", 0,
                TransactionViewModel.fromHash(tangle, transactions.get(0).getHash()).getValidity());
    }

    @Test
    public void validateBundleWithInvalidIndices() throws Exception {
        // indices of second and third tx swapped
        String[] trytes = {
                "999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999NSA999999999999999999999999TE9999999999999999999999999TXVIAAD99999999999C99999999YD9SJSKIJDSDTUQDYJOAHDEJBFKXNETCGPFQBF9TGKCTGJINK9OWSATFAFLJWOGWFHZRPHOJVFCAYGPJCRPYRKDCMV9EUR9ZJKLBY9M9YHSHOKKZJP9PYMLUFJBZOZKJVBBEMVKXRBVGEQJJEWILZSEFYQVYS99999WBRFOY9ULDPMHFZYSUKD9OTYKWJUKCXPOIZVACZNPPNTVFPNYUZNQJIYOMRMSULQPVWFLLIVODQDZ9999999999999999999999999999999BALHCWPOF999999999K99999999BHA99999999CF99999999999999",
                "VTXNGHI9LCURLZKEJGNLWJHKYWPNV9X9BMTHCLKGTSCJSVEGYURPTZZX9OFROISEQCIJYGUVIPRJXHKBCWAAAHGGNSYTCWCLXYHICPXD9O9NTNZMGPEOQBZTESHQE9HDZBABFFZDDRDJUJMEEKMICBQTLPTNUSI9GYLLMMCIFEZOEIGRKPSCFWFWOIJFSG9ZEBQA9AWPVBRAFNXBBCRNILCSYVBPAJEZJCJHTOGUMIPJIFQAGBDUWNNPPISBZEHXHFWGEAVCQCYQHEQRBPNDKDXJWEOAIIJZLVVWUJAACWWERSQGLLISCFUIPPHFRYELHE9BD9XGPQRXUANSTBKNDDFMLLSQLNTNDAVXS9PLLHPXXMQGYEIEBYRCOHQONDEIK9VTQIIEKTJRYPNVS9GDZYEIVITUASSKNOJJPLVAHPODECWHWDFUZWYSFOSIHQVQBMGSHVJVPKMTOKHLSLU9ZDPCJWFHIPETTCJOLWMDSACQIIBAE9KCVTWHWRRFIGDDOTOZAUTEUHCIKEZAGEXWWQZY9VDFXJAX9EUBLTKV9PZXKUCYAQYKKPYFKYAHCTMGBBZQYVRZIRDXTYYVPFOQEZIVNYDEL9AEVMLEJMLFIBJRTRIJE9EJPUWJTFBSRIBWGWANEUNCHRWNGEVOVBDJRQFOHSQUGXZGXANICQMJYKQOARYKXOSULRZQZVZJVWH9YENLDMGRAZLQBMHYLXLJJCJAY9WFKSOIEGTJBFLNZMVAZIXDUGRTBBPYPTGNMNHMVHATQLMZRGOIJOUUNIMSLZNPBDFZQSUUAGBI9NBAMZ9WBAXEXHXVXZNPZIZEQQZASJPFNVJPPQAZIVZVKGZACSSNTBBVIQZTFF9KXESFWDDYLIEHGGCRNAUKLUXHIXRHQVNNF9QPUQCTEDSSA9TTFBRMNLAXTLFLDDAKQTYFCVAU9NEUBDYDXADXPHXQHGQCMVG9GDLDDELDR9YAFORJMRLDFUWPGRPGEYUC9NBLTFZKMZNGPYMUONYOMGISFJWIEQMDJWDHN9TDROSFJV9UHRVD99TAXDSTJTJEPAMM9ZCZXSTHPUSPQWBNJCQBRCHHMEAYP9VCYQ9XFWRPQWLKZCVODXYZJDRBWEDIAN9WWXLGVDBAWVRZVBSHHRED9KWVIUEHTJRDX9SCGWLTINHSKSIERFSOCIYJFRJRBANWWGMUYQIGBBUUNOBNXEOMECXTQAM9AEZRAFXNBWCMUIASXKCECHVTVYEIQIARWAWURA9AGGQIECUJRFU9BBXUCTDRUXULNT99JMMEEYQYVVFTAJHKPGFVR9MYCP9XRBS9XEQVEDBBOPWZCKYPXEHCWTCYPJWXK9GXOOLVBYUNLKGXC9VFTXDUPDLPXGSAQBMOIWOZNPIYKMMKUYCIMLXYPJNFLUSTAFPYGHPAUZERFXCENS9WTHSAQAZHAFPK9REPUSSERF9FWCICXTJ9A9BJDMSKQNTBEHCNMZDKFDKUDFQHUXLNDJ9VBGVXXXHPUCURTQRKZXECBDQIXAKKEZDDJNWCPDDHVPLBEYOIMKPDTRWDQQ9UECYVLXNMCZZXZHRPQNJXMGMFHQDIYAH99RMVXBTAEWBETFZPANHEJUEOGBHXMSCKMCDSVDQFAMPPAQDPAUOIYFCOKBGLCZKKTEYXHKDQNKZJHGEXC9YXROXREZMCFP9JBL9ZCR9ALZBYZZEQYZSAEHNNLZXHLEJBMXAFTSRGEUCFHEWRNAYQZ9WGZQRVFREQHVZZPMPJAAGLKXYNIMGPESRYXTBOBX9CPJKLYYDVETYRRDTMVBHPPOSIDAMURBJWNXAAVGBBOYIFHAPWM9UVSWSMJKOBDGIGWFPZPOFXSN9PZNDTMCIZPUCJNQGPMEZPLOPJXPY9SMSPSKVXK9XUOTDSVHDQWYUQRUFHMJWZOAHMWXJBYGEQVB9GDLPSF9GDMJHZCCW9DFRNMQRDMEWE9NP9ZOWKWUFTCEQUFCMWAXP9EI9RATSB9KPASHYECUOSCRITYRAYSKEG9HQL9ZSIKBNRENGICHLXWNCVHSMQBDICEVZFWHBQFXQFMFEQMVUSY9EEXCAGLDCVUTKDRTJZSSMPZFEBR9YEUWEYFMSUWJMAUEFUPCS9EORNBQIMRBKETIOFP9OHBIMODEXXTZQKKBRA9NFBZHOVKKVUJZHUCFLBLRIVPMZLBC9YYUPH9VKHNZKUQZOORBQEDVKFHZRKAVIWYVIZB9IYWWNGLDQABNINC9KGFQDVJWCNPFHTVGYCEUJ9ZQZ999999999999999999999999999999999999999999999999999TXVIAAD99B99999999C99999999YD9SJSKIJDSDTUQDYJOAHDEJBFKXNETCGPFQBF9TGKCTGJINK9OWSATFAFLJWOGWFHZRPHOJVFCAYGPJCBZKJRBVMKLYCYGLXNTRBNCJEPHWVVD9ZNYC9PDCOVQBPYR9ZZYGOACH9BPAIYKSKZDNVLODP9GSWZ9999WBRFOY9ULDPMHFZYSUKD9OTYKWJUKCXPOIZVACZNPPNTVFPNYUZNQJIYOMRMSULQPVWFLLIVODQDZ9999999999999999999999999999999JZLHCWPOF999999999K99999999ALC9999999IBA99999999999999",
                "CVKPPADMOVSNCNSHWHIROIALFVJLDOTZWFVSMANFJ9XQSLCJBPBBNHROAGEQIWFJBTGPAWQJWJMCBFHNWN9MMTKEEWNCI9ERGQALGKDPGHUALXZXZIEGILJWKEURNSHYNKICRKK9YLGVHULCCOCEHIRUYCNNJJCJJCNDAVWUFDYNNTXZJRMBHPRMRCTDFTZLOLINUGQQNOMMHM9SHPLTYJHBOEJSJJR9QQAIMVITNSCHEYGCPZCWDZDTUVPRKZMPJMGUTSDXRQTQGXNYDJPJGGKJXTSHOP9L9LLTVVYNMBJQUDGTPBRDCLXMDD9DKSEDIKXANQZASUQGLMDNRBZSQBTG9O9PVFRQTXD9TP9HRHQNIXMWDXBAPMFX9LZKTRHYJWYVMJYGHNMFYIPTEXVSDOPOPUVHMOGMNTUPVNVRARMORXUSSOSDFHHQMSLVPBVALHPIGLPGTMLENCQVLHFKEVIGRZQIJETWGSCWRZLZODLEIYNTOBHNBUHYBPKGGQNSDNTKC9XNHEBXFBRCXWT9ZRCFLPLWHFZZMNI9PPSASUJUVLHCTLPGACDSXQZLZBDSEBVEICJHLYNNNEXXSBCSQRGDNRDCSLEAPWPJEFGHLFVHEHUQXKTKQOFHMKZKJSQZGNMFMNHDAMVLCHOOHBQTCGFTBWHR9OPWWHPGFSJ9MYJIZQPZCWAMJAIDCRRDW9EKWDJNLFRQDCAMP9CDUQNKZZLRWHSFKYUUKJSKBYENYOERXITQGGAEOMTOEFSWIMWKOJIQKSEIFZRGABQYRKRIHGPBYJMXFAVFPLYHYBZWQCAYI9DKQEUZYKRILIDXSWEHAKHEU9H9SHPOACBWMYQSRNTIUYUFOP9QAJZEPLYFTTLKWE9YPBNWKUABSDWUVBXMLA9SFUKEDCQMOLZZBMKCWSNGEOPGFLYVZZHKEASFTTVBHGETIGBPRKWRDLIYJSRQXGMYZ9ADSCKDBWSUPND9HHBRFXILGNMQSZNZOIIYVXUSXQTZ9JGUTC9ZAAJCJRKDRETSFJNBVRSBKCCWYNOTVQVMKURWDQGRLMNTDTKOMQZVDECOP9AJCATUIPDIABXMJZTCJJHLBNWDHIIYPSYVZNLHOKYDZAOJNKJVUYQCHTDGWZAJKLJZFXALTMHMFOQODUIPCXJZRRDJRUHARXUEYDWPHTADNDTBEYLCEQP9QZSDXUMYCSOYKCLDGDPBUXWCGKTCWGVWNDPBGSZVRTEYBSVNRP9WDBHCSLJTANFCYMOKCZXVLLKMEQZLTTWFDZUIG9EIBBNEMLXUKVGDOBJYOEWUFRZDVRJMAGRBXWCCNPVGHHNUD9UQZA9FYKOAFGLKMTFYE9XFTVATHXWMCPQVBBTSWTBLWQKNDC9RKYFVZLLPMZBEURVBJWDPTLTHSGNPNRFBMGBRMCDEKBODAZCNXU9RZLMTIWEMRAHTXTCV9UFGUFVYOBLAFRFQXSXWVGMXRRNJGQZQRIAHXFQQDMVOQDRAOQEIPM9OTVSAPFFNR9UOJSBMBNECBWNPBAZQVNICGOWXAOMYRRBBXMP9ZHBPJHRZGUDZLHCSBJQRDWYUFEQMFRLHEDBXHTKUPYMIBTXNFWPGMMJJBTPS9NNZQIHDZJMWC9MNMOEORP9SDEJDKXVRJUYOT9CMPNHMQJSBEL9PUA9FANUKWSBELZJZEQDVAJUTDYZXIJXHCRIRWS9RXGKXFXEESZYUGGAPENBANDFUVHZCS9WDS9RRBMZTDPZJBNLNIFX9TUSGHCRIJITVQJDFCQIIZNNUSBAIHRGJNWYB9RSTUYHPLBLWPZJYSFRRUSAE9IBXSEZGT9GAMEGKJLFYWZUTLEOWOLQDYQFSR9QFHLSMNHAJGAXMGMUX9TAERKVNCBC9LMRGIWPLHDYLEKTDKWPZCXNSMRKFGCYRFGFJFVOJQTSXYFW9FSXT9BHZSZDC9FB9IIZSJQEDDLFYCGLZWNSUSAYJXGIHHXTRHHXHOZBHLZWCMCHOENNOXVREAV9RGLJGKNR9JCEMQJKBCOLQTTMMYYRLBUSNDZTLDKPZSLIECRDZCWCXTJEVXYXKCMBKDXNTZASSKOCLJFCCWK9NSFSAJZMESCUHMZCAKSIMZWXEXUSDBIMSIGOMTEVQPPMAVUWHQCDLVYLPJBMBBVKBTGLTHXDRKBNMIBZFISGVZH9DHOAMMIXLBC9YYUPH9VKHNZKUQZOORBQEDVKFHZRKAVIWYVIZB9IYWWNGLDQABNINC9KGFQDVJWCNPFHTVGYCEUJ9999999999999999999999999999999999999999999999999999999TXVIAAD99A99999999C99999999YD9SJSKIJDSDTUQDYJOAHDEJBFKXNETCGPFQBF9TGKCTGJINK9OWSATFAFLJWOGWFHZRPHOJVFCAYGPJCPPHYYYZQUMMLLJ9WDGZZTMYHDC9PCUWTPATIYRVGYORQFIDYTUXAJFPAMYYLXHGYOWXIYDILQKUS99999WBRFOY9ULDPMHFZYSUKD9OTYKWJUKCXPOIZVACZNPPNTVFPNYUZNQJIYOMRMSULQPVWFLLIVODQDZ9999999999999999999999999999999WSLHCWPOF999999999K99999999HCB99999999JE99999999999999",
                "999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999NVPJQUUVRZYJATRWDEXX9UDHZGBPHPMDXYGQSZEYMZA9NOVVNLN9HCDKXRXCWXGCXSZVQVCMPEZKJFJZWNSA999999999999999999999999999999999999999999999999999TXVIAAD99C99999999C99999999YD9SJSKIJDSDTUQDYJOAHDEJBFKXNETCGPFQBF9TGKCTGJINK9OWSATFAFLJWOGWFHZRPHOJVFCAYGPJCWBRFOY9ULDPMHFZYSUKD9OTYKWJUKCXPOIZVACZNPPNTVFPNYUZNQJIYOMRMSULQPVWFLLIVODQDZ9999RM9DMI9FIPZMUBPLGYMXPLQGIXLMUGRQNECIYTVDFTR9TYFJTULEHVECMALIZMJVN9UKZNSKORO999999999999999999999999999999999SOLHCWPOF999999999K99999999SGC9999999FVC99999999999999",
        };
        List<TransactionViewModel> transactions = persistAndMapTxs(trytes);
        List<TransactionViewModel> bundleTxs = bundleValidator.validate(tangle, snapshotProvider.getInitialSnapshot(),
                transactions.get(0).getHash());
        assertTrue("no transactions should be returned", bundleTxs.isEmpty());
        assertEquals("should have changed the validity of the tail tx to invalid", -1,
                TransactionViewModel.fromHash(tangle, transactions.get(0).getHash()).getValidity());
    }

    @Test
    public void validateBundleWithInvalidBundleHashOnTailTransaction() throws Exception {
        // tail transaction's bundle hash is invalid (all As)
        String[] trytes = {
                "999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999NSA999999999999999999999999BA9999999999999999999999999EUWIAAD99999999999C99999999AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAIIYXEPYFWPBUFGYIAWHIGXVAOPXIIKAOCHA9DPFZNDFNEATWIRITRBPYXKKRQRSIFAPTJFCPEPJWZ9999MVTOHDRMCONUSSESCTMMIFDNGCLFFVBTUWV9AWUI9NSSLVZFKFXBHJMETHLXWGMGVXOKABSVOSFFZ9999999999999999999999999999999EDCOEWPOF999999999K99999999NGC9999999CEA99999999999999",
                "HBFZMNKNLZASLRSOHJFMRJGLMSBYJEOTMBLRBDDVBHFYCYEXTQGOBPCCOTEMCDUAHDBLFZCCXHDAWWGLDTRIKNEYCIAGUNXIOKMKGKUSDVUBZKSCXUDYQN9AKPJXCQZMBVWPBYXYZOBFXTKUT9XGTHPQYZ9XNJ9GCX9GPLAAEGVJBFANJZZWNXFOHHAKBWMMQZLVLPCXGYSQFMXOIBLSQZJEAYCMCEWCEQJBHQNYCMBWNMZNKIXUGUTYTZRPRZ9FGSMEGPQVO9NQKQYSWPNSLUTMUIFCQPPH9ATXKJIOJUFWNFNCVJULKTQDPRBCNMFUVRHWUYAOXCMOEWMELWAOACDKUSUMTXDJYHIQJONVRGNKFYPOQVHPUQDJDROXHIMMVACPGXCC9GJPBGRLDILKXPZ9NBBLZXWYKCNJ9IMPKZKDSHOYXSVZBWAUVHQAYIQKMVTOCSDJJNQTAPHBYRBAERPHNRLDILWQYSQRRXDVRMLDMVEQNOYDDEEIEEJXKPFIUMJPKJRRCE9TEQRVHKBJCVQSCQCFYWSU9MPSILSTIOKCBUUTRZYXUWBUDM99CWHZEXPOOYVSZPSSRFF9PULOIUZNKINFTBKYFMVVGYKFYHLFTSENIKLHTFD9MOTNFHDNTTWYRIXDMBDIZRCMC9KVWBVSZKSGRSXH9UHAZKWKHVFLTORWWGQEZCRO9QWEHXXXGFOUUBOWTCNNVBJIIINPKURWCORIUXNYOFVQQPGXSDNHFQPEUXGLQPGCYMQY9WZBJXEAYUPTLDQGVMW9YMGYSNLWKUROWZBKYRDRNXQYOZBTZIZ9VMGXWXESMWCLUSQHH9EOBRJPWHZHXMTKUQXKEPAXNBITPWT9GXIYRPPYOUFYLCKSOVIOVAIPCS9KTITGIHDFDBXLYJBIYQTQGJANWY9HXMLFSOLTKXEEYVDNHRLTWXYLITNEWRVAEKRMQFPGIDKUONEGALTZAKNBXXOISMPCKZA9VPRVQFTEKMFHFQIEGDCGGKZMJHCZSLAKPCOWPBZXOAMYARSDIARETB9HKREMTYDZDM9PQUKFJBFBOPHWHBOSYPWXXNOBB9FAHZEMEHAISYOPTRHQMHHEHZQIEKXLUEOF9BCLAHNSCBHMOWVYX9SOJXJCVZEVIEXNXUGYUD9KNKDQEISQTGIZIJBCXXSABIUXSUTOXIXZDLKSVUMLWHTYWXG9IMYDAJMLNUDZKWCMWBNPLSDLEMIFGJRBBPJOXRDWEMNZXUQYJPVLPGCWISAJQVGKKZVOMZHTVE9UI9PKIQKBZRZPPH99EMCZRUOPCRFVDDCZXXNUHNHDAIRFBIORSRUABRCPWSFNQ9A9K9WFOUFHVSFAGYGOHFQNWVIS9EYHQJ9IDTKUOXQSVFR9NFIBBWLROVQILPWXOKRTDCPAVIHNTIJCCDYUPLFNZXHLPUPYQALCRVCACCSOHLBDQKCAQWHSLFDLMCPONUZFWWGRKHJWOCMKFQRSOTGSNBTDRLBCOTUQTJRHZXOE9PMZJEUIXLUGZMPTEBRYKJBHQCCYHJVUQJJPBSVRAVSEMRNETY9YBLTKGKP9GVGESJLONGJEXMOEVIBTMTOEWXXFZKYJAEGSUHSWICUPVVYAYHDOKWEPZHUFUOTOTTKHJYYMQUKLGIISOSJIAKEHQLJHRCDWQFNHPUS9AAGHQSLFAYHURZKLSYATLJPPAFCOJGPIBXJUYEBCVFJYEL9ODLAIMUXFESFZULRPPTQECV9CKVWEZCSZUTTGCBFATNBGAHNOZDKLDUKMNX9QGEUWJCPPXD9TJAGHAVQQVXHDIRGTIKHUUYQHCJDLXD9JFIAGNYEAN9OTYVEWSZRFSOUEL99QTDBSDQXMXXKE9QLMQDICTZQHMHYOXORJZAPXPXHCRXQQECWPZRPXNULUHGBNNNABRWFSOWAYLSXGWRGCHRNSN9FARGCZDQXU9KNOMUNCP9QDMKOVHAF9NIYLRUMGNAXCKSJHACOQFNKVGOXYQNOEECJKGYCBAUENQSTYFIZRAANVJYJHNXTFPRARAROQQQPHEVQTTCUKIJDKZQHFEW9GIHCKANMSSJ9SDSELWMKGKNLZCFDCGLQKCVZOKYJK9XWFOKBGNVIJRIJFBRZWUWX9JHSRIGKKBYWXXOPOFWXSYAEUOZR9DRCHFMRSUAA9F9SQCLMHENGTBBXF99KU9PKNPTJ9MWTBDFTSVAFCFZFHZXSSLJDILLILYEULYYXRBWHYGSBHJNKZJIEB9PIAOTMVUQLUVDWZZQZ999999999999999999999999999999999999999999999999999EUWIAAD99A99999999C99999999EJJWPHCLV9KKDOBRKCBKWP9SQSOQYCLSHBLWNL9BEPOLGDXNISVPZGYSZRQXBHJKAIAZAFJS9K9TGJWTWVIPMSMSGIZXQQBSLYJOZIBVOBVFPKOLDFMCEJG9JPRYDZYVRNUKEALKRPPGVSFORAVLWSFLFMWFDA9999MVTOHDRMCONUSSESCTMMIFDNGCLFFVBTUWV9AWUI9NSSLVZFKFXBHJMETHLXWGMGVXOKABSVOSFFZ99999999999999999999999999999999TCOEWPOF999999999K99999999ATB9999999RSH99999999999999",
                "IUZRCIJRMIYGQBHXFRDZ9SDISDOLXUJYUYHSHBJSB9JIKXQQTVQWYEFN9HVHZVISGOASCQRVEQRIPIYGW9TJFXKTBZRUDZVWWPMTWKCYHXSLHPCYBLUHPZAJMWSCSCGLBPPPEIGGNNZDFLZKNIGUFCOTFNOVHNVD9ZIC9DTECINORHMKSRQ9RQTGYXXMRATLOMXMRXIZCTXPYYLXJVMDLI9NWHEEOVMSLYVEINXAXO9LZDMQZRXYJXGLCTXQX9MXVAPVIRXRFOF9VLJAROTZYDHBMAZSDPUYHXFINZLAPJSIHTJOSYKK9EAMFTV9JMIPEVKBCRUAHBUWXFQMBPCDBJAJIOLVMVSFBEK9TA9SIXJUROIPGHCIKRUXOXABTTD9OKKQBSYOUPVCUTZLTH9L9UPZPWWZILHELHBUSXMUINMWMEBABOHXWNGWINMURAPEMNSEXVKKGPATAXXVTNNBLONRQDNPSP9JBJVH9WEJCSQCSUFCTZBFQYKYJKMVGKJWJMABY9UCQOTDRGCJTKFIUIE9PGMMAWMMDZER9K9SDTLDSNOGXKDCMQWLVBOXZKXAHRBXWCKQKSQDWBDLVFMHQQBURPYYMFBVCJWUPMVEIFNJFTZRZOMARTUJQTMWNBELWLKDZLJWVRMLCWRAHBKPTQEOXGLJOYBLZIKYK9TTWGO9YXJILVRTQFFCCOBCROLT9JKZNWHUAS9DBBTYWO9JGXTZXTCNJXZTQQFICFINQXURSPUNAOZIRFPLDUXMSFBSQFAELNMXDGYUDTNSLNDNP9UBBSSRQQSPBSBIOWBKDAKEFHBBRGCJUAUVXPBTFGZRWLAIMPM9DUD9RRDCIRUUSDDGKFPUPHZEFJQJVDNNIKEMMUEAMXCTXLPJMBZVEVERG9BBHCRMMMBCAWJELLGLHRQXZKKPKCREBMIOLA9AJCWDNXMVHFOOY99DDXOLDFBRICFDWDGMTRQZQSJVETOMRFECPKSIDANJSUISHOHUFZEVIIEVIKXXYWTZYEBHGSLBMMHGITLTLLALGTVSBNCNRRKKUTIUDAWQSMEERPJAOMYQMCANXTYADEVAXRPZEVVOWLNQOGTDDU9HUVJZWPHPXDXQZ9JFPAFYYHENK9UQERHRVARBQQ9IRFTTUJFEE9N9HEBAV9XYVQPM9OQPLQFHUFACLQLDZLRTMMOVYXCBXGNYYYQBYQHHAIVCFJWMCECNYQWGKMC9LRCWELVKUZCCXWXZSKCXKIZPUYCAWYFUYGBUDW9WCMZVJPSBHRPSQKJWICJBCPZCNOLNMHDCMWYRZNVK9VSZOVBLJXNTGRVEVJTCVUPGISTSVKZPMCSBZCZZLPHQMSTWLRTHYLRIQPWKYAHDNEKQSPHBZ9WLEEDWSDNKHHUKASREAHLPNQEJXVSBXPGY9OZ9GGLHFHDYYA9JGRS9SOTTUCOC9R9UBXC9FUHMTLU9N9JQINUBUFSEKCHNUDTKZMZUWPDHHGEI9FYTZXIUDUMCTWEPKD9QBCAEZCUQKHLUKTVZHNULJEFH9GDYWHDHOSYYZPCBNGOCZVUYMQGJBJGJLAHAHLVIYND9TZNQJTXEWJMFVXEJLBJYKNGCIQYCCJD9IBHXSFONUWD9ABSHXAGKRWRQZASJPXTPHO9ZUZJWVDN9CV9PGIXP9JJYQNNEODAQLBKFOUKJS9MBBCNCFFUTGPZN99JZXZAHNKFXHUELCKWVQBINZYLYESBXBOW9HNFLKCDNXYDIILGKFLQTYHMVHCXZQACYMHRMPMRTOTXPJGRJCBDB9YEAEWGGTKGVVBQDUWLUKIHVOAUCNXEKKDMQKAMJSRLXXDHGDGOEFMFMDBDUZHRQGAKKRPMKEFTUYLCUXQAIJEXIVAZVBRYJVEBDDEAPTFKFAGDPZNTYFEPZETAUOKZKBH9GBAHUADUIOOARTJHHOQHZDMYFUAXDAURUPXGZMOG9QEFZXHMJJXTFPONJKLZ9ISBMC9RZJIRUBXBHVVQAYGQATHCPGYELMGVNBCWD9ZLUIUUQWOV9IZVARZAXCMLG9DXNBQOKDPZRMAVKXSJEAGWQMM99OKLX9GZEFFFGUSOVCRUNAENLRSJIZIUDKRUIXDWXHYWDSSOCOFRVRVYAEIQJUKFGYWOGKIHHMDJBDTIG9JOQMJZAPNZFGVONDRHGDAZROPRTNBRHRBOVXWCF99KU9PKNPTJ9MWTBDFTSVAFCFZFHZXSSLJDILLILYEULYYXRBWHYGSBHJNKZJIEB9PIAOTMVUQLUVDWZ999999999999999999999999999999999999999999999999999999EUWIAAD99B99999999C99999999EJJWPHCLV9KKDOBRKCBKWP9SQSOQYCLSHBLWNL9BEPOLGDXNISVPZGYSZRQXBHJKAIAZAFJS9K9TGJWTWWVCRJCPQHAVWVVYB9LXHUBTLJHBUWIBLQHJWRA9CHMYHYIDLC9HXWNELBCPANRJXDFSAUOYIAYKVA9999MVTOHDRMCONUSSESCTMMIFDNGCLFFVBTUWV9AWUI9NSSLVZFKFXBHJMETHLXWGMGVXOKABSVOSFFZ9999999999999999999999999999999XRCOEWPOF999999999K99999999DVB9999999FFA99999999999999",
                "999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999YIDFNIWFHPVPDKBAFQULFV9DFAOCXEPX9JZDIOWVHEUHOQORBPKOONGSYUJVKTYFJZBZCWKTHMWTCY99WNSA999999999999999999999999999999999999999999999999999EUWIAAD99C99999999C99999999EJJWPHCLV9KKDOBRKCBKWP9SQSOQYCLSHBLWNL9BEPOLGDXNISVPZGYSZRQXBHJKAIAZAFJS9K9TGJWTWMVTOHDRMCONUSSESCTMMIFDNGCLFFVBTUWV9AWUI9NSSLVZFKFXBHJMETHLXWGMGVXOKABSVOSFFZ9999MVTOHDRMCONUSSESCTMMIFDNGCLFFVBTUWV9AWUI9NSSLVZFKFXBHJMETHLXWGMGVXOKABSVOSFFZ9999999999999999999999999999999DSYOEWPOF999999999K99999999M999999999IJJC9999999999999",
        };
        List<TransactionViewModel> transactions = persistAndMapTxs(trytes);
        List<TransactionViewModel> bundleTxs = bundleValidator.validate(tangle, snapshotProvider.getInitialSnapshot(),
                transactions.get(0).getHash());
        assertTrue("no transactions should be returned", bundleTxs.isEmpty());
        assertEquals("should not have changed the validity of the tail tx since the bundle is incomplete " +
                        "from the perspective of the validation code: it can't load all transactions because " +
                        "the 2nd tx's bundle hash already does not correspond to the tail's one", 0,
                TransactionViewModel.fromHash(tangle, transactions.get(0).getHash()).getValidity());
    }

    @Test
    public void validateBundleWithInvalidBundleHashOnNonTailTransaction() throws Exception {
        // third tx's bundle hash is invalid (all As)
        String[] trytes = {
                "999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999NSA999999999999999999999999DA9999999999999999999999999DDWIAAD99999999999C99999999MLKHIDVEN9KBPWKTGUY9QOQDRLJVSBAGXOBFHWIQRCQYIHVQIQJQJAUNWGHQBINDBAXBDBBJAZEXXGFEWZYDYXXVUSAHXTJBO9TWKKOHDTHMAKLOLPLWGEVPLGFQ9TDYWK9YRXLVWO9X9QEVTZWCQZOAAGOPPZ9999UASDRXHKLY9PRNTZSNOZLLJTMITWQQCJAQLQOPWQIZXXHOPBGLLMIWMETVXAXDLSAWTRQDBDVDTQ99999999999999999999999999999999MOUBEWPOF999999999K99999999ELC9999999XGK99999999999999",
                "JLFOCJEDMQIVNGMKCATTYBNZ9LFQDIEES9DRJWVODNXATXFZUVP9RBWKTPQSRPRTDAHACEYSAXADW9TCDJPBDSVPMT9UYIJOVGJNJHHBVYHJLMRZ9AXAGFUKMKBTQTZPXEVOBZI9C9EOJBF9QC9HPUCFLUIQEJMUNBJB9OZFDMPBNXMKZZTB9GBPVNSX9OTBQLCSRCGGWXLCEMDGHJFXOGEYBRCYPPNBAZQKDQBBLWAC9FMLBTXHGHYCYEDXBTRZSURCOTADOVWSXBPHTWVHGZARQDMDEUIKLE9YXGYFDGZHTHOFOBLALIXQFVQCGWGBYOAZDCARBHTAKVKMIWMJZPZWVTJP99XUOIATTKXWJYKTZUEASXGMOAYFIUWN9WMWSOD9MUIEUNUKAGPLVNREDDHNKRPXSOHZNMEM9MLGVVBGYOLAQHUTFAPOVBEMXFWTKRBMVNHVRQCKJYCSIFECFARDPTRJIYCFJIZUXDPUZZXEBTAEHUDPIXDTCAUUNHYZM9HYOGTOVEZSFUDBNSFCPMYDNJSOF99VQMFQHHDDGKPEFWQFEOUFKKBVDQCBQHLCSDZBNOYZNHPTBECBFOWETXTDCDZBXRKSKFQDEUGVWGSQOROYHL9RFSGMCNQOMBCAJVRGXEJCKHLJAYJWDNWEMDZPCGNAVOUXXSLGJOKKHHBMWJM9YSUHYNVBAMQOZMTXPKTKZHYXXRKCECEG9HHUW9OCXN9Y9QRXC9YXHXFFUDW9YXKHTUILPMU9ZJRNMZCWIOJULBZMO9JK9DJQQBPQKZFBTPKLZLGPZLLPT9YENZ9XUUJDTGWABUTENU9DNATL9CVCGUZDYGNOTENQDRVYCC9SLPTIOIYTMWOIVIFRVNXDJDZWORAYKAVFJW9MOUQNPDUU9HMPFUQNGFGEKMSYOL9YEZULCHSGGMXOMBGQKLGCLBASAODKEEAZZ9NEIVRJIZVRADKWFECCVRC9GGLPYOSS9NKSTFLVHONUELMLSBEVYSVDSXKNHUZUEHOPYDRTPTLEUHOVYKCVNZJTHXTOIOLBVUOFWSVQYBLMJ9EVKG9MAXDLAPGFS9ZUXDBTHFPHEHSLHCXITMUWFDDITSPAHZ9KKPB9AOJKZXAHVEOIWZH9ABSBZWPHX9D9CZKTRYSSQFIQLWXXRXAWV9LRBVYJXGDWX9SAQQRYVJBUQAPT9GH9CBEOZZQAFJJVKJPBJXWQOQFXMBBYNRENBXUROFJPAXYWLJXYKWYHMVAOVIIOABLSLYPFLCGQUVXUYYNPHASTOJMFIGLXIBRVBCKWMATISWF9QZX9QWNKQYHDDIQACCTHIFNYNIBUPEVCNGBFA99RKHIHFDSGNZXTOLMRWBJSKUXNWKEXSZPZWXCVLOOZTX9PZRCZAQFGAWVKUVKKZUZXNO9AXNNRINCNCKKSBCKNWEUAQRJKIMBPBOHYFCACOFBKTBG9QWFJQNJFFOVXHOPGHSJHWF9CWUALYGNCIUZIBYBPLNAUNZOKHMIHLNHKEGMFGUYBTCT9IROYGPSYXMZY9BYWBTVHEQVQTUHRDKOLPPZ9NT9VZGUFSLZOXR9DXNQZFPUG9NRQQLBEWWISCYPQWJSVQSU99RHRYDRKNJDYPQDFBA9HJXZYKLGOGTNIQFEHQ9YWWKHOMGHVRMLWSICVLZYBOJLKHMYBZNKNCRSQIFLMIBHDDGWBAMZEYPUJXXTTOWVWZFDRIOAGNLLOQHORTTSCVGNMICBCRWMMQSPOBYINSG9UBR9GC9IFF9BHAINTRJRHYERJIC9IUIEHFTOFPUOUQJMQGVZCWAOYWKGSNJBGKZBSIABXMKSGUTTHBWELNDVGFTFFAZCSSKW9ZZGYSDSNLZBFFJWQEAAQLUWXYAUMZILWHV9OZGBQGAUUJYKKY9EFYJFE9CPLWZYPOUMKNSWXTCQILW9ZJMWEMSSYNMKWPDUEGDMXMKWHILZMYRCKZAMUPXRUOBYDGNZVCXHAZIRAFNEYXJAMFASULCYBINVQHPJTJUOSBZTIKUVBBBFEGQXSXXHGKNWBCPVFOTHBNCPUGUDDWIZFWWSLIYISGUHNDVSFERROMMVAVOKYZFNKHTHEMLRUNMUSVY9SHZGAWCA9YD9IMKRMBUGZJLBDOGOGK9IAVIGMIJBPGHYDUIXHAWUSSTPRDMNRAIDYFVZISLBPBYYW9PA9BUVTDROLJHRPYHTHRRVVWXYBRCBFXBJU9MSHSSVFJBAOQQCPNXHFTUJVMSWMGQWEINDJUBSLWTRIDAFBZQZ999999999999999999999999999999999999999999999999999DDWIAAD99A99999999C99999999MLKHIDVEN9KBPWKTGUY9QOQDRLJVSBAGXOBFHWIQRCQYIHVQIQJQJAUNWGHQBINDBAXBDBBJAZEXXGFEWGOUYONF9B9RBHRMRGRSZRXBRQICYWYTTAYXLFWDTZVSLAZRGEJXMSDLGQXTWYDTFQFELBPFTTIKLA9999UASDRXHKLY9PRNTZSNOZLLJTMITWQQCJAQLQOPWQIZXXHOPBGLLMIWMETVXAXDLSAWTRQDBDVDTQ99999999999999999999999999999999PXSBEWPOF999999999K99999999MW99999999RRXA9999999999999",
                "VWOXEHNHJWLPZLBCN9PUOFB9GSVOUQLCKIADXOGZULJGEFMPMNEQEAMSBFBFVBOMTDEWTBWXNULIBHBEWKGEGNQMKOJAAQKSMZ9JWEZNQDLUSJARTILEHCGNVMX99PHZWNQALCGMTIJZKRS9HPQMMMMPQSPZDPPSK9BGSHFQWYECXGJAKFCFBGEQVRCZKU9NYHFCCDBDQOEQME9RHVQVXDTPKQVBPXXPOLSKSUXAGRBHLQZQC9DTATSKTPDZLVOMPMHHZTD9XEYWLLVHHSHOIMQ9WZJSFWJFARSLU9YBUTKWPQOJAHACJBTQT9UOUHUWMUVB9TZUECEBOPLEURLSDWBQGLGQNZKZBYO9RQSMVBAUQESEFF9DIBUHACLTD9VJXNQHZANKWXWZVEUPYQBMCIHPUSDHZSCRWBWGASUPQTJJBDNYJQSYJ9NGGVZERVJZCXTAXUAWXIOU9WBMTZHORRPLKUJTMFYBZMPSVZXISLYTZSKPAKKD9VWUXVK9J99TCSSLHYHAMIMGKEPREWJLHPLBGTZWCIS9LEXCDUHHOGLNYUSZDQWW9FBUHJUQROEKBTWQCXOMBBQFIGDI9DQEUW9OHWXL9MORXYPHVJRMAAGXRKFFPWUBHYAWMJEFA9XMJJLPMOKCWSIX99IOUB9KUYMZDBRIV9WPEJPJODBOO9AUIAOL9RRXTWGAXGLVJLXV9JSBTNPBFYRPZJVICXVLGSCJZTKICSFQYYOBETARURKBRYFC9NZYUCIVDBFWMMOAPBVNWNPNVYDJPOKTWXGQSTWDNTHDC9QKYOKCRDZDSWRRUUBYXNWMJWQDEUMTHBIVLJRNOXAOUIYWNJMKRAXLYXDDXJFK9CHMWVN9UBPF99OCXXHFHXXUTPFUFYX9JNZTSEH9NLCMAHTIMVDH9CQR9INEESY9NFQRRCIV9KOEYQFOICWLODVARBTXQFQXOQRPEUQTMYNPKWYDZYBKVPWMNFP9QCEKZSILBF9SSGQWWIH9XZANXWRGHDEDIPQQEEBRTQRKZXVSQQVKYESOXXJNL9ZKMCVRCFRAVDENOJMHWDLXGYJXWJYVAQWCSBRUCPUECFYSHTQHBYWXYXWFEZXKGUCSOXPX9GGVIWGAULMLKCOVLDESLQEBCMATJ9LRQPTVOWXHDNSLPCHPISPJVW9ZLFQK9CIGZXQLYQSTXQJJVAOCJVHI9IEOKQD99BSMQOXSKDJROQUYTLNLGSHYZ9HC9ENKQTRWABTPRLMVNFVYSBOXSLNHLOJZTLQPZUMGGUMUJRFFPLOUALLLQCEBZYZTVUMXVYSDLWS9PECDU99EAFIOMQEZPFCF9AEMVAE9EJNYHOZFHGMIZZHATKBSADOOEKWSQMRFOHSI9HCFKSNBGKWYEJDPQJVAWPLUJDNTQGBEFAYXPOPAWIWQLPHWDHRNZETAHZU9GLNWZSWESVERUQXMCIEWZZISLTHKESYPWRUCFOPQFQXPJUQTMEKXGH9JREDUBVCCWXCDTBGKNRNCRLOEUVZDES9GCOBKSPKJIJQQGFDPDCMIRRBNQKAXKMJEMFEJTCMLAJEMQDJWEEFEYTRALREQAEWVEKVIPPLZYAPUWWYENQNKOSW9UPFVPNTWV9VZJSYLTIPBIBHWJQSTSKGCCXK99BADQEAIDMMWSJN9UKTLDRDJOBXWXPOIOTMXDLL9ATND9ZLOLZXRBYNRX9YSEGPY9LNFOLSDFCUJPRVPLZTPPTDDNUQUPIHQPDDRBJYZNHLURQ9NIDLPGIGLPBXWSJPGNDBGEDWBZBDZOPLROUSUPEEIWTETPKABQFGB9KKORTMVIFSXGFGNWKZIDGDPEZTOQMPLAP9JTTMYFEQCBPEUBKBSXIFXYQGEDBVEAUAZADSIVVFEHDNENEYZEFACNBSQMRGCRDZFKXROALRQWMTFAYXQMONJUCLX9OMJGXGWNFARKZTVSWXGXFVPGZCPKKQYDBFXDFSMYGRNEYWXPYNAAVJDCNXLNWVGULSWSHVKEHGUOWEYJECHKTXUYFHYHJJGZMTYBPMSZ9EUQORCXCEZIEYKSCRKIMKWRCJPIATDDEGYZFBDUAFWLPYDJPWXN9MGOVJ9QQCDLWEVUFIUWZLZ9GBZDIS9JXGJEBKUTXQMJRPFFWDJTR9BOHBYGJITSCMRLSILKA9GJGBBGDFOWXDDPQSMUSC9BUVTDROLJHRPYHTHRRVVWXYBRCBFXBJU9MSHSSVFJBAOQQCPNXHFTUJVMSWMGQWEINDJUBSLWTRIDAFB999999999999999999999999999999999999999999999999999999DDWIAAD99B99999999C99999999AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUZTNONEMPPNESKOZGOMLTDDMSSUDVGK9FEXXGQTKOQDNYCRAOBOGKNCMSQVOKDYQKUVQMT9CF9WV99999UASDRXHKLY9PRNTZSNOZLLJTMITWQQCJAQLQOPWQIZXXHOPBGLLMIWMETVXAXDLSAWTRQDBDVDTQ99999999999999999999999999999999JSRBEWPOF999999999K99999999QTB9999999CLM99999999999999",
                "999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999SV9SCHGZVNZDJCFXFFJHENC9KONVG9JNXMIHLVFKNRFWUFFJRT9ADFIMHAXZTYAITABMURFFNWCGHIDUYNSA999999999999999999999999999999999999999999999999999DDWIAAD99C99999999C99999999MLKHIDVEN9KBPWKTGUY9QOQDRLJVSBAGXOBFHWIQRCQYIHVQIQJQJAUNWGHQBINDBAXBDBBJAZEXXGFEWUASDRXHKLY9PRNTZSNOZLLJTMITWQQCJAQLQOPWQIZXXHOPBGLLMIWMETVXAXDLSAWTRQDBDVDTQ99999NTNMNQLYLR9MNUDQITVBEZTWPMFWDGMQNOAJYMSFLMZKV9HBAQGTFPXDGNZUXOCNDDBYEHHUTHOD99999999999999999999999999999999OXQBEWPOF999999999K99999999KKA9999999LJJ99999999999999",
        };
        List<TransactionViewModel> transactions = persistAndMapTxs(trytes);
        List<TransactionViewModel> bundleTxs = bundleValidator.validate(tangle, snapshotProvider.getInitialSnapshot(),
                transactions.get(0).getHash());
        assertTrue("no transactions should be returned", bundleTxs.isEmpty());
        assertEquals("should not have changed the validity of the tail tx since the bundle is incomplete " +
                        "from the perspective of the validation code: it can't load all transactions because " +
                        "the 3nd tx's bundle hash does not correspond to the tail's one", 0,
                TransactionViewModel.fromHash(tangle, transactions.get(0).getHash()).getValidity());
    }


    @Test
    public void validateSemanticsOfValidBundle() {
        String[] trytes = {
                "999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999GNXKWQPHMFCEZZCKUCCD9PROQVPCTBVVAPHCLVOPYYQLQRMPGTQXBVZLKGGT9NXHUAASFIAVEOZTBSM9DA99999999999999999999999999RENGLE9BEAT9999999999999999FDKW9AD99999999999B99999999RJPQGE9AXNBBLPQ9IFJXFJTXJAIGDDXAWXGAVU9PJQNYFADJDIDBTJKSAEBBX9NWJGZVAVXYWXPCEFFH9DKZYSMJAQRLXZHCNPTJPJLOONNDZHGNTBIINGYKZQAAWF9LWQTHUQSAXMLQN9DKCQWHIJXNGLGQVA9999XIFVJWCABR9XQKOWCXJAZDZWMWWBVHROBOPISAWDIJTSFPVAUZNJUMNUCOFIBIAAVIOWDTCNIPRVA9999TANGLE9BEAT9999999999999999SVIDBWNOF999999999K99999999POWSRVIO9VMIJ99UGNETMNPNNNE",
                "YU9WINMHSBIJ9HRBKDEHZYOCDGOZ9HZSSVXAYYOD9AMAFBCROMLSFDFIAQKEXAVFDLJYVABRSONSTTXLCQJTSDRFDEXZIORLRSQDZQODNCHAAFUPGBCEVYNRSJQGUZRAQIIEZPFQGWPQIBMDVNZGQAKCU9VLHGYSNDPHCMOCTRYQOYHFPRQSGHSDEF9MSHGXYGUTHSBSF9SOSJQFOZXMQGCUXAYWLBJHXOHTOM9ITZPISEXLAYAZBHTZDDCOIHKDBL9AAXZEDFHDYCPXLDGR9JTVXDXBC9DRDVREEEVGVPWVEZHJBYQYTGDEWQHVEDTAVLWW9WBXOIGDGUAAAVKFMPVKSYBVOIWPYGCMACEAAHGUIQVFLFMSCPKTYQWJDGMDNLMDIUUYI9SZOFQPLKKACESSWIXPFYZWDHETYUGEVASPHBGQPJPWVESSUUEVUYDYNQUQURSMCEPKIHYXNFHZSHIIDTMEZQ9IPSHTBDK9UHRSIIEJRILBCMVUMGAGBMHKEMUUKQDCYAVIAN9MBWJCAUSSJRSAUEUBGEFFCFSOBVGLXBAIDOH9NXWQUSIFUINEVZUWELLVIOSSQRVHMTDBCATBWFSDJJDLURAUKEQEIRICSCXAOJNPWHQKYVTRLCRKHLFHHHPYSMUEAPMQPMPS9CHCIYXEYRNIOOGRWKVHUGIWJZIGPWGZGBGYTVC9UVEJ9JBIYMDHYXLWIDXHZVFCCPLYXDPQPJGMKNZMMONGNXSNNPCGEGRJTMCPTJONGPAEDMSHMGAPGBDWVCSCTJAECSHTEGBMVCDZMQYZ9IHERWGCKAIMFOJRAEDRDSWJASV9XYS9CTOEETPQHRKJZ9FPWTVCGLEJQJXVVDTYZ9DNSHQAINKROQQIPTFGTABEELYPBQHGNNB9NCL9BVTG9MH99BPIRNNGC9MQQRH9YUDYSUJIDSZKCIGEKFSJ9PXUYKVPUZYFIREUAMUZE9EIMJK9YGAZXZBPRXIRDCEVDHWOCFIJTVRCRZRRJGFLILKVNMJAX9MUMTXCWTUTP9NXBZUMAYYY9DNVZTCROBCMMHVKSQRXMGROCMMCDENWQWBV9LEIJONWTQXOUQZOTGEJHJELYZOPICLDWPHVCMBFSYHPIJYZQDEGYITVPYNQMXPRTPKADLUKW9AEMSMGIWCUMOQMUDN9HZGYKTNVVNLOQAFVETEDJMJVKYCE9RE9AJP9RMYFKGDEC9GIGAFXEXIYXPFBOMRPULVJMYTQEPDMMIABDHJGRNNCKADZAUFV9WCWFYFHXLCED9E9SKKYHVKDTGNCHEKFJL9YJHTSRUVKEPHPCQSFNBXKOJNGBSEOZLVVGNUQTRACVGEKDSORUHVSDSQNUZASWXRADGAUDYDPODDEDNDDT9OAEARSBLPVSYAOEYYZJIZIZDENQOKMXATCTD9NEFVQWNCET9N9IXWCCWHYUBDTDJUZFXWMATRYSGJUQAFKAPIQIIXVFFEFNLGDPAIGKONUWLUTQTKZJYDEGPASTOMM9QTGOMYHFUKMNEVWPCMTLPDSOEEWDBRHZPZJIFMBUTY9QPRLPSVURIRMCWLH9YIZBOTJQMMF9ZP9VCCEGWVKSSQNANP9ZXVCAFGAVBXDJHUMKTKUBZRNKUGJTVUPDZMUK9KZI9EKY9DQDUNA9ZVPCROKYYPISSTDOJZJXMXZWSGZBEPKAUYPBPUTDVQKUYXWYTZXLYTCLLKLJUUJGFFCMZFKDTJET9KEDRMWZSAEFCSXLMRHRLG9EKLRZJ9NZQEONGFQSKSQMWRZXWVEGHCF9ZKGQITDLGFTZLCQMXVGVYIPKSUPPAOIKVWARJHAEJUZOOJFCFJTGQZWROSCEQSITQWZTQDFKECATBWSIRDFVWH9TXXUVEBRRKOTFSGBMGCMZDK9BJRVEUYOVNSLZNNSTWOB9CFNDJHJENDWSTIMMSWD9HSA9LDGTJDJFRGQCWOHYJNMFFLLDMVQEMCMNVQWMOGCEZUTK9MPULTDMKTIVFNVWXDNTRHNREHEDWIZCCRFVM9TXCTLBLYEKTRVVWHKZDOSYOBNLEKPNXMDZGLSVBBNBJIBZYBXZCENKVIXMNGUJUYFGFYFBKELSBZROQWKMESZTWDEEUCSXOWFSNJUGGJANMJFCBJV9GMDDJCAJHWKYQFJLFWZESTSIRBZQWYHGQDFUUWF9F9HXSBZRKBDLRWXSMKW99KPWJOQYPMHB9KWALSVLFNANYSMNWSJLUOCBKAWAJHNWMLPLXHVEPTKBPWLWHMDZ99999999999999999999999999999999999999999999999999999FDKW9AD99A99999999B99999999RJPQGE9AXNBBLPQ9IFJXFJTXJAIGDDXAWXGAVU9PJQNYFADJDIDBTJKSAEBBX9NWJGZVAVXYWXPCEFFH99XJLIVAZYJGPKEHANESX9DORLEIOIFL9WVQBBNUDRZDGJMVSRTSFKOJPIMEXPBCPGKUUEKRGAXOB99999XIFVJWCABR9XQKOWCXJAZDZWMWWBVHROBOPISAWDIJTSFPVAUZNJUMNUCOFIBIAAVIOWDTCNIPRVA9999999999999999999999999999999RSIDBWNOF999999999K99999999POWSRVIO9VMIJ99FKKNKGPNNNNP",
                "COSNPEACSPESTKTUS9CSMOCWVUBLERQJQGLLA9AYRRXMOVOBULQZZZJPLNELEX9EVZDAFOHBB9FBAYOTDB9YGJAVTDWNPJVVGEPFJ9QBYLXAYZEETY9GMYQRIRAIPWMJUFMFRSQRCEIOWISMBJKGCIGIIYNMXAYLXZIBNKANT9DSQXPBUPWGUJTOMD9JKSNFZJJFBZYBWRWQIZFOZXQWNJTRZTUPHVEGTAOLMBEPXOB9TCEBNIWXQUHNQJZHAOWGVOOOTSCTEUEMXJUODZP9CDLCMEXAW9YJGVNREENETEYXOAKZVRJVUSCRUSRCNZUGUOLCNHQITWYPJVJGPVULASTONDZRDVCNGJSN9DMMUORCOIBTITSPBXSAVTOHSAXHMGH99APRTQIVCEI9NWYKDOZCCWBNZGGCUCISSMGJHJ9OVSFBZVFMBODKRKSLIDESGFDQITCYFARWYTLFKSPLNVQ9LTYFODCHBAJKCWVZNBLOJH9ABFGDFOXHDNHZILINMYMVZYWTFJJOLADPTZRPJEMGPFQNYTFDGOKMDTDSKPTHIDWLMRSSACZMTHUCWVZHCYSPJRATABZ9JHWEBGTTQORGFOYDWUIYFYGOGGTYGYYI9RPKPMCTYNYKHHNWQKJTDQDHTRUYQPMCDDLVUUHUBPWGPMNQYPKHDHGIUSXJGNUXIYGZRGVYPTTV9KXJDLGVVXRIWIGKZJVCQ9DUWAYNDRKYCGKZDEOKZQCXELSQXLGLAPBDIWRTKGSIRNAZ9XFEGMWOWLPUA9TSGYRDOU9GKY9JJDKCJKKGJCRARGSNECJ9SEVAGPPJMBTMGNWSLNSFBOEYMIQBKOVSCTDIWCOQTHBVTZOFNNIYKKJLAROKIRFFPCLSOWO9BVNNJSXEYLJASPUEFKCEI9SGWADNGS9MZAKFTCAYNRVKGDIGYDTPGJXWFAEFGG9BX9XCNBZGQULH9IPPIQ9VFVAXGELUMCTE9TOFOGCTFYBYEBFOKKAESIIHEWLYLQKWDHPYNELJKMZHDSDSK9ZWFP99FQFLUXGTSVDMGHIFZFUCYTYPVEFEDM9TOHCQVIBXARYWZEKTWEOVSBYZTJZRUFZJCLRBTOWPTKY99CYQTGPMAKFYALIWPEQLUB9RGANTKDDMSDSJOTNPFZCXKJUGTJWWPK9FAJGPJOEBRHL9ZU9XRBDJBVMFIZIZFGKETH9RJUSDIOWDZIXFOJLT9DSIAWSCEYBNOGOAZQPZKVZTBXGACCBVQGFNGXNQFTVPUGUOHNBKTUERLSTDXGRKZSATIRHDBSXARYATBHOLUHCQGPRMQGSJUAXUCWKDXAUGORHFVVVDZQEYYGSV9IUM9VTMHJCIKBQD9TQLLYTZHAKDHPFGYMRGJOEDJKQTBBNFCKDEPYTPWUJEOPRJWHAILMVW9AXS9HAT9GCGRXZEHWNDOVGKGPWFXFC9IKLVZJCTGZUJFRHGL9FZWZYP9TPOWGOUTQ9INYBVTD9N9OV9AM9GYRJ99MRWRWLOAKJXMDTFNS9NZQAYGVZRJ9WVSIDRRQLGKH9VPUVKFWZMSRVVLKXUGJAZESC9LEYDNNDWS9WTWNFPCR9YKPOMIJAVHCRCJVBDFWSTDN9BPJRDMGZFXWTY9GUX9WEPJQMXSECFPREXAJ9DU9OLMNQFTF99QYZOGDUTMBHMNMCNUQTU9FTNEUNBT9NQO9YADGY9C9LQR9DYVJZE9GMMYAOUSWUIVJ9EAR9EEFCO9SZTQ9JQHPIJGXIOQZHOSUSVMHBOLTYSEONVLRISNAN9KJHHFFISTYIHYVAMXLPNALDELETXVSWGUWOIVKNAKZKNNRVNJKE9WMNQBXFGXSYZQQSIODAKINA9CPBOGAYKJ9V9GS9HERXSVYPEILYXC9GURBREBCXRZJVXHUOPGYFLPIFBCOTMHFTAAUQUZVEKOWYFFGSCXDFDBTSGZRMPQR9EYSZYGQETCWFDRXVOXXCUBOQTBQGVLAONSTSLURFYSDPAVNCXNWVPQOUORMVSLYISQUQKXFYYMJSGHQP9VAAZABEAGJMCPIEBZQSYCPS9CNKFBDRDTDA9C9MVKGUISRX9ODVUJNPDWMZ9ESYXJ99ETDGSTJZMZYJEGRUWTORMCLNHLDQ9YIJWPMDYGGJQHMFPJ9VKINJUESTCBJQXFTCJFNUXPZONVKXJRAYGKIWHXSBZRKBDLRWXSMKW99KPWJOQYPMHB9KWALSVLFNANYSMNWSJLUOCBKAWAJHNWMLPLXHVEPTKBPWLWHMD999999999999999999999999999999999999999999999999999999FDKW9AD99B99999999B99999999RJPQGE9AXNBBLPQ9IFJXFJTXJAIGDDXAWXGAVU9PJQNYFADJDIDBTJKSAEBBX9NWJGZVAVXYWXPCEFFH9XIFVJWCABR9XQKOWCXJAZDZWMWWBVHROBOPISAWDIJTSFPVAUZNJUMNUCOFIBIAAVIOWDTCNIPRVA9999FTXZAEQIKGFJABOGCCQGOMKNASGWCQWMNIMRDTHKPJMTKDGMEQNZOAYARIYEWFZYJALRKFODOITTZ9999999999999999999999999999999LLHDBWNOF999999999K99999999POWSRVIO9VMIJ99UMGMTTTPNNNV",
        };
        List<TransactionViewModel> transactions = persistAndMapTxs(trytes);
        Map<Hash, TransactionViewModel> bundleTxsMapping = new HashMap<>();
        for (TransactionViewModel tvm : transactions) {
            bundleTxsMapping.put(tvm.getHash(), tvm);
        }
        List<TransactionViewModel> bundleTxs = new LinkedList<>();
        BundleValidator.Validity validity = BundleValidator.validateBundleSemantics(transactions.get(0),
                bundleTxsMapping, bundleTxs);
        assertEquals("the bundle semantics should be valid", BundleValidator.Validity.VALID, validity);
        assertEquals("built up bundle txs list should be the same", transactions, bundleTxs);
    }

    @Test
    public void validateSemanticsOfBundleWithMissingTransaction() {
        String[] trytes = {
                "999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999GNXKWQPHMFCEZZCKUCCD9PROQVPCTBVVAPHCLVOPYYQLQRMPGTQXBVZLKGGT9NXHUAASFIAVEOZTBSM9DA99999999999999999999999999RENGLE9BEAT9999999999999999FDKW9AD99999999999B99999999RJPQGE9AXNBBLPQ9IFJXFJTXJAIGDDXAWXGAVU9PJQNYFADJDIDBTJKSAEBBX9NWJGZVAVXYWXPCEFFH9DKZYSMJAQRLXZHCNPTJPJLOONNDZHGNTBIINGYKZQAAWF9LWQTHUQSAXMLQN9DKCQWHIJXNGLGQVA9999XIFVJWCABR9XQKOWCXJAZDZWMWWBVHROBOPISAWDIJTSFPVAUZNJUMNUCOFIBIAAVIOWDTCNIPRVA9999TANGLE9BEAT9999999999999999SVIDBWNOF999999999K99999999POWSRVIO9VMIJ99UGNETMNPNNNE",
                "YU9WINMHSBIJ9HRBKDEHZYOCDGOZ9HZSSVXAYYOD9AMAFBCROMLSFDFIAQKEXAVFDLJYVABRSONSTTXLCQJTSDRFDEXZIORLRSQDZQODNCHAAFUPGBCEVYNRSJQGUZRAQIIEZPFQGWPQIBMDVNZGQAKCU9VLHGYSNDPHCMOCTRYQOYHFPRQSGHSDEF9MSHGXYGUTHSBSF9SOSJQFOZXMQGCUXAYWLBJHXOHTOM9ITZPISEXLAYAZBHTZDDCOIHKDBL9AAXZEDFHDYCPXLDGR9JTVXDXBC9DRDVREEEVGVPWVEZHJBYQYTGDEWQHVEDTAVLWW9WBXOIGDGUAAAVKFMPVKSYBVOIWPYGCMACEAAHGUIQVFLFMSCPKTYQWJDGMDNLMDIUUYI9SZOFQPLKKACESSWIXPFYZWDHETYUGEVASPHBGQPJPWVESSUUEVUYDYNQUQURSMCEPKIHYXNFHZSHIIDTMEZQ9IPSHTBDK9UHRSIIEJRILBCMVUMGAGBMHKEMUUKQDCYAVIAN9MBWJCAUSSJRSAUEUBGEFFCFSOBVGLXBAIDOH9NXWQUSIFUINEVZUWELLVIOSSQRVHMTDBCATBWFSDJJDLURAUKEQEIRICSCXAOJNPWHQKYVTRLCRKHLFHHHPYSMUEAPMQPMPS9CHCIYXEYRNIOOGRWKVHUGIWJZIGPWGZGBGYTVC9UVEJ9JBIYMDHYXLWIDXHZVFCCPLYXDPQPJGMKNZMMONGNXSNNPCGEGRJTMCPTJONGPAEDMSHMGAPGBDWVCSCTJAECSHTEGBMVCDZMQYZ9IHERWGCKAIMFOJRAEDRDSWJASV9XYS9CTOEETPQHRKJZ9FPWTVCGLEJQJXVVDTYZ9DNSHQAINKROQQIPTFGTABEELYPBQHGNNB9NCL9BVTG9MH99BPIRNNGC9MQQRH9YUDYSUJIDSZKCIGEKFSJ9PXUYKVPUZYFIREUAMUZE9EIMJK9YGAZXZBPRXIRDCEVDHWOCFIJTVRCRZRRJGFLILKVNMJAX9MUMTXCWTUTP9NXBZUMAYYY9DNVZTCROBCMMHVKSQRXMGROCMMCDENWQWBV9LEIJONWTQXOUQZOTGEJHJELYZOPICLDWPHVCMBFSYHPIJYZQDEGYITVPYNQMXPRTPKADLUKW9AEMSMGIWCUMOQMUDN9HZGYKTNVVNLOQAFVETEDJMJVKYCE9RE9AJP9RMYFKGDEC9GIGAFXEXIYXPFBOMRPULVJMYTQEPDMMIABDHJGRNNCKADZAUFV9WCWFYFHXLCED9E9SKKYHVKDTGNCHEKFJL9YJHTSRUVKEPHPCQSFNBXKOJNGBSEOZLVVGNUQTRACVGEKDSORUHVSDSQNUZASWXRADGAUDYDPODDEDNDDT9OAEARSBLPVSYAOEYYZJIZIZDENQOKMXATCTD9NEFVQWNCET9N9IXWCCWHYUBDTDJUZFXWMATRYSGJUQAFKAPIQIIXVFFEFNLGDPAIGKONUWLUTQTKZJYDEGPASTOMM9QTGOMYHFUKMNEVWPCMTLPDSOEEWDBRHZPZJIFMBUTY9QPRLPSVURIRMCWLH9YIZBOTJQMMF9ZP9VCCEGWVKSSQNANP9ZXVCAFGAVBXDJHUMKTKUBZRNKUGJTVUPDZMUK9KZI9EKY9DQDUNA9ZVPCROKYYPISSTDOJZJXMXZWSGZBEPKAUYPBPUTDVQKUYXWYTZXLYTCLLKLJUUJGFFCMZFKDTJET9KEDRMWZSAEFCSXLMRHRLG9EKLRZJ9NZQEONGFQSKSQMWRZXWVEGHCF9ZKGQITDLGFTZLCQMXVGVYIPKSUPPAOIKVWARJHAEJUZOOJFCFJTGQZWROSCEQSITQWZTQDFKECATBWSIRDFVWH9TXXUVEBRRKOTFSGBMGCMZDK9BJRVEUYOVNSLZNNSTWOB9CFNDJHJENDWSTIMMSWD9HSA9LDGTJDJFRGQCWOHYJNMFFLLDMVQEMCMNVQWMOGCEZUTK9MPULTDMKTIVFNVWXDNTRHNREHEDWIZCCRFVM9TXCTLBLYEKTRVVWHKZDOSYOBNLEKPNXMDZGLSVBBNBJIBZYBXZCENKVIXMNGUJUYFGFYFBKELSBZROQWKMESZTWDEEUCSXOWFSNJUGGJANMJFCBJV9GMDDJCAJHWKYQFJLFWZESTSIRBZQWYHGQDFUUWF9F9HXSBZRKBDLRWXSMKW99KPWJOQYPMHB9KWALSVLFNANYSMNWSJLUOCBKAWAJHNWMLPLXHVEPTKBPWLWHMDZ99999999999999999999999999999999999999999999999999999FDKW9AD99A99999999B99999999RJPQGE9AXNBBLPQ9IFJXFJTXJAIGDDXAWXGAVU9PJQNYFADJDIDBTJKSAEBBX9NWJGZVAVXYWXPCEFFH99XJLIVAZYJGPKEHANESX9DORLEIOIFL9WVQBBNUDRZDGJMVSRTSFKOJPIMEXPBCPGKUUEKRGAXOB99999XIFVJWCABR9XQKOWCXJAZDZWMWWBVHROBOPISAWDIJTSFPVAUZNJUMNUCOFIBIAAVIOWDTCNIPRVA9999999999999999999999999999999RSIDBWNOF999999999K99999999POWSRVIO9VMIJ99FKKNKGPNNNNP",
        };
        List<TransactionViewModel> transactions = persistAndMapTxs(trytes);
        Map<Hash, TransactionViewModel> bundleTxsMapping = new HashMap<>();
        for (TransactionViewModel tvm : transactions) {
            bundleTxsMapping.put(tvm.getHash(), tvm);
        }
        List<TransactionViewModel> bundleTxs = new LinkedList<>();
        BundleValidator.Validity validity = BundleValidator.validateBundleSemantics(transactions.get(0), bundleTxsMapping,
                bundleTxs);
        assertEquals("the bundle semantic's validity should be unknown since were are missing a tx",
                BundleValidator.Validity.UNKNOWN, validity);
    }

    @Test
    public void validateSemanticsOfBundleWithInvalidIndices() {
        // indices of second and third tx swapped
        String[] trytes = {
                "999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999NSA999999999999999999999999FA9999999999999999999999999QMWIAAD99999999999C99999999FYMNZOGUJHDIXDWFTWWIJHLDTLLTHTAUHIXLPBUFNHIIAGVUFOVFSUELHWKXUJACKRQQAFXIFJDASYGNDVO9MLUXGACOSFTCSMAKOWDCGZKG9YPIGUU9UBEPFOMQSZ9EBBAQKSCIXPOQXPACDKYRHYIO9BIVW99999QEWVRPDBGRHDNLYXTMZHEFVYJAZJCMCHAUTIKRTBQSIGOJXMULHQME9PRNNJKRXNFXJZVMPMSUFA99999999999999999999999999999999DBJMEWPOF999999999K99999999OIA9999999CGM99999999999999",
                "XURKPSXXULFPFHFXAAOWBYWS9JIDCFYQPOPO9IQIKUIIAQSIIICFYQSAIGNPCABRQMINPVIOSV9JEY9XZMFJPGJXPPGVPCOMTTA9QASJSIVOGYJUKHRSGLLBLVWDXHH9UPNKCMLFCMPHNILIZTAL9TYFLZHYNIOD9APRAYXHLFKECHXNPUEBLHSPYUYMIGZATPD9AC9CWVGAIWYVPBEZETPRRORUZGCHFQUCQFMGSJASNJCO9SCVANJBATBQQGQIPZVCRSZPBBYCLVCVPJZUW9SJFUFHJJMEIZAWSSEOESGZKRBIRZESGP9HZXTFMWJPEB9DLTGYFKT9FTSZZJQLYBGGAXBXGIZLQTHCHKSPSDQPKTLMIC9TOLARBWMGYZSDDAKRGVHJWLFAAR9OEAYBWEAQRMTWOJLRQCDQQOUOH9RILYTDUCZNTHVSRP9Z9AWEGUJJKPUXXQU9ESIISDSFXGVJHV9GLFVMQCAC9ZYTPBJJIJHQONZ9LENASCEZV9KUGUIFB9BGYASFYSYQGXTZUDDWYIRSDKLHVQKSQ9CYKBWDBQJAKNOWWQXSFIHRVPQRUHLUIGDYRGOBUVHNLJXSGKTGVTQJNSZQQCKPVUUTN99OEYW9VVXEYQKMPBUNZQLCRNOJZEJBGFBFUKIFJFEPYDMSES9HWNWQAVZV9AKV99B9JALPSEJJQU9LUJOSLAVYSPCNKWTGWH9JOECVTBCHBIIU9SYDZJZHFGYXAPJDW9UECTTTZFQXWSWMHZAFGOQWZL9MEOGCMUVXFUMZMELPDSIYOGI9OHCCNNWUVNZLJWCMJZSGX9AMEPPK9KRVAQIZMODIMEKASUZEEMK9ANNODITRDIIC9R9CVTOKAVHPFQWMUHJGYFGFNFQMYYDBOPLIH9EC99QAUOZLBUHHAV9WKOLHWLQZWROZTOFDPPUIBJKLQDUJQOFEEBR9LSNOEELCSQSRKJZSCWGZVNVJACLQFJQZRSDUJYESJASO9NRXEKNLOYLXJVVAVJYIKRAGYVEFFZDDJDGIMHZTDKSAV9Q9LNHVOQHNBZPSOUMQ9VTGCDHTZDMXDODQLZZWEFYHTGBPWLSKRQXGXSNJXFHDWFPYIAOVFXERRJHULCTKZSZUAJXOVWC9LOUPJMTDTTMKNKDPQUNTVOEIFQTGFJZJDRPMYSJTWBOGZUMAVOQCREJHWOBDRGYQHSHEKQUHJOEJLFDRNTSERPVNVDKLQFYHWV9JULMOJRTZRFDXVYGBJFLUABVUHKHVHCJQUPZOSHCBKQVPEYKRLHTGZHDMTBBXHMTHXUBLUUBPNOOCJRGXJ99AQKHNCSXHGIKJV9SZRRMXKQTUIIE9MSXPJIISMHFONXIKK9TCIFRDW9RHDBECFPR9CGGNLUTYCPHPWORIQBDEHBYKTEVVPU9UVLRLPSITMFKOWTKA9FPFRPETIIHVRIZDRDHTDWSTYCEEXVOCEKJQHZWFFHTTHOLEMIHLSRNJGYUIBQQATEHCPAAYNHZMPOPFLFDZAXZRQDFNAEVSFWSBMZUULOANPYQMMRRYAUTCDTHOEGEYGLJSJJITBFGVTIWZOMYATZGSFSQPFFBCTEGQKVKLHSXQEBTYRFELKUHCOHGYBHPWKCGRFUFGAETJGLPLNILOBPIDDIJTLUYSWWKUHMVTRQNAY9GMWROPRNAXVIEXXSPRFWAUQLCNQEITDJNKEVMQTIFEGFRUX9FUOPNOYCKDBQPHSXNXZBTFFYHKGFFERUHLIH9CTDZLKIXJOTUJFOYMGLZRJLM999DCGOZQHAELODX9LKSFXPOIMSZUBWVHFLEBQF9XUVHJRCBDFNBXFKSDRAPQRDEWFXIINXFJRGIZDZWIVEYINVZQOITNKNXVLITHFDZFKQONFIJADZNQMRWLRNTFB9YAFNBMKGKRLOSFIEYKRDQXYTOPEFWFZAYPLK9WZTSHLWATJVZRIGKOKATPKIUKOQJSGRSCEMWCGSCBRMGNP9ULJBKEHWOVLQYPILWDBAXPPELMEJKIAL9HDDYKUEQFRYGPPWICCEXRL9FANWWZGMSLXCIKZV9SPCETCZINUUIJOGZWMSVU9PGJMECGRBDFWNDCZIVNDAENEHGIREQLASFKTXHFKDJWLGDGWCAPOAOXFSU9DDGZIELSTKFUGLUKIWNBPMVNGNJYLRGVLBMEGVMZSIYEMVIJBUMSIKZ9IFQKGNQ9JATMMTIRHST9VQJXXXNXSNXTWAWBYIWHPIAOHMWVAMYWS9MRLJSZKWNACOOBZQZ999999999999999999999999999999999999999999999999999QMWIAAD99B99999999C99999999FYMNZOGUJHDIXDWFTWWIJHLDTLLTHTAUHIXLPBUFNHIIAGVUFOVFSUELHWKXUJACKRQQAFXIFJDASYGNDZZEEQJDXPQDAOUKHKKDMSHVC9JKCABMRFYDEIYQPLXRVTQECJKIXBXRBZVMYQLIHCJRKNU9PASRW99999QEWVRPDBGRHDNLYXTMZHEFVYJAZJCMCHAUTIKRTBQSIGOJXMULHQME9PRNNJKRXNFXJZVMPMSUFA99999999999999999999999999999999RMHMEWPOF999999999K99999999F999999999OGDA9999999999999",
                "BOGKJGOSPZTHRORYRNJQSRTPEAVCPCHGCOKVXVXRNWFXYIMLSNGZSUTOKEHJVWHAXPFKCEZUNBSLLYAY9IUBA99JVSWEUWUFPCLDCABXQUFSHWMSYY9KJNFGPXIEOCFPHWVZSJJGCHATZMHZQKGDQTJSMPCMA9PTDWOK9KENNFGXVXHJNTVBTNNAYOMHHSXJKPFILVN9DPSWFJMLVVWJHYRDKCOG9WIUBJUHKDCRGRVRQWUUHIDCTTFDJINWRVRHTEIZZWDKSP9MYUSQEQQAGLTZR9ENGBAO9GNVBWNKKBDSYNKLXVVN9PECOKFUPSZAXUQDML9BTOPNIIANBGZOSINXEGHOJZHBLESUPPZFZBSCMCIZNODDCUZJTHRVMWU9NKDIVU9P9ZFWYRKELXWKYUAOZJDMJTTVYHJDWLBRFSQV9UCVKJNTWO9CSNYEQMXDEHOSDTHDTARPCRJMICUCRUHNPA99QG9PVOTNND9FBFZHEYXAEROBUJICLRBUZRGNWSXYHYNMZTFUWYBDIEKGGSRZMRUVSMMAJBKRCJOPPU999RUBSONKFZDIVXGOQF9YIEFKGHHHOORWXGASFCYUGC9LKOPYZZPXWW9RIMJBTUYOJYYXCLHDFUKKLIOO9GNBFVARA9ACNYYQXWJKOWFXZIOAUDLFPYABGSSK9VCURZVRUTBJMKFYJVWBQOUEEFOUPQOFZLE9LVW9IMHBYINNMKPP9LPXEXXNSMWICDZEUDQ9YPWDVUPFGMGSMTYZDWLJVHPXDCREETZWOPWQCVCWSEKDOOWGTRPFHYIIOCUHBDBGYXPLBRDFWJLGEKKHJBXOBFJCTDFTINAHM9ZOHOBHQL9BWLQMHTGFIOAXJOLTC9CCCOCNIKQKSCVZPOBQHNXNRQA9EKZGTPRDAZYZYJFBOXOJPLEYGOLMBKQWHXVM9WM9GYMRCH9KVNGGGOE9UBFRHDSKJWFREYECYVSWNW9UQLDMOMDDRLHOZNMZT9ABPXBCCAFYODUYIUGWQSJYCCEBKVVXTKNVVWOQVWGPMRJIIVWMJOCMZ9SDAXREZROWLRMKDS9OCMGGDWUWEINBVDUFCHOKBIGDBTM9XLLB9ZULPZ9AYJWHSWLXNMKUF9XKMNUDPWGAWEIYPVIDAWLXSMFF99CEAADIKBMTNDNWJYQRGZAELZZDALSFGGEWO9NNLOHIQQSQJXKOONZCBZLQYBAHCSBAZWYPNBIBACWKRYWOTGZNUKHCCHHPOFXCEEZUKRHQPMVKUMPLAZXSUL9AZDNZZOCVGWFREGNLAJYXOOOZFOJUBMRLYWFRCIDHLPNWVSWEQHRJE9IJKQBUPPNNTFZTABKWQSJZFQJGHMCX9YVROSZNSBDVWCP9CVUKIBDTPQZWLNETFZLEMAWLYXW9GDLTGEMYPNURGYPRUSEQXZTPOUSGWSGJ9KKKXPRNFCUNUYCDGJGJPDBNIED9NQZOCWYMGXFHUYSZYHJMXQSOVJDODTWEJPFXJYD9QRNCHF9NCJNQPGTSABDSBKFJPBEHZLQUDLBTAVIYVQJMRWEQUPVDFDBNXIVRGJIDOCCIDGGQ9UPSUDUKVE9SWYJELVTFK9ZSKDVCB9SQTZECDTMYNVRCUUOTWLZTWVEELNSDGNMFB9DKZGVLFXMJQHIDFSOTWFZCZLCBSOZ9GSF9YIRWWMKJWAKYZHHPCQZDUCWBYODDMNXK9DPFCLKMCBADXQBACEILNZH9OPCWLBSGZKMFESUXXMDGQPFZ9AHLFKVITXHPEUPCCANC9BCRDZPIBZOQPADQXKZPHJWTREKNXAGGOM9JWNHCRRWWOJSZWGVIPMMSUHFSYZTBNSKUKSMVPRYIUMUAIYHGTBZVDQSBIEASWTAOFFXFXVIEJEWGAIHNHWIC9JXZFO9QEQWINAMFG9GNAVJWJDYEGTZIAO9OCCKW9LABI9LWTQ9PN9RSJBWM99MXE9YMZAQEPKUGZEFJ9QCBJOTXVRBXGMVNANGWLAHWCZVTUTPEHRDORIZPDKYVGFTOCJN9R9Q9DCZERKIULFWILPOORWO9LFVGFQRFAPBLQYXDSFIMKNLXWIPHDGXZRTKQAFVUNEPYXNJQYIPKCDT9KSLPEJMINAQQQHS9HLYW9AKZRQI9XPZQADHVQDICN9ADEGHVZGHDBZHSVMTAHWWQECLITJVQLFCBOCDEMVIJBUMSIKZ9IFQKGNQ9JATMMTIRHST9VQJXXXNXSNXTWAWBYIWHPIAOHMWVAMYWS9MRLJSZKWNACOOB999999999999999999999999999999999999999999999999999999QMWIAAD99A99999999C99999999FYMNZOGUJHDIXDWFTWWIJHLDTLLTHTAUHIXLPBUFNHIIAGVUFOVFSUELHWKXUJACKRQQAFXIFJDASYGNDVNHPSJHWEHHMJERCVRJRSNYWDRILNLDWYHLXZHHKAOXZXIKGOWNQMOIR9QSALVVGAJXQ9XY9PFOHZ9999QEWVRPDBGRHDNLYXTMZHEFVYJAZJCMCHAUTIKRTBQSIGOJXMULHQME9PRNNJKRXNFXJZVMPMSUFA99999999999999999999999999999999IXHMEWPOF999999999K99999999IFB9999999FJH99999999999999",
                "999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999E9IX9OAHANQLSHHTZGIEXMGKLJGBSCNELJYDZZFPLJYMIKELJOLVZIFIMYZ9IRBEAOCCDYS9DTYCITNA9NSA999999999999999999999999999999999999999999999999999QMWIAAD99C99999999C99999999FYMNZOGUJHDIXDWFTWWIJHLDTLLTHTAUHIXLPBUFNHIIAGVUFOVFSUELHWKXUJACKRQQAFXIFJDASYGNDQEWVRPDBGRHDNLYXTMZHEFVYJAZJCMCHAUTIKRTBQSIGOJXMULHQME9PRNNJKRXNFXJZVMPMSUFA99999QEWVRPDBGRHDNLYXTMZHEFVYJAZJCMCHAUTIKRTBQSIGOJXMULHQME9PRNNJKRXNFXJZVMPMSUFA99999999999999999999999999999999PKFMEWPOF999999999K99999999MZB99999999X9A9999999999999",
        };
        List<TransactionViewModel> transactions = persistAndMapTxs(trytes);
        Map<Hash, TransactionViewModel> bundleTxsMapping = new HashMap<>();
        for (TransactionViewModel tvm : transactions) {
            bundleTxsMapping.put(tvm.getHash(), tvm);
        }
        List<TransactionViewModel> bundleTxs = new LinkedList<>();
        BundleValidator.Validity validity = BundleValidator.validateBundleSemantics(transactions.get(0), bundleTxsMapping, bundleTxs);
        assertEquals("the bundle semantics should be invalid", BundleValidator.Validity.INVALID, validity);
    }

    @Test
    public void validateSemanticsOfBundleWhichSpendsMoreThanMaxSupply() {
        // both input txs spend a total of 5.5590606e+15 iotas (douple max supply)
        String[] trytes = {
                "999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999FH9999999999999999999999999TVZIAAD99999999999E99999999NNCVJFWHJ9ZPIBNDRJLFVKDCTXUWDHPTBOJEFGYSGFFFDZFCICIWJOCKQAQHHJCNPBIGOYIBRGZX9GIFBSZFYEDFIQJAUEKFZPFYCXXCGFJRMCWDIDRZCYGIS9GHLJXNKXGTZVPUITENUGCKXTANYYWTBEQRC99999LONHLGP9D9NPCDVSEBWBDSMXBCLA9FTDXEZTXHEEYPCLPZQX9QWPBGVS9KVLZZHE9VCSVKRWLCJGZ9999999999999999999999999999999C99SIWPOF999999999K99999999UZ99999999U9WA9999999999999",
                "KXGSUZZMAHEDEODMIIILLMQVE9RCGSAHDHAKYXCUATIASAPLFNWTMK99ZBINCNTRERUOPPYWWIRMEPKXAHZTJIYMYSXUYHUAJULUEVBY9CUTHDTTGVOFOWVQHFX9CDRIDVP9YNEKBQISKCDZIIVFOIOHSQ9UKUQBLBOUYKOJDKVWKUHQPAFEEHEGMRUYAZGZABKXXEWCDMOFCIXYOQVHNTMKOTXNRTV9MLHWVOTHLJEPOYLKGHYLMSHWFIMPIBZJJDGA9BRPVMXPH9OIBKQWUFMEBKSJBLDSJJJRFMMPACACQBEYZX9QDBFEIADDSPZVLRECSTBVWWYCFSVXTWPBHJQVTHKLWGBUHSLZGHPCDEPKHWKAMTICXYEX9ITERIOSJGEAHOZW9QNFMEALCHKQDRBGWDVCSGJRSNOCLFPWACAUAYECMEOETPQOAVNFRSTGGXIDZVBKUAYMAXESNTJXMIEPYRAGVWLQDQDSKDXKK9ZPAJCZGXBPQIPPAWQKMEAIZXJQFV9KIFXPCUHABQMMQYAJXHXJVXRPIEPEJTFCYSRXBZCRRIWDWHDCJYXLYVIDOGOHAAYQHBPXCEKSGPQHCHYKU9LTQOQTA9BD9PCYGJZKTPAATFNZQFN9HNEUWSUSA9VWNSEBSENHTORNFGB9ONLGPWSLYDPXFLSGI99YWNAXNLEQRUIWKCLKYEAYVKOZWSVQPFOFOQHOZAGENMSJHEJPCMZQCARQCBUZ99NUGHTOWXVKNFIFDNSN9UIYZCEIWXCGZCWMUN9MONGAROLRWDA9GYDGULPREVZFQHECSXQDOVOBLCWRHEXBXXVJRPRSMYYEMMGQMZPJOGEHXBIFCXJXRPV9KHRSVDGRADOVGARWXCDGN9KG9WEGETDWGYYIBAOZSWCESQYAFONECZHZXHXWSZIT9KIDHXOLDBH9IWUIVFCUFHDMNJRDVSRESJNRMFTCSYZRDTDDJVQUMV9PMDZWDKEANJSIFBX9DMJJKQRDUHYGA9MJWJGJEWYZACJOOSIQONBPXONCCSGBCTLSEMETQTAABIOREIUJDIMQPAWBMRGDLDPBDN99MRXJQHDOMUQFAUIKNXFAKBNWUTDOOXLSN9EMISMNSYYKSZRVEY9LYBBAXY9IOYWLLNO9XGGUCCYMYEGYWIUSQ9LIGVHGLWYQNXVQITNGRYUTIBZELNY9TIZRGWVGGGDNCDEDYGALRYAZ9ZLXJR99NGVWMMORGDRITLNBENKNLHMJGQAEETXFZUYNCAWKLENFLDFHLLILYPXARNPAIGPALVJW9TPYYIOZAXVDJLCFL9XJBSHJYWAQIMAUFDQNOJHRZCWVN9KJHTFCIGVMOFXVTOIXRVCKJCCJHCWHMAZWWOQE9YA9SJOMXPFXEGNWCYFRVBHYQIPDX9HSGPIZRRQDDEQIOUA9GSDTTOWEFGTRVSGFOUDD99NMDLPZOWLADTJTAIPIQKUJSLUYKBLCWAPYFUNPHXIWDGVGNYAALIXGLBCRZGOK9AP9HCLPNBOHT9ESCKCBEPKFPZXRYITIWOCMZQXZABGUZQOOPLQXJHJOHTBOKIFRLGBJIALVJPFEKWU9UNSUQGPQQFSBLU9YQDMBIPKLSYH9FECBHAOCAZIONBMHBJKDVPZPHFKYTQUYZEFYTUHWAHJPQGEZYQGZXZMFGXNHWDOSDXDFIIQNPJSRLSDBWSSEJIR9TBGDZLZDKSMBKLF9XPVMEB99ABCKV9RRISAVYDTDNLEFNDCIYPMYQQXDQGRPWCRKUKFYMXKZUCMLFAWRCBTSAHRYDOVUWOBPNGASEDFFQPPVYVCXBINKEZPHIYDLJLMWFWPXYGOZKXCJXBWQQXDEOXXLBVYJUQEOXFLDVUMNRBIZLHWPTZINRTYWZCQWPFIYYKGTXT9ZVYMBBQLYOYTOAVXEEXNBSDSKBSIUUOCHLEFCG9TCOAPTDNVXTVKOOFNKFRHSPNMUEK9DVTNLIRBHLNUGN9DNQYMNYRHNPKYNLNJXLWHTZHVVFSRLOUTRDKNTYHSDXTXJWCJBKKBENSBHPLGZOKFDKRRPYNDPHIGYFEZBAZXDKLPNHUFWAXXBMZQYWNEFUU9VVYSW9WKBAJIAPOJVJKACLHXKHXFENHXEEOPIVSFNLXDFGQWMEUAOJQNKKPJDBFQDKSWXUKNLQEGIEYVATBHVTDBUMUHR9CZHW9YMRD9QABDXWZNXHDUOIWIUFGIYLNQNWCKJZFRRTOWBKLIOMDBADBSMPSDPHSMEGNIAYPU9NNNNNNNNNNN9999999999999999999999999999999999999999999TVZIAAD99A99999999C99999999NNCVJFWHJ9ZPIBNDRJLFVKDCTXUWDHPTBOJEFGYSGFFFDZFCICIWJOCKQAQHHJCNPBIGOYIBRGZX9GIFBLBWTWVMIMLTGHZXVEVWBYESZYUVDZZDNHGRSJKYPOOIQWTTDQXWGCEPYWADZGPBBSUQJFVUPONGB99999LONHLGP9D9NPCDVSEBWBDSMXBCLA9FTDXEZTXHEEYPCLPZQX9QWPBGVS9KVLZZHE9VCSVKRWLCJGZ9999999999999999999999999999999AHYSIWPOF999999999K99999999ROB9999999XFEA9999999999999",
                "99DMGDFUWFLFMDJBAWPTKBKWQPWBYNBMQMKUKIZFXEFSYFJZTGKCGPEZXRVZPSOAOOQINHPLN9KT9DVKWIHFHMTQEWSASOPDGORDKFOGITTYGCHILHNKJDPKYAYHKRACNWVBSU9JJFBPWYDYOHUBJ9NLTKMRFAX9OYFFBNQEAUQRNFHTPOOONTOLPLHJGZPWHHKRMRJWMPUJTRSQ9F9JHOHHCK9TQNJKUZEPYHBZLWWCWPGAEPXVIXQIOEMXQACIMDNFTVFMKOIPLYVKNHSNZILZUSDUORKYJWBXBMLYTIYPDDT9DZWXWXSCLUQ9MPOUJCRCLAPWBQCQDWMVPNFZWXYHIUMJM9VPCWNQANQKCHUKKRXP9CJU9AQWVSLZARS9SERMLVTNPLBPNROQPIIJCIR9QBPRJPOODEPCUXICGGRVTTKYDLIPYXZRJAHGRLZFJSUR9QBBUNMKZBDZC9ULRQKLQLPWJYLBRPXGFYVQINVYIVOZYKTJJOENXDVJJAESEFTEFX9YJFNJCIEGGLQBFYSJSAOZJOIDOXCNCTR9INUHST9POAAOCWXEULOEMIRIFBSKTESMRRZ9YHKAVHGWWDKMJQDMOEBRFF9TRUZMYXPLSYRXWLJWBT9BJFKCPJSMUZASQMZDHTTPJWKSVFJNAULVZRSXVJZGAQYG9ZEOCUVAWDBLAO9IHU99AQUEXYDVVWAMHKRUZMEEHOPJUVVHYBLTC9XUMWQUAYP9ZGMUOQLLYCZMPXIXDXTOJNMXNSUGJSFJNAJVBBOUMRRTQGNWCBTZTQGOYUXNQDV9CCVRTZNFNCTEORBKDEYXRFSSCWXOF9HNJHCCRYIFNZNSGUBDIVMEQLSRDWIFEGXSLEHISYGNUUVGUTZZGNBJET9EFMZDHTFSQLUKWWVYGAZPYWYHKDLYHWDLGSQNHWDYOSSXNZUYVXBVDCZHDDXQDPSHEMLLNRDHGPPGJSSDUAYFKVHFDOHLSQLOJVAFPGHWLCVLHALYPBJYPBAFZU99NABPIMWTSRGQSEERKPDMLGGQQHAIAWQGJCACDWROPEYQMWSV9AJPYQUAHVHZVVFXJBSVIRUIMIBTTFNWSPNDPLYNXYDTEPQLHTMUCKEZL9EXFFQBGJRTAXVGULJOXBYUVHJKXWWF9FYZZJJYKMWHIJNAIUDUGIY9QZYRISARUJYMMUHLSCTSIQOGOQGHTXXXZHMFGR9UO99KFMZAHOGYTUVYMTVVONXDGLVYGSNLAKCEXQIIWIMRPDCOLAFEFAMQDMZWTCYBIBQNAAANNWWUBWDDAEWZXTX9UUKXMIHXUMVCWMTEDVRYKACEUK9MEEFIKMTCTGGTLTOAROYQAJOLVORHT9FMNXJNIMKFMTYPDTOZOHHXPIIC9RKTHFAARXRAGAVTXTZVSKRJLCVRWRCW9A9VQAWYDBXATDAPJLREXUKXTWEVZPA9MHBVDAN9REXAH999MQXMFE9GQNNDMPSAWX9MSNPSKAQZDRUKTTJSSSRMFRPTODZWLMVUHLYNGPSJAGPGJVWGOUDVHML9XOPZCXOGGTUVYGHZMKYTAUJUCYLHXKYWCOETMUSUJ9MQDCTTLXIISVMNHIVXEFSMXLG9DEI9GLKBAJGNYARDGPYELXSAFIQLLMNIYAUURHYGIDRIKVXAOZKWCS9GAM9BKYQITMHKIHBWXXIYQBJJSWTXTIWBARTTIGRKYMSXVAFCPCLNUGXRLGVJXGWPNKPAFMQNPZDPEINKCDGPVQ9TGRDBRRIDIZDAFSWOBNWSMWVEGDEYLORYKKBQGJPFOLBGKNLIXVPQPAULLFGZRHVMYJDDZHWMCHHEDOQLALBORFYPYDDGZIEQLZWAAMEUZVWLOUVDBVOHNIYDNDTKLNFKAWRQLZRK9FIIKSZAHMJKDJRGLCAQYEHPBZWGSKJMDXBNLVROVTIJLWELPLEBYHHCGBYDALUKJSYUSCVZBLYZPKUONWGTOAQSGGOPXCNCQEVWTCBACXXDZTEQTX9FNWXAMSBRGIQUZYBXBEWHA9STBMIMQRCAYTRWHLTNBHHSEVGGBWSOLBVYNIJJYEVOPEWCUSSNPGCFJYBTOOGQLRRYHWVAXRTBQWUDSFFZMVYMHSBXLJLDAK9VZQCQHFMBIVBQSMZJ9JSOPAYTOBLNLDDCXSJVUJBPFXFGAZXAPZCBOUQPECZUMUHR9CZHW9YMRD9QABDXWZNXHDUOIWIUFGIYLNQNWCKJZFRRTOWBKLIOMDBADBSMPSDPHSMEGNIAYPU9999999999999999999999999999999999999999999999999999999TVZIAAD99B99999999C99999999NNCVJFWHJ9ZPIBNDRJLFVKDCTXUWDHPTBOJEFGYSGFFFDZFCICIWJOCKQAQHHJCNPBIGOYIBRGZX9GIFBTLAJVNMOGTVB9PAZNPAEHXIQEOGUODRNTKCZOWLCKVUPPVOOROSYRGEUYTISBSSHMDTFMYQFNDUMZ9999LONHLGP9D9NPCDVSEBWBDSMXBCLA9FTDXEZTXHEEYPCLPZQX9QWPBGVS9KVLZZHE9VCSVKRWLCJGZ99999999999999999999999999999999AXSIWPOF999999999K99999999EJA9999999FQVA9999999999999",
                "BGEAHSJNHKIOKVHPPTLOULJZERUSVSYXXEGNIVWGLPFHPRPMEBXQVGDMV9WORVXESZZYXWCXSWIWDY9AYNGC9SUFXJCDIAAXETQMYVAXHVSERUWCPYIRWWXFSCL9CEFCLEGABQOAWFLYCQZM9JZWEWLEVWNYFVENZDIDWEDNGDIBXTTLXBBXSFUFQAAJOXXTQBWL9XVABFBDGIJJEHTQOKWOGQXVJV9EQMGCXQEADNODINVCKCWOJCRCFVKIQPTL9GDYZHPOHFHZLIKOCBVPAZFV9AENFARYZPSIUJSG9WABVEDMRKXYDCYOCHLUQ9QIENYCIHEJVBCRUD9XJC9JEYIYCYKVASHGTFOPWUOMVQVDFUTPJTKNBYWYDQPQ9IJWAHRQRSRF9XHRQWUZTGHLWHWTDGNZEDGTHMTTRAAYTKWCCVGRGCEELSCUIACONJ9OOFJUSFJDMVSW9OAUTNQWEVF9CQWNVYUSJESKHCPHGXFYDXNKSKYDI9LTQIXGR9XIUBXRRVQLIZODTTVDHVTSLLWTAPHRIFKDJULZPDRQVNQFCCSJHCFEIDCKROSPQGOFG9AWGAXAIIZLIPKOLZOSSOMODGCQCNXKVKJVLPAUMLJGNNLKAHPEOXWMVLNYEFSBUTVZFHX9BAB9GMYHLXXKQGVAOQIYOWWNTCLVUKNPDNAIFRM9GRRALFCTOEGAVZHTUCWQVYHTBSENMEHZ9KBCHXAAZHJSULFHZDEDZLMP9GIUKWKPKKGQUJCCCIFOHVNE9REVMVEMJLGMJCYD9EO9FZZYJYVPNILBSTDGZCRCMZABJJMDUESJDAVRFCHFCHUAMYWNYQHJKWKJLKIBXONDUTKZHUJZAPQYFPVGPQETNKVXIBERZZZLX9NTVLCAAXXM9HXYZZWAI99ILSMRYNJVWMYOTWRQWDMKBRPOEOUJJVEZHFCSCUSFAJQY9XTAHWDIKVZLPCXDIYDWWUCKBWQG9KIIHJOOHTTBUELONRJFASVIVPKPACDBVBKBK9PRYBMGAZNGHMKEVUEBVXVUGIKPRNWEAQHMCIMNZBVZFMOTQBEEWRRHPJOVRZMOMUJJDKCEGJBKMYWSWAJICJTPAOQADDEMRMD99JLKWVKDRYTHLMCBFDYVSBOKOVSXLXONKIUQKIAHXZFCBRPOIIGNGFYCKRMJCELEOKYVPWEWUIJGXQVMHMJIPDBUUFKUJSVUQI9UPMFXEZTEEZSCVYHYHPREVPFKZCWTDCMEBUIETHINVYOHADFNJUHOMOGHQWHERGODHNZHFBWTZV9RHK99SZFHIQ9IASAPLNKFSSROIFJTQBMAEQQJMLJWLBQYTVEXSQU9HHTJOJDTFEUOYZFLXQYEJFBIQRUTFBCQXMMYVS9AMPDZGBFOPFKCMRGLJLAAAKPHSYRUWEISVRPYZBZVFVXNGMBYOSQXJSVGAETB9NGONZNPZJ9JWBSCYEUSOXGGZDFZGYFJBQVZDTTHPPEEKQDKACJLSXYFNWCV9GAUAMXOXIJGOJHGENCOVVEAXW9SJK9VACAVYWWQGSNAUDGOJKHDTDEFKAPQEVZQZNXWDKLIUVUOLJHJMKKRDIPCYTSUSFFCTAXZYQWAJJKGTVKYLLUYCN9M9YJFEDRFZYVHEIJPTKDYUQJK9NHZDWKSHZPXWBTAUNTYGLJBPVOBNFPNEHXCFLIWBZQWPATICADDAJXDDVRWRNNIGINJJCYJKEILFPZPBBQPHNW9WMOP9DBBPRAGIXBTKXPYDRFKOZOQKILCQLULKKIKLKRYZDJUQGZHWAYQHTLQETQHFUOXYQDIHZANYMIK9IMZGXBMPI9NBGETXCIANROULMRT9EXEPQ9DVCLEOLAORV9LQKELFGGSAFPGAZEDSIROWUSACRCHEWJROIOHSNUKEOPRIGHY9WPIHWBHGXDUZQCQMLDLQ9OGHXHOMYRXIFCLO9VXERINMTVSEUBTWIGVOPCEMLWXCUEKZRDFLHLMTRABUVTTQXU9ZKPICQYEKJSDROYUCKTSPOQOXKUGWIVZQSVRDHVUCPJZMEPW9ZV9MHAOFHTFRZSBFMAKLFWXOQVULNJSYZNBYRIFFDPJSPOHFTPAYZMMLCTRSTEG9ARKUD9NHZKPQDGUYOASHXQRHBPKKRRUHSUIFONGVGMLZNNKXGTHDEFDCOBXYNZPAILOYKKKSJCRDVJDUPUP9HAQ99WSBMUSL9BEDOPCEDXMDHCXYWDHLBKFAGAJRJYOGN9QQCOQ9GFBVQLFEHBSVT9COEHWNNNNNNNNNNN9999999999999999999999999999999999999999999TVZIAAD99C99999999E99999999NNCVJFWHJ9ZPIBNDRJLFVKDCTXUWDHPTBOJEFGYSGFFFDZFCICIWJOCKQAQHHJCNPBIGOYIBRGZX9GIFBLUDTS99HFLDFFRGFJAER9D9EYRGDZYYLPS9RRRVEFRUJKLGOKPVUINKK9FUDJNCXYGXXPBXUCGUOA9999LONHLGP9D9NPCDVSEBWBDSMXBCLA9FTDXEZTXHEEYPCLPZQX9QWPBGVS9KVLZZHE9VCSVKRWLCJGZ9999999999999999999999999999999VPVSIWPOF999999999K99999999JHC99999999UTB9999999999999",
                "9KSIB99MR9WBQTXKCRQXVNTQWUFIJWEQXZHXL9TVPKLMFYXXYNFZOKKHWUFDHHGBVRYGPIVSWAQNPPXJ99OENCNRCNMSK9JTTTFVYGHUHBJTRQZQSGMAZBHZMJNUPROQVTJCMSBJTEGHKBWKPJHECAIHPODZQRUBOCUGXFESFEUELFXGDBBYTYDQKFHNZBOBSRSOZXHUAI9SQTZENCNQAKUTWQEKPJCHCSMCVSSKLFWMSLXULPWYBEZGZVGESJDOPLWDOTAVF9CYPMLTHRFTLCLCTQUQVFHRWIYSCK9CRWEGMVXMYVYQDUSFANAGAQGIQFHY9MBTZBFLZHQKVYBQPZBOFYTXYHKYBR9ZGMEYITFPLBOTSYLTDWIIMJIASAU9PMMXRIGWLONO9OWCHWRIAMMXRPCDS9JQQPWSKMWFTLTKLESIOTMBVRYP9BIPLOMBXNGJZLZDLKTRXXXWSLPC9NACYHEZPV9MCIBT9XPWJNBBLIJSZLYIRVKCCKGGPNATTGPWLISB9ECUZGBUFHIYWB9EYODHVCEU9WZOBVNXKQANHQQ9YWGXITWXSHEGNYWXGQVSHQASLUD9YKYAZHP9LLYQAXLONITBAZXS9HDXBFBZYNFX99IPJIWXXWQXNSZMWTYQXGMBLQPFKHGWYWPJEFKUSWSPVCVJQSOUXLWLZ9PRPQMTSGJBMYEIHVDZMTORVWFEEWFZEPJIPZKJPNSMKXJUDZWUEMACLMULKNZWBSXNQNXWMIQKLDHEKHGOEVIYTFKZGYHIFYZJKXWG9THIEOLUSWFOXSNYGJKTWNYMKWYREVPDX9OAWMWLPAKOTF9E9ITOPFYIOFSYKHUGDJDPPHYVXFZYCUYXJ9YCLNEMTEEQKE9TKFNHVEOCHZCDDPHWYXPRMCLTWMNMAVTQUKULZSJUMIPLMFL9DSMPMNMESIPMSW9QNTDEXHEXYMYZHKACOJKFXLSXHIXZYCAIXBSFULZ9WCWGWNDJBCICSJZCELRJHZBHNXBQQHM9TXFYJMUAGXFPDNQLZFHHWLPJANXVKNSSZVDKWM9QIJNAABEOOXUNZTDKUCFUJCMEOQMTBJKRIFVTOMHMKTVDCJSVMLGOOBVFRFHH9OMLU9NXFJNDENPDQ9SQWEQXPAHWEGYIETBXAFYONEZHIEGQXLUYYKWHTTCABPFD9WP9IZBMV9HNWUZUAIHAD9OUDQ9VWOETAUXFARHTJSARVWMFGGXDZKCYHANULHSNHKLIIUYFUDIAKKLNDVNABLHMYFPHNQACEPF9C9FJXCAIEDNNIOH9VRD9AALVJDWZGQOCHCUTXAETZTHHFEEEJZIKOANNCHUNQVMJRYVLQEGRRIJOKQRJSYXGXROJDCEXZJ9JDDKWUUOJYTLIA9DQPYOTXMSPGQXPHQVLHIWNXLAVSEMXNMVUWDZYBIXILHKYCVKJHJ9BQUHJNQHFGUCCD9FIIHKYPDMKADAVXIHGUHHD9OUPHJN9JYWOEOJXWQCPLYFJSDMGT9VNYSTNMSKALPEEHGIPZNHGYZCKTPWXVCDIPMOFCVEDEPEGSQLBUSGYLRHWIUXEJQUJRYJFTYAGAIEZOXHTKPFODHRDWLSLXQNTX9PZNGBISIR9SSHVYHGWYMBLOJPURRFYXTRCCQVTJZTWIKPULMUSFORLHLMFMUODYOSYX9YGOVPUSWWYXITWVDEEJQTUBYTEAQUOHMZZQKCRLFBGNTLKAZDGCCEQQFKVLVMIVNZAHZGCGEYKPOOOGNYG9XIRIRPDSGUNJIFODEYCUXPXLHLOF9EQHPBWNMKRHICYZEJLWCRLUNHIFAFVBAVFNAXXKHZX9IOCIRLKXYQXHBTLHBW9CXZFH9WZNKWJTHWEAYSVITDJNQ9GZFWNTDWFFWZINDFEUYOL9XCL99WYOAIBBTDKZZNUKJHMZIVWQEDTCKPUVLWZBCHBOCWAZOYAWWVJLEUZWUNNGSOUZBSLZXBZSIWFWT9PIBXXPPXPJRG9AQRWWYRDPODKKJWTQMSBUVHLTOESZ9HQIWXDIF9YQWTTKYXHCHTXLVFMICGHLKSYJIKPBTJFGNAOTSQNMOLVYCYHJZLYDAOU9VKTAHHARHBBDDKVNAGHDT9TGDGRQFYZQAFQCDMYWXFZZHVSNTXJNBOSRHHATGQGBRGH9KHVNYLHXBHHZOVGJCJYEBCFIYZRDVJDUPUP9HAQ99WSBMUSL9BEDOPCEDXMDHCXYWDHLBKFAGAJRJYOGN9QQCOQ9GFBVQLFEHBSVT9COEHW999999999999999999999999999999999999999999999999999999TVZIAAD99D99999999E99999999NNCVJFWHJ9ZPIBNDRJLFVKDCTXUWDHPTBOJEFGYSGFFFDZFCICIWJOCKQAQHHJCNPBIGOYIBRGZX9GIFBQBQDRYTQIXOTOAY9KJNUPWJPMTDZVSHUTMOCYHTVSMUP9WASRGWVECXNCISFFMIRGQZHIVEMUIZPA9999LONHLGP9D9NPCDVSEBWBDSMXBCLA9FTDXEZTXHEEYPCLPZQX9QWPBGVS9KVLZZHE9VCSVKRWLCJGZ9999999999999999999999999999999JMUSIWPOF999999999K99999999ZFC9999999CGA99999999999999",
                "999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999JWFAZMEQEWYIPTMJZENIMGKFJTJXNMMT9OCCXZVRKJJZTDOFNGTMKZKAKXSZLPMNCNE9IAVRTKLDUKGTW999999999999999999999999999999999999999999999999999999TVZIAAD99E99999999E99999999NNCVJFWHJ9ZPIBNDRJLFVKDCTXUWDHPTBOJEFGYSGFFFDZFCICIWJOCKQAQHHJCNPBIGOYIBRGZX9GIFBLONHLGP9D9NPCDVSEBWBDSMXBCLA9FTDXEZTXHEEYPCLPZQX9QWPBGVS9KVLZZHE9VCSVKRWLCJGZ9999CDHVEPJVTTRETUCCFIYUFFMFR9PNVCUIYVWYCGXZKFXPAJCCGDEJKYLUY9JHKSTMYTBLUFCCFMEM99999999999999999999999999999999CIUSIWPOF999999999K99999999PHA9999999RTC99999999999999",
        };
        List<TransactionViewModel> transactions = persistAndMapTxs(trytes);
        Map<Hash, TransactionViewModel> bundleTxsMapping = new HashMap<>();
        for (TransactionViewModel tvm : transactions) {
            bundleTxsMapping.put(tvm.getHash(), tvm);
        }
        List<TransactionViewModel> bundleTxs = new LinkedList<>();
        BundleValidator.Validity validity = BundleValidator.validateBundleSemantics(transactions.get(0), bundleTxsMapping, bundleTxs);
        assertEquals("the bundle semantics should be invalid", BundleValidator.Validity.INVALID, validity);
    }

    @Test
    public void validateBundleHashOfValidBundle() {
        String[] trytes = {
                "999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999GNXKWQPHMFCEZZCKUCCD9PROQVPCTBVVAPHCLVOPYYQLQRMPGTQXBVZLKGGT9NXHUAASFIAVEOZTBSM9DA99999999999999999999999999RENGLE9BEAT9999999999999999FDKW9AD99999999999B99999999RJPQGE9AXNBBLPQ9IFJXFJTXJAIGDDXAWXGAVU9PJQNYFADJDIDBTJKSAEBBX9NWJGZVAVXYWXPCEFFH9DKZYSMJAQRLXZHCNPTJPJLOONNDZHGNTBIINGYKZQAAWF9LWQTHUQSAXMLQN9DKCQWHIJXNGLGQVA9999XIFVJWCABR9XQKOWCXJAZDZWMWWBVHROBOPISAWDIJTSFPVAUZNJUMNUCOFIBIAAVIOWDTCNIPRVA9999TANGLE9BEAT9999999999999999SVIDBWNOF999999999K99999999POWSRVIO9VMIJ99UGNETMNPNNNE",
                "YU9WINMHSBIJ9HRBKDEHZYOCDGOZ9HZSSVXAYYOD9AMAFBCROMLSFDFIAQKEXAVFDLJYVABRSONSTTXLCQJTSDRFDEXZIORLRSQDZQODNCHAAFUPGBCEVYNRSJQGUZRAQIIEZPFQGWPQIBMDVNZGQAKCU9VLHGYSNDPHCMOCTRYQOYHFPRQSGHSDEF9MSHGXYGUTHSBSF9SOSJQFOZXMQGCUXAYWLBJHXOHTOM9ITZPISEXLAYAZBHTZDDCOIHKDBL9AAXZEDFHDYCPXLDGR9JTVXDXBC9DRDVREEEVGVPWVEZHJBYQYTGDEWQHVEDTAVLWW9WBXOIGDGUAAAVKFMPVKSYBVOIWPYGCMACEAAHGUIQVFLFMSCPKTYQWJDGMDNLMDIUUYI9SZOFQPLKKACESSWIXPFYZWDHETYUGEVASPHBGQPJPWVESSUUEVUYDYNQUQURSMCEPKIHYXNFHZSHIIDTMEZQ9IPSHTBDK9UHRSIIEJRILBCMVUMGAGBMHKEMUUKQDCYAVIAN9MBWJCAUSSJRSAUEUBGEFFCFSOBVGLXBAIDOH9NXWQUSIFUINEVZUWELLVIOSSQRVHMTDBCATBWFSDJJDLURAUKEQEIRICSCXAOJNPWHQKYVTRLCRKHLFHHHPYSMUEAPMQPMPS9CHCIYXEYRNIOOGRWKVHUGIWJZIGPWGZGBGYTVC9UVEJ9JBIYMDHYXLWIDXHZVFCCPLYXDPQPJGMKNZMMONGNXSNNPCGEGRJTMCPTJONGPAEDMSHMGAPGBDWVCSCTJAECSHTEGBMVCDZMQYZ9IHERWGCKAIMFOJRAEDRDSWJASV9XYS9CTOEETPQHRKJZ9FPWTVCGLEJQJXVVDTYZ9DNSHQAINKROQQIPTFGTABEELYPBQHGNNB9NCL9BVTG9MH99BPIRNNGC9MQQRH9YUDYSUJIDSZKCIGEKFSJ9PXUYKVPUZYFIREUAMUZE9EIMJK9YGAZXZBPRXIRDCEVDHWOCFIJTVRCRZRRJGFLILKVNMJAX9MUMTXCWTUTP9NXBZUMAYYY9DNVZTCROBCMMHVKSQRXMGROCMMCDENWQWBV9LEIJONWTQXOUQZOTGEJHJELYZOPICLDWPHVCMBFSYHPIJYZQDEGYITVPYNQMXPRTPKADLUKW9AEMSMGIWCUMOQMUDN9HZGYKTNVVNLOQAFVETEDJMJVKYCE9RE9AJP9RMYFKGDEC9GIGAFXEXIYXPFBOMRPULVJMYTQEPDMMIABDHJGRNNCKADZAUFV9WCWFYFHXLCED9E9SKKYHVKDTGNCHEKFJL9YJHTSRUVKEPHPCQSFNBXKOJNGBSEOZLVVGNUQTRACVGEKDSORUHVSDSQNUZASWXRADGAUDYDPODDEDNDDT9OAEARSBLPVSYAOEYYZJIZIZDENQOKMXATCTD9NEFVQWNCET9N9IXWCCWHYUBDTDJUZFXWMATRYSGJUQAFKAPIQIIXVFFEFNLGDPAIGKONUWLUTQTKZJYDEGPASTOMM9QTGOMYHFUKMNEVWPCMTLPDSOEEWDBRHZPZJIFMBUTY9QPRLPSVURIRMCWLH9YIZBOTJQMMF9ZP9VCCEGWVKSSQNANP9ZXVCAFGAVBXDJHUMKTKUBZRNKUGJTVUPDZMUK9KZI9EKY9DQDUNA9ZVPCROKYYPISSTDOJZJXMXZWSGZBEPKAUYPBPUTDVQKUYXWYTZXLYTCLLKLJUUJGFFCMZFKDTJET9KEDRMWZSAEFCSXLMRHRLG9EKLRZJ9NZQEONGFQSKSQMWRZXWVEGHCF9ZKGQITDLGFTZLCQMXVGVYIPKSUPPAOIKVWARJHAEJUZOOJFCFJTGQZWROSCEQSITQWZTQDFKECATBWSIRDFVWH9TXXUVEBRRKOTFSGBMGCMZDK9BJRVEUYOVNSLZNNSTWOB9CFNDJHJENDWSTIMMSWD9HSA9LDGTJDJFRGQCWOHYJNMFFLLDMVQEMCMNVQWMOGCEZUTK9MPULTDMKTIVFNVWXDNTRHNREHEDWIZCCRFVM9TXCTLBLYEKTRVVWHKZDOSYOBNLEKPNXMDZGLSVBBNBJIBZYBXZCENKVIXMNGUJUYFGFYFBKELSBZROQWKMESZTWDEEUCSXOWFSNJUGGJANMJFCBJV9GMDDJCAJHWKYQFJLFWZESTSIRBZQWYHGQDFUUWF9F9HXSBZRKBDLRWXSMKW99KPWJOQYPMHB9KWALSVLFNANYSMNWSJLUOCBKAWAJHNWMLPLXHVEPTKBPWLWHMDZ99999999999999999999999999999999999999999999999999999FDKW9AD99A99999999B99999999RJPQGE9AXNBBLPQ9IFJXFJTXJAIGDDXAWXGAVU9PJQNYFADJDIDBTJKSAEBBX9NWJGZVAVXYWXPCEFFH99XJLIVAZYJGPKEHANESX9DORLEIOIFL9WVQBBNUDRZDGJMVSRTSFKOJPIMEXPBCPGKUUEKRGAXOB99999XIFVJWCABR9XQKOWCXJAZDZWMWWBVHROBOPISAWDIJTSFPVAUZNJUMNUCOFIBIAAVIOWDTCNIPRVA9999999999999999999999999999999RSIDBWNOF999999999K99999999POWSRVIO9VMIJ99FKKNKGPNNNNP",
                "COSNPEACSPESTKTUS9CSMOCWVUBLERQJQGLLA9AYRRXMOVOBULQZZZJPLNELEX9EVZDAFOHBB9FBAYOTDB9YGJAVTDWNPJVVGEPFJ9QBYLXAYZEETY9GMYQRIRAIPWMJUFMFRSQRCEIOWISMBJKGCIGIIYNMXAYLXZIBNKANT9DSQXPBUPWGUJTOMD9JKSNFZJJFBZYBWRWQIZFOZXQWNJTRZTUPHVEGTAOLMBEPXOB9TCEBNIWXQUHNQJZHAOWGVOOOTSCTEUEMXJUODZP9CDLCMEXAW9YJGVNREENETEYXOAKZVRJVUSCRUSRCNZUGUOLCNHQITWYPJVJGPVULASTONDZRDVCNGJSN9DMMUORCOIBTITSPBXSAVTOHSAXHMGH99APRTQIVCEI9NWYKDOZCCWBNZGGCUCISSMGJHJ9OVSFBZVFMBODKRKSLIDESGFDQITCYFARWYTLFKSPLNVQ9LTYFODCHBAJKCWVZNBLOJH9ABFGDFOXHDNHZILINMYMVZYWTFJJOLADPTZRPJEMGPFQNYTFDGOKMDTDSKPTHIDWLMRSSACZMTHUCWVZHCYSPJRATABZ9JHWEBGTTQORGFOYDWUIYFYGOGGTYGYYI9RPKPMCTYNYKHHNWQKJTDQDHTRUYQPMCDDLVUUHUBPWGPMNQYPKHDHGIUSXJGNUXIYGZRGVYPTTV9KXJDLGVVXRIWIGKZJVCQ9DUWAYNDRKYCGKZDEOKZQCXELSQXLGLAPBDIWRTKGSIRNAZ9XFEGMWOWLPUA9TSGYRDOU9GKY9JJDKCJKKGJCRARGSNECJ9SEVAGPPJMBTMGNWSLNSFBOEYMIQBKOVSCTDIWCOQTHBVTZOFNNIYKKJLAROKIRFFPCLSOWO9BVNNJSXEYLJASPUEFKCEI9SGWADNGS9MZAKFTCAYNRVKGDIGYDTPGJXWFAEFGG9BX9XCNBZGQULH9IPPIQ9VFVAXGELUMCTE9TOFOGCTFYBYEBFOKKAESIIHEWLYLQKWDHPYNELJKMZHDSDSK9ZWFP99FQFLUXGTSVDMGHIFZFUCYTYPVEFEDM9TOHCQVIBXARYWZEKTWEOVSBYZTJZRUFZJCLRBTOWPTKY99CYQTGPMAKFYALIWPEQLUB9RGANTKDDMSDSJOTNPFZCXKJUGTJWWPK9FAJGPJOEBRHL9ZU9XRBDJBVMFIZIZFGKETH9RJUSDIOWDZIXFOJLT9DSIAWSCEYBNOGOAZQPZKVZTBXGACCBVQGFNGXNQFTVPUGUOHNBKTUERLSTDXGRKZSATIRHDBSXARYATBHOLUHCQGPRMQGSJUAXUCWKDXAUGORHFVVVDZQEYYGSV9IUM9VTMHJCIKBQD9TQLLYTZHAKDHPFGYMRGJOEDJKQTBBNFCKDEPYTPWUJEOPRJWHAILMVW9AXS9HAT9GCGRXZEHWNDOVGKGPWFXFC9IKLVZJCTGZUJFRHGL9FZWZYP9TPOWGOUTQ9INYBVTD9N9OV9AM9GYRJ99MRWRWLOAKJXMDTFNS9NZQAYGVZRJ9WVSIDRRQLGKH9VPUVKFWZMSRVVLKXUGJAZESC9LEYDNNDWS9WTWNFPCR9YKPOMIJAVHCRCJVBDFWSTDN9BPJRDMGZFXWTY9GUX9WEPJQMXSECFPREXAJ9DU9OLMNQFTF99QYZOGDUTMBHMNMCNUQTU9FTNEUNBT9NQO9YADGY9C9LQR9DYVJZE9GMMYAOUSWUIVJ9EAR9EEFCO9SZTQ9JQHPIJGXIOQZHOSUSVMHBOLTYSEONVLRISNAN9KJHHFFISTYIHYVAMXLPNALDELETXVSWGUWOIVKNAKZKNNRVNJKE9WMNQBXFGXSYZQQSIODAKINA9CPBOGAYKJ9V9GS9HERXSVYPEILYXC9GURBREBCXRZJVXHUOPGYFLPIFBCOTMHFTAAUQUZVEKOWYFFGSCXDFDBTSGZRMPQR9EYSZYGQETCWFDRXVOXXCUBOQTBQGVLAONSTSLURFYSDPAVNCXNWVPQOUORMVSLYISQUQKXFYYMJSGHQP9VAAZABEAGJMCPIEBZQSYCPS9CNKFBDRDTDA9C9MVKGUISRX9ODVUJNPDWMZ9ESYXJ99ETDGSTJZMZYJEGRUWTORMCLNHLDQ9YIJWPMDYGGJQHMFPJ9VKINJUESTCBJQXFTCJFNUXPZONVKXJRAYGKIWHXSBZRKBDLRWXSMKW99KPWJOQYPMHB9KWALSVLFNANYSMNWSJLUOCBKAWAJHNWMLPLXHVEPTKBPWLWHMD999999999999999999999999999999999999999999999999999999FDKW9AD99B99999999B99999999RJPQGE9AXNBBLPQ9IFJXFJTXJAIGDDXAWXGAVU9PJQNYFADJDIDBTJKSAEBBX9NWJGZVAVXYWXPCEFFH9XIFVJWCABR9XQKOWCXJAZDZWMWWBVHROBOPISAWDIJTSFPVAUZNJUMNUCOFIBIAAVIOWDTCNIPRVA9999FTXZAEQIKGFJABOGCCQGOMKNASGWCQWMNIMRDTHKPJMTKDGMEQNZOAYARIYEWFZYJALRKFODOITTZ9999999999999999999999999999999LLHDBWNOF999999999K99999999POWSRVIO9VMIJ99UMGMTTTPNNNV",
        };
        List<TransactionViewModel> transactions = persistAndMapTxs(trytes);
        final byte[] normalizedBundle = new byte[Curl.HASH_LENGTH / ISS.TRYTE_WIDTH];
        BundleValidator.Validity validity = BundleValidator.validateBundleHash(transactions, normalizedBundle);
        assertEquals("the bundle hash should be valid", BundleValidator.Validity.VALID, validity);
    }

    @Test
    public void validateBundleHashOfBundleWithInvalidBundleHash() {
        // tail transaction's bundle hash is invalid
        String[] trytes = {
                "999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999GNXKWQPHMFCEZZCKUCCD9PROQVPCTBVVAPHCLVOPYYQLQRMPGTQXBVZLKGGT9NXHUAASFIAVEOZTBSM9DA99999999999999999999999999RENGLE9BEAT9999999999999999FDKW9AD99999999999B99999999RJPQGE9AXNBBLPQ9IFJXFJTXJAIGDDXAWXGAVU9PJQNYFADJDIDBTJKSAEBBX9NWJGZVAVXYWXPCEFFH9DKZYSMJAQRLXZHCNPTJPJLOONNDZHGNTBIINGYKZQAAWF9LWQTHUQSAXMLQN9DKCQWHIJXNGLGQVA9999XIFVJWCABR9XQKOWCXJAZDZWMWWBVHROBOPISAWDIJTSFPVAUZNJUMNUCOFIBIAAVIOWDTCNIPRVA9999TANGLE9BEAT9999999999999999SVIDBWNOF999999999K99999999POWSRVIO9VMIJ99UGNETMNPNNNE",
                "YU9WINMHSBIJ9HRBKDEHZYOCDGOZ9HZSSVXAYYOD9AMAFBCROMLSFDFIAQKEXAVFDLJYVABRSONSTTXLCQJTSDRFDEXZIORLRSQDZQODNCHAAFUPGBCEVYNRSJQGUZRAQIIEZPFQGWPQIBMDVNZGQAKCU9VLHGYSNDPHCMOCTRYQOYHFPRQSGHSDEF9MSHGXYGUTHSBSF9SOSJQFOZXMQGCUXAYWLBJHXOHTOM9ITZPISEXLAYAZBHTZDDCOIHKDBL9AAXZEDFHDYCPXLDGR9JTVXDXBC9DRDVREEEVGVPWVEZHJBYQYTGDEWQHVEDTAVLWW9WBXOIGDGUAAAVKFMPVKSYBVOIWPYGCMACEAAHGUIQVFLFMSCPKTYQWJDGMDNLMDIUUYI9SZOFQPLKKACESSWIXPFYZWDHETYUGEVASPHBGQPJPWVESSUUEVUYDYNQUQURSMCEPKIHYXNFHZSHIIDTMEZQ9IPSHTBDK9UHRSIIEJRILBCMVUMGAGBMHKEMUUKQDCYAVIAN9MBWJCAUSSJRSAUEUBGEFFCFSOBVGLXBAIDOH9NXWQUSIFUINEVZUWELLVIOSSQRVHMTDBCATBWFSDJJDLURAUKEQEIRICSCXAOJNPWHQKYVTRLCRKHLFHHHPYSMUEAPMQPMPS9CHCIYXEYRNIOOGRWKVHUGIWJZIGPWGZGBGYTVC9UVEJ9JBIYMDHYXLWIDXHZVFCCPLYXDPQPJGMKNZMMONGNXSNNPCGEGRJTMCPTJONGPAEDMSHMGAPGBDWVCSCTJAECSHTEGBMVCDZMQYZ9IHERWGCKAIMFOJRAEDRDSWJASV9XYS9CTOEETPQHRKJZ9FPWTVCGLEJQJXVVDTYZ9DNSHQAINKROQQIPTFGTABEELYPBQHGNNB9NCL9BVTG9MH99BPIRNNGC9MQQRH9YUDYSUJIDSZKCIGEKFSJ9PXUYKVPUZYFIREUAMUZE9EIMJK9YGAZXZBPRXIRDCEVDHWOCFIJTVRCRZRRJGFLILKVNMJAX9MUMTXCWTUTP9NXBZUMAYYY9DNVZTCROBCMMHVKSQRXMGROCMMCDENWQWBV9LEIJONWTQXOUQZOTGEJHJELYZOPICLDWPHVCMBFSYHPIJYZQDEGYITVPYNQMXPRTPKADLUKW9AEMSMGIWCUMOQMUDN9HZGYKTNVVNLOQAFVETEDJMJVKYCE9RE9AJP9RMYFKGDEC9GIGAFXEXIYXPFBOMRPULVJMYTQEPDMMIABDHJGRNNCKADZAUFV9WCWFYFHXLCED9E9SKKYHVKDTGNCHEKFJL9YJHTSRUVKEPHPCQSFNBXKOJNGBSEOZLVVGNUQTRACVGEKDSORUHVSDSQNUZASWXRADGAUDYDPODDEDNDDT9OAEARSBLPVSYAOEYYZJIZIZDENQOKMXATCTD9NEFVQWNCET9N9IXWCCWHYUBDTDJUZFXWMATRYSGJUQAFKAPIQIIXVFFEFNLGDPAIGKONUWLUTQTKZJYDEGPASTOMM9QTGOMYHFUKMNEVWPCMTLPDSOEEWDBRHZPZJIFMBUTY9QPRLPSVURIRMCWLH9YIZBOTJQMMF9ZP9VCCEGWVKSSQNANP9ZXVCAFGAVBXDJHUMKTKUBZRNKUGJTVUPDZMUK9KZI9EKY9DQDUNA9ZVPCROKYYPISSTDOJZJXMXZWSGZBEPKAUYPBPUTDVQKUYXWYTZXLYTCLLKLJUUJGFFCMZFKDTJET9KEDRMWZSAEFCSXLMRHRLG9EKLRZJ9NZQEONGFQSKSQMWRZXWVEGHCF9ZKGQITDLGFTZLCQMXVGVYIPKSUPPAOIKVWARJHAEJUZOOJFCFJTGQZWROSCEQSITQWZTQDFKECATBWSIRDFVWH9TXXUVEBRRKOTFSGBMGCMZDK9BJRVEUYOVNSLZNNSTWOB9CFNDJHJENDWSTIMMSWD9HSA9LDGTJDJFRGQCWOHYJNMFFLLDMVQEMCMNVQWMOGCEZUTK9MPULTDMKTIVFNVWXDNTRHNREHEDWIZCCRFVM9TXCTLBLYEKTRVVWHKZDOSYOBNLEKPNXMDZGLSVBBNBJIBZYBXZCENKVIXMNGUJUYFGFYFBKELSBZROQWKMESZTWDEEUCSXOWFSNJUGGJANMJFCBJV9GMDDJCAJHWKYQFJLFWZESTSIRBZQWYHGQDFUUWF9F9HXSBZRKBDLRWXSMKW99KPWJOQYPMHB9KWALSVLFNANYSMNWSJLUOCBKAWAJHNWMLPLXHVEPTKBPWLWHMDZ99999999999999999999999999999999999999999999999999999FDKW9AD99A99999999B99999999AAAAAAAAAAAAAPQ9IFJXFJTXJAIGDDXAWXGAVU9PJQNYFADJDIDBTJKSAEBBX9NWJGZVAVXYWXPCEFFH99XJLIVAZYJGPKEHANESX9DORLEIOIFL9WVQBBNUDRZDGJMVSRTSFKOJPIMEXPBCPGKUUEKRGAXOB99999XIFVJWCABR9XQKOWCXJAZDZWMWWBVHROBOPISAWDIJTSFPVAUZNJUMNUCOFIBIAAVIOWDTCNIPRVA9999999999999999999999999999999RSIDBWNOF999999999K99999999POWSRVIO9VMIJ99FKKNKGPNNNNP",
                "COSNPEACSPESTKTUS9CSMOCWVUBLERQJQGLLA9AYRRXMOVOBULQZZZJPLNELEX9EVZDAFOHBB9FBAYOTDB9YGJAVTDWNPJVVGEPFJ9QBYLXAYZEETY9GMYQRIRAIPWMJUFMFRSQRCEIOWISMBJKGCIGIIYNMXAYLXZIBNKANT9DSQXPBUPWGUJTOMD9JKSNFZJJFBZYBWRWQIZFOZXQWNJTRZTUPHVEGTAOLMBEPXOB9TCEBNIWXQUHNQJZHAOWGVOOOTSCTEUEMXJUODZP9CDLCMEXAW9YJGVNREENETEYXOAKZVRJVUSCRUSRCNZUGUOLCNHQITWYPJVJGPVULASTONDZRDVCNGJSN9DMMUORCOIBTITSPBXSAVTOHSAXHMGH99APRTQIVCEI9NWYKDOZCCWBNZGGCUCISSMGJHJ9OVSFBZVFMBODKRKSLIDESGFDQITCYFARWYTLFKSPLNVQ9LTYFODCHBAJKCWVZNBLOJH9ABFGDFOXHDNHZILINMYMVZYWTFJJOLADPTZRPJEMGPFQNYTFDGOKMDTDSKPTHIDWLMRSSACZMTHUCWVZHCYSPJRATABZ9JHWEBGTTQORGFOYDWUIYFYGOGGTYGYYI9RPKPMCTYNYKHHNWQKJTDQDHTRUYQPMCDDLVUUHUBPWGPMNQYPKHDHGIUSXJGNUXIYGZRGVYPTTV9KXJDLGVVXRIWIGKZJVCQ9DUWAYNDRKYCGKZDEOKZQCXELSQXLGLAPBDIWRTKGSIRNAZ9XFEGMWOWLPUA9TSGYRDOU9GKY9JJDKCJKKGJCRARGSNECJ9SEVAGPPJMBTMGNWSLNSFBOEYMIQBKOVSCTDIWCOQTHBVTZOFNNIYKKJLAROKIRFFPCLSOWO9BVNNJSXEYLJASPUEFKCEI9SGWADNGS9MZAKFTCAYNRVKGDIGYDTPGJXWFAEFGG9BX9XCNBZGQULH9IPPIQ9VFVAXGELUMCTE9TOFOGCTFYBYEBFOKKAESIIHEWLYLQKWDHPYNELJKMZHDSDSK9ZWFP99FQFLUXGTSVDMGHIFZFUCYTYPVEFEDM9TOHCQVIBXARYWZEKTWEOVSBYZTJZRUFZJCLRBTOWPTKY99CYQTGPMAKFYALIWPEQLUB9RGANTKDDMSDSJOTNPFZCXKJUGTJWWPK9FAJGPJOEBRHL9ZU9XRBDJBVMFIZIZFGKETH9RJUSDIOWDZIXFOJLT9DSIAWSCEYBNOGOAZQPZKVZTBXGACCBVQGFNGXNQFTVPUGUOHNBKTUERLSTDXGRKZSATIRHDBSXARYATBHOLUHCQGPRMQGSJUAXUCWKDXAUGORHFVVVDZQEYYGSV9IUM9VTMHJCIKBQD9TQLLYTZHAKDHPFGYMRGJOEDJKQTBBNFCKDEPYTPWUJEOPRJWHAILMVW9AXS9HAT9GCGRXZEHWNDOVGKGPWFXFC9IKLVZJCTGZUJFRHGL9FZWZYP9TPOWGOUTQ9INYBVTD9N9OV9AM9GYRJ99MRWRWLOAKJXMDTFNS9NZQAYGVZRJ9WVSIDRRQLGKH9VPUVKFWZMSRVVLKXUGJAZESC9LEYDNNDWS9WTWNFPCR9YKPOMIJAVHCRCJVBDFWSTDN9BPJRDMGZFXWTY9GUX9WEPJQMXSECFPREXAJ9DU9OLMNQFTF99QYZOGDUTMBHMNMCNUQTU9FTNEUNBT9NQO9YADGY9C9LQR9DYVJZE9GMMYAOUSWUIVJ9EAR9EEFCO9SZTQ9JQHPIJGXIOQZHOSUSVMHBOLTYSEONVLRISNAN9KJHHFFISTYIHYVAMXLPNALDELETXVSWGUWOIVKNAKZKNNRVNJKE9WMNQBXFGXSYZQQSIODAKINA9CPBOGAYKJ9V9GS9HERXSVYPEILYXC9GURBREBCXRZJVXHUOPGYFLPIFBCOTMHFTAAUQUZVEKOWYFFGSCXDFDBTSGZRMPQR9EYSZYGQETCWFDRXVOXXCUBOQTBQGVLAONSTSLURFYSDPAVNCXNWVPQOUORMVSLYISQUQKXFYYMJSGHQP9VAAZABEAGJMCPIEBZQSYCPS9CNKFBDRDTDA9C9MVKGUISRX9ODVUJNPDWMZ9ESYXJ99ETDGSTJZMZYJEGRUWTORMCLNHLDQ9YIJWPMDYGGJQHMFPJ9VKINJUESTCBJQXFTCJFNUXPZONVKXJRAYGKIWHXSBZRKBDLRWXSMKW99KPWJOQYPMHB9KWALSVLFNANYSMNWSJLUOCBKAWAJHNWMLPLXHVEPTKBPWLWHMD999999999999999999999999999999999999999999999999999999FDKW9AD99B99999999B99999999RJPQGE9AXNBBLPQ9IFJXFJTXJAIGDDXAWXGAVU9PJQNYFADJDIDBTJKSAEBBX9NWJGZVAVXYWXPCEFFH9XIFVJWCABR9XQKOWCXJAZDZWMWWBVHROBOPISAWDIJTSFPVAUZNJUMNUCOFIBIAAVIOWDTCNIPRVA9999FTXZAEQIKGFJABOGCCQGOMKNASGWCQWMNIMRDTHKPJMTKDGMEQNZOAYARIYEWFZYJALRKFODOITTZ9999999999999999999999999999999LLHDBWNOF999999999K99999999POWSRVIO9VMIJ99UMGMTTTPNNNV",
        };
        List<TransactionViewModel> transactions = persistAndMapTxs(trytes);
        final byte[] normalizedBundle = new byte[Curl.HASH_LENGTH / ISS.TRYTE_WIDTH];
        BundleValidator.Validity validity = BundleValidator.validateBundleHash(transactions, normalizedBundle);
        assertEquals("the bundle hash should be invalid", BundleValidator.Validity.INVALID, validity);
    }

    @Test
    public void validateSignaturesOfValidBundle() {
        String[] trytes = {
                "999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999GNXKWQPHMFCEZZCKUCCD9PROQVPCTBVVAPHCLVOPYYQLQRMPGTQXBVZLKGGT9NXHUAASFIAVEOZTBSM9DA99999999999999999999999999RENGLE9BEAT9999999999999999FDKW9AD99999999999B99999999RJPQGE9AXNBBLPQ9IFJXFJTXJAIGDDXAWXGAVU9PJQNYFADJDIDBTJKSAEBBX9NWJGZVAVXYWXPCEFFH9DKZYSMJAQRLXZHCNPTJPJLOONNDZHGNTBIINGYKZQAAWF9LWQTHUQSAXMLQN9DKCQWHIJXNGLGQVA9999XIFVJWCABR9XQKOWCXJAZDZWMWWBVHROBOPISAWDIJTSFPVAUZNJUMNUCOFIBIAAVIOWDTCNIPRVA9999TANGLE9BEAT9999999999999999SVIDBWNOF999999999K99999999POWSRVIO9VMIJ99UGNETMNPNNNE",
                "YU9WINMHSBIJ9HRBKDEHZYOCDGOZ9HZSSVXAYYOD9AMAFBCROMLSFDFIAQKEXAVFDLJYVABRSONSTTXLCQJTSDRFDEXZIORLRSQDZQODNCHAAFUPGBCEVYNRSJQGUZRAQIIEZPFQGWPQIBMDVNZGQAKCU9VLHGYSNDPHCMOCTRYQOYHFPRQSGHSDEF9MSHGXYGUTHSBSF9SOSJQFOZXMQGCUXAYWLBJHXOHTOM9ITZPISEXLAYAZBHTZDDCOIHKDBL9AAXZEDFHDYCPXLDGR9JTVXDXBC9DRDVREEEVGVPWVEZHJBYQYTGDEWQHVEDTAVLWW9WBXOIGDGUAAAVKFMPVKSYBVOIWPYGCMACEAAHGUIQVFLFMSCPKTYQWJDGMDNLMDIUUYI9SZOFQPLKKACESSWIXPFYZWDHETYUGEVASPHBGQPJPWVESSUUEVUYDYNQUQURSMCEPKIHYXNFHZSHIIDTMEZQ9IPSHTBDK9UHRSIIEJRILBCMVUMGAGBMHKEMUUKQDCYAVIAN9MBWJCAUSSJRSAUEUBGEFFCFSOBVGLXBAIDOH9NXWQUSIFUINEVZUWELLVIOSSQRVHMTDBCATBWFSDJJDLURAUKEQEIRICSCXAOJNPWHQKYVTRLCRKHLFHHHPYSMUEAPMQPMPS9CHCIYXEYRNIOOGRWKVHUGIWJZIGPWGZGBGYTVC9UVEJ9JBIYMDHYXLWIDXHZVFCCPLYXDPQPJGMKNZMMONGNXSNNPCGEGRJTMCPTJONGPAEDMSHMGAPGBDWVCSCTJAECSHTEGBMVCDZMQYZ9IHERWGCKAIMFOJRAEDRDSWJASV9XYS9CTOEETPQHRKJZ9FPWTVCGLEJQJXVVDTYZ9DNSHQAINKROQQIPTFGTABEELYPBQHGNNB9NCL9BVTG9MH99BPIRNNGC9MQQRH9YUDYSUJIDSZKCIGEKFSJ9PXUYKVPUZYFIREUAMUZE9EIMJK9YGAZXZBPRXIRDCEVDHWOCFIJTVRCRZRRJGFLILKVNMJAX9MUMTXCWTUTP9NXBZUMAYYY9DNVZTCROBCMMHVKSQRXMGROCMMCDENWQWBV9LEIJONWTQXOUQZOTGEJHJELYZOPICLDWPHVCMBFSYHPIJYZQDEGYITVPYNQMXPRTPKADLUKW9AEMSMGIWCUMOQMUDN9HZGYKTNVVNLOQAFVETEDJMJVKYCE9RE9AJP9RMYFKGDEC9GIGAFXEXIYXPFBOMRPULVJMYTQEPDMMIABDHJGRNNCKADZAUFV9WCWFYFHXLCED9E9SKKYHVKDTGNCHEKFJL9YJHTSRUVKEPHPCQSFNBXKOJNGBSEOZLVVGNUQTRACVGEKDSORUHVSDSQNUZASWXRADGAUDYDPODDEDNDDT9OAEARSBLPVSYAOEYYZJIZIZDENQOKMXATCTD9NEFVQWNCET9N9IXWCCWHYUBDTDJUZFXWMATRYSGJUQAFKAPIQIIXVFFEFNLGDPAIGKONUWLUTQTKZJYDEGPASTOMM9QTGOMYHFUKMNEVWPCMTLPDSOEEWDBRHZPZJIFMBUTY9QPRLPSVURIRMCWLH9YIZBOTJQMMF9ZP9VCCEGWVKSSQNANP9ZXVCAFGAVBXDJHUMKTKUBZRNKUGJTVUPDZMUK9KZI9EKY9DQDUNA9ZVPCROKYYPISSTDOJZJXMXZWSGZBEPKAUYPBPUTDVQKUYXWYTZXLYTCLLKLJUUJGFFCMZFKDTJET9KEDRMWZSAEFCSXLMRHRLG9EKLRZJ9NZQEONGFQSKSQMWRZXWVEGHCF9ZKGQITDLGFTZLCQMXVGVYIPKSUPPAOIKVWARJHAEJUZOOJFCFJTGQZWROSCEQSITQWZTQDFKECATBWSIRDFVWH9TXXUVEBRRKOTFSGBMGCMZDK9BJRVEUYOVNSLZNNSTWOB9CFNDJHJENDWSTIMMSWD9HSA9LDGTJDJFRGQCWOHYJNMFFLLDMVQEMCMNVQWMOGCEZUTK9MPULTDMKTIVFNVWXDNTRHNREHEDWIZCCRFVM9TXCTLBLYEKTRVVWHKZDOSYOBNLEKPNXMDZGLSVBBNBJIBZYBXZCENKVIXMNGUJUYFGFYFBKELSBZROQWKMESZTWDEEUCSXOWFSNJUGGJANMJFCBJV9GMDDJCAJHWKYQFJLFWZESTSIRBZQWYHGQDFUUWF9F9HXSBZRKBDLRWXSMKW99KPWJOQYPMHB9KWALSVLFNANYSMNWSJLUOCBKAWAJHNWMLPLXHVEPTKBPWLWHMDZ99999999999999999999999999999999999999999999999999999FDKW9AD99A99999999B99999999RJPQGE9AXNBBLPQ9IFJXFJTXJAIGDDXAWXGAVU9PJQNYFADJDIDBTJKSAEBBX9NWJGZVAVXYWXPCEFFH99XJLIVAZYJGPKEHANESX9DORLEIOIFL9WVQBBNUDRZDGJMVSRTSFKOJPIMEXPBCPGKUUEKRGAXOB99999XIFVJWCABR9XQKOWCXJAZDZWMWWBVHROBOPISAWDIJTSFPVAUZNJUMNUCOFIBIAAVIOWDTCNIPRVA9999999999999999999999999999999RSIDBWNOF999999999K99999999POWSRVIO9VMIJ99FKKNKGPNNNNP",
                "COSNPEACSPESTKTUS9CSMOCWVUBLERQJQGLLA9AYRRXMOVOBULQZZZJPLNELEX9EVZDAFOHBB9FBAYOTDB9YGJAVTDWNPJVVGEPFJ9QBYLXAYZEETY9GMYQRIRAIPWMJUFMFRSQRCEIOWISMBJKGCIGIIYNMXAYLXZIBNKANT9DSQXPBUPWGUJTOMD9JKSNFZJJFBZYBWRWQIZFOZXQWNJTRZTUPHVEGTAOLMBEPXOB9TCEBNIWXQUHNQJZHAOWGVOOOTSCTEUEMXJUODZP9CDLCMEXAW9YJGVNREENETEYXOAKZVRJVUSCRUSRCNZUGUOLCNHQITWYPJVJGPVULASTONDZRDVCNGJSN9DMMUORCOIBTITSPBXSAVTOHSAXHMGH99APRTQIVCEI9NWYKDOZCCWBNZGGCUCISSMGJHJ9OVSFBZVFMBODKRKSLIDESGFDQITCYFARWYTLFKSPLNVQ9LTYFODCHBAJKCWVZNBLOJH9ABFGDFOXHDNHZILINMYMVZYWTFJJOLADPTZRPJEMGPFQNYTFDGOKMDTDSKPTHIDWLMRSSACZMTHUCWVZHCYSPJRATABZ9JHWEBGTTQORGFOYDWUIYFYGOGGTYGYYI9RPKPMCTYNYKHHNWQKJTDQDHTRUYQPMCDDLVUUHUBPWGPMNQYPKHDHGIUSXJGNUXIYGZRGVYPTTV9KXJDLGVVXRIWIGKZJVCQ9DUWAYNDRKYCGKZDEOKZQCXELSQXLGLAPBDIWRTKGSIRNAZ9XFEGMWOWLPUA9TSGYRDOU9GKY9JJDKCJKKGJCRARGSNECJ9SEVAGPPJMBTMGNWSLNSFBOEYMIQBKOVSCTDIWCOQTHBVTZOFNNIYKKJLAROKIRFFPCLSOWO9BVNNJSXEYLJASPUEFKCEI9SGWADNGS9MZAKFTCAYNRVKGDIGYDTPGJXWFAEFGG9BX9XCNBZGQULH9IPPIQ9VFVAXGELUMCTE9TOFOGCTFYBYEBFOKKAESIIHEWLYLQKWDHPYNELJKMZHDSDSK9ZWFP99FQFLUXGTSVDMGHIFZFUCYTYPVEFEDM9TOHCQVIBXARYWZEKTWEOVSBYZTJZRUFZJCLRBTOWPTKY99CYQTGPMAKFYALIWPEQLUB9RGANTKDDMSDSJOTNPFZCXKJUGTJWWPK9FAJGPJOEBRHL9ZU9XRBDJBVMFIZIZFGKETH9RJUSDIOWDZIXFOJLT9DSIAWSCEYBNOGOAZQPZKVZTBXGACCBVQGFNGXNQFTVPUGUOHNBKTUERLSTDXGRKZSATIRHDBSXARYATBHOLUHCQGPRMQGSJUAXUCWKDXAUGORHFVVVDZQEYYGSV9IUM9VTMHJCIKBQD9TQLLYTZHAKDHPFGYMRGJOEDJKQTBBNFCKDEPYTPWUJEOPRJWHAILMVW9AXS9HAT9GCGRXZEHWNDOVGKGPWFXFC9IKLVZJCTGZUJFRHGL9FZWZYP9TPOWGOUTQ9INYBVTD9N9OV9AM9GYRJ99MRWRWLOAKJXMDTFNS9NZQAYGVZRJ9WVSIDRRQLGKH9VPUVKFWZMSRVVLKXUGJAZESC9LEYDNNDWS9WTWNFPCR9YKPOMIJAVHCRCJVBDFWSTDN9BPJRDMGZFXWTY9GUX9WEPJQMXSECFPREXAJ9DU9OLMNQFTF99QYZOGDUTMBHMNMCNUQTU9FTNEUNBT9NQO9YADGY9C9LQR9DYVJZE9GMMYAOUSWUIVJ9EAR9EEFCO9SZTQ9JQHPIJGXIOQZHOSUSVMHBOLTYSEONVLRISNAN9KJHHFFISTYIHYVAMXLPNALDELETXVSWGUWOIVKNAKZKNNRVNJKE9WMNQBXFGXSYZQQSIODAKINA9CPBOGAYKJ9V9GS9HERXSVYPEILYXC9GURBREBCXRZJVXHUOPGYFLPIFBCOTMHFTAAUQUZVEKOWYFFGSCXDFDBTSGZRMPQR9EYSZYGQETCWFDRXVOXXCUBOQTBQGVLAONSTSLURFYSDPAVNCXNWVPQOUORMVSLYISQUQKXFYYMJSGHQP9VAAZABEAGJMCPIEBZQSYCPS9CNKFBDRDTDA9C9MVKGUISRX9ODVUJNPDWMZ9ESYXJ99ETDGSTJZMZYJEGRUWTORMCLNHLDQ9YIJWPMDYGGJQHMFPJ9VKINJUESTCBJQXFTCJFNUXPZONVKXJRAYGKIWHXSBZRKBDLRWXSMKW99KPWJOQYPMHB9KWALSVLFNANYSMNWSJLUOCBKAWAJHNWMLPLXHVEPTKBPWLWHMD999999999999999999999999999999999999999999999999999999FDKW9AD99B99999999B99999999RJPQGE9AXNBBLPQ9IFJXFJTXJAIGDDXAWXGAVU9PJQNYFADJDIDBTJKSAEBBX9NWJGZVAVXYWXPCEFFH9XIFVJWCABR9XQKOWCXJAZDZWMWWBVHROBOPISAWDIJTSFPVAUZNJUMNUCOFIBIAAVIOWDTCNIPRVA9999FTXZAEQIKGFJABOGCCQGOMKNASGWCQWMNIMRDTHKPJMTKDGMEQNZOAYARIYEWFZYJALRKFODOITTZ9999999999999999999999999999999LLHDBWNOF999999999K99999999POWSRVIO9VMIJ99UMGMTTTPNNNV",
        };
        List<TransactionViewModel> transactions = persistAndMapTxs(trytes);
        final byte[] normalizedBundle = new byte[Curl.HASH_LENGTH / ISS.TRYTE_WIDTH];
        BundleValidator.validateBundleHash(transactions, normalizedBundle);
        BundleValidator.Validity validity = BundleValidator.validateSignatures(transactions, normalizedBundle);
        assertEquals("the signatures should be valid", BundleValidator.Validity.VALID, validity);
    }

    @Test
    public void validateSignaturesOfBundleWithInvalidSignatures() {
        // first input tx's signature's first part has no 9s (replaced with As)
        String[] trytes = {
                "999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999NSA999999999999999999999999XB9999999999999999999999999VKUIAAD99999999999C99999999DIODRCKI9IUWGBTDTILEUVUPLHEMQZAYKWIULYHGPKVYSGCI9ANDOOBQTXAXIHGSVOLLXOKTRCHZFDHIZYTYMYJULDLBXVSAK9ROSUEEDKM9ZPJZRYBIDC9QJOGHXJTKAJJXTFNCUFDPCNSQFWOMLM9NWKMRTZ9999NRBM9KWMOYBKSGKVDTVOXQSDJUTIIPVIAOMOYWFXLOFVP9OP9TBCDTJXZNYZQBALCPJCDKWKQQARZ9999999999999999999999999999999MOTRCWPOF999999999K99999999FQB9999999IGXC9999999999999",
                "KGCWXSNUPEAVGPNCFQLKKTCVRHHRNQUKNGDJWOAQCKPXYXTUWHYJKOMLKLPPAGLAJZVNHNEXKEXIAJBQADVKOXESKAAIMDEEKNNSPRRCKTHDEVWVELOJNBRUJYESSNMJHTKHNVZCAXBWIBVSHJFKPVVXBAZMFVBCYBIWPBPRKNVMMMYNPFZTUMEAITVEHCIOYYZVSJNGLPJIHAAOXCGOKJGHUUVHEVMVZJTGYMYPDUSQBDIUOQAKAUAFJUOQBXBAVUZADPVFXMBKUDNAZZJDVWNVYMZCDLAOGEKMIOATLYJWXZAUAYKPCYWUHUZZHPRAJCPZUCHLXEHAHYPBPUJOSUEESSSCLPSAZZSSMVAKXFVLXBMQSPGJOXXWSFDHPTWDEISBMMFRBJFTHXVPIJTCDTTPJDCDLPGGTLORVHRVEFNSYUSPICHKQKXXZXDDAQDPEWBHIXISLIVJIAGBBKAFNYTCBJEYWDCRGGHQAZZCIHDOMQSTUJERBDYOICLAKYGMZVHXVSKUGCFDSKLJARRTWYAXAYHURBPKIQWCHLAZYUOXXBZIZECSDWXDOAMUNOQXUVTCEOOMNIIZNEQBHTMXQLPBWPSZBUNCAACTSMPLKBLJHXNDZJQAQUTAYFWQBSULIPPCCSKBCTIOARELDNCZANDAJIGDOWTAJOCIEHXSNDPDVLAVVAVMFOHELRPNFCPBMUJEDBSJEKPRCZULMMJKXHBZAZSSNEUTZKRSELKOLQOPFELCCFNAWWDODZAAYAYAAVPXZSFCQWHAYGTGBKZELVZHODOONGUNBGFEOGLFJBLPAADXWSOCOSLCUMPUAYXFCYHTFUZOAGJGCBYNGNMEIRWKAKTUARSXOVYOCWDBAGNQXYTXARUGNCCLNGDCZLZORKHMEXLDAXGWVCQTAGAPFVQKSAETFCTMOIHSWSDXASRQXSCCNKCSDUNWJQRCBJFDSAUSMJNNTWQXJARTVALQSYABRTATSUZCSVRSJDJJUBTPWWNZNYAAYAFAPJCEYUAFLPKARMNIUAYOCKWKHNNUTMDFTRYKBGGRRAXHAGAMJDSIYKCQRZEQTPQABDTTQDLZXTWGKCEINMQAMLTJADAGBWLYHRTGUFDWYUWEJCPSMWVVNZJFKLKYCKURRRAULJJDBBGPGXKMFQHMRLYPEYRHABHUGWYNJSJERVIZXSYATIITCPLKSGBADWDOAGKWAQAOZBIKSAXNUQEDABACGSNTBUWAUMOMRUOWNCJHYSFNHLFJAZKVZVYVGAYASVHUMANJVKZTRQSCAYIEQULZQVRTYHAIYKIXMDELZTXWBXRHKCAGNDCOZWTZUOIHCPLTQFXIHAAPMWSGNAITAAXZITFARAPNSWCPKYVKYPSPGLSHLUOGYPUSAACFYJHAAAKBIOKYNZACAXFPDAWQPIJNDXWLQZQCXLUYZYNMJDGASCNPWQQQGHUQBDWKYXIWSNTGVLMXACYEENHVBHXWVHGKHENMRJVSDAFONFVQXTYTUAJYGDFPNCPWAVSDKTVWDAIYMNJLLRCRVIIPCQQBTDDRDXKWCGQDCALMXNWANNPRAEAIWAQSJSXRFRZOUNCQPNPWNUKEVPAQRLEVRAECUMRVDEXBTHKZPKAGXVXPVASULFAEEOHCFZHPGOSWTKQBTGYAWAPXGBAPTPYSUXYMVTPNAOZVHLEKWPGKBGVEALWQWSJDQCTBIYNXMCELEUCZJTGJIIQQESGWLDAKCOFEWKXSYVKOCFLHFHEDEXJGCDTWFUPTWSCSHHRKQBYNOWIRDVUAXBOSMCWXWGOBFHTFMNNVFPUUOJNMRWXCXPGUQNUBRNTDYBGLAIYQAQHSMADBVBAEKIRBXWCKODWHDEXVIADGANYDPNETVPRPYVMAETHAKYWTVKULDZAIFVWLGHLKWZRKBRIEMRAGJZEBWFWNIAONPTPBYXWDBFQNNBQFJMEYVETZDYHWWNTZJQGLSBOEZTQHWPOYCNSZZACPUVUJPFBEYODMJWQWNPDWTDBSILOURBUYDHVSNVCNCEYUUCPMLNAADMAAAQQILBWFQUIMOTPKXRQLMBVZKJCPQAJBPPOBTGVHXTDXYUNTGFWYUZRAZWOIJARTYMXJCDQTBAFVPZHXYLATATBPYFNTLASEARRTVVMARHZFIWUBFXGRPRFMKANXPTISOBJUZHNTHRXQGODFABGWYYAZP9QKSRZEMMUQ9ZIBUPTBVJCJWBPOMPRIJDRTW9UGLCAJHBOHLZRNELILWYKDD9OQHBNCZQZ999999999999999999999999999999999999999999999999999VKUIAAD99A99999999C99999999DIODRCKI9IUWGBTDTILEUVUPLHEMQZAYKWIULYHGPKVYSGCI9ANDOOBQTXAXIHGSVOLLXOKTRCHZFDHIZOJMZHMJTNFBKWKDGPCNJFRTGQEKCGTZVTLPOICEOOVPUEZLJGBNBUPAOBPBIMSZMFGAHORMOF9KAA9999NRBM9KWMOYBKSGKVDTVOXQSDJUTIIPVIAOMOYWFXLOFVP9OP9TBCDTJXZNYZQBALCPJCDKWKQQARZ9999999999999999999999999999999PQSRCWPOF999999999K99999999LAB99999999KPA9999999999999",
                "XCNVYXCIPKNMLJHILMDJURBDNYBYZDYVD9HCNUFXESXUPJYRRFJBUULGZZJJNWGTTKJOPAYRKCRGVNSAAGTYSEWBCGVAQULMSUOYLXKJACNOEGABSCGVIJVFURSYKOKS9ZHZRUPOLQMFIGWWTWOHKQSMKKQGEGYKYWXCGXKLILEEPJKCLNFCGJKMTZOHIEFUHNFUCRBBVQSMSQGQBNI9WFZGKVBRCEQGWHLQKKDIBDAHSRRISSZHWMQ9FER9RFIEAUIAGQNRYRCYRIDDSCNQSNEHKY9NLEBUYQOHZBJSABLOOZOWMSGLQTXGHKNYXKGQDQFACHFSRGFVGFEHRNBHCJEOQPSFPLSAE9YSMXCXXLKSZAGSTGF9LQUMJFEZBHTWD9DENJRJCWFNOALVJPWSDXML9YAKBPGVYEMNCYDFBWTSDIKWMLXWKAMHDMXJN9XCCMHDZWGXINYIXGYAWSAYFIKFUTIIMRRBDZKNBXV9EBEGHYNMQJXRJPDAMSOYPKZW9VWCTSUONXWXMGLKJWYTKGCK9C9UVSO9YDVNEBLEZQCQJXHLLFGELOAFSLOPY9VAGAFRVJKMKKDVXXLGBENBG9HPFRCEVRYWKSR9IFYDQYRTWTQTBUJKAZ9NNYDXJYSJV9WYCNKDIF9KDGVPFXQEEEMEYAHEMARZNDECJCPGGKUIKEYLVQWYVAFPDWIHIXJWNKRIASMJULFSNJNPLGRWNYONZIVQYANFLQMIQFSIDQOSZGILUFGESEEDWLBWDQKEDXDPPFDGMARJNFJKYICNFTRGLMPPRXGTWQ9UZRDEZANGJJCVBCCESYGMRRPLCRBKUSNHOQZAHMOFKLQQUY9ICFGSCPVAKCAALZQEBPA9IQVHDPFATEWBSBATX9XKMNPAEAFFQFNDFEK9UOWRYYZPKBD9XDSTAKLTAJEMWQQEKHKXTWHCQPWKQPVHTUKCPXFNEACENCCQMN9ZPLRGUHAKBOMMIGBEEZC9JJTRUERUGJXFDUTBXSNZJNSHUNHUAZUMZK9DCG9MNPXTFEDNFHJPYNKNOBJEDYEVUZGTMYVDLVNXNXUQKNIFGWLMLIPZEATSQCMXEWWJYUYSRJALNLBGJO9TNTUWHYFVRYXJXDIEMHYACXEW9XYTBXHNMOUKFQLGXIGCZJQFLQIQJVQVKVHPDESVDVHHLOMAHFCBERF9RECSIUZQLS9HDXNTLVEKQLWQJPLAKQBTS9VURIJRQXLNXLLCO9PQREWYCFIZKEITM9VVSUCRYR9PE9HBWIMNPQJPTFJEBOCSPVWADKSZSTUDMJAOG9LJJBVRHOUZFCWUXKM9SZZYUUTG9TSTRDKXYOZVNZKZCRSCBKMQFLMZBPVXMBLHQEDSCRUOXTML9VZZMRHRMKWONJSJQMALDQVFDWHPHXRDOWGVNKWZNDSPGJMC9FVGBAAZG9HYWSLTUNBATROOSOWTJCTVCFVWOZICS9JWKBJOYSDKCSYVWXZD9DWCDHWYPSVOMQ9TBLVVAJRW9TVQVGPRCPHIVLWCXH9GFPSZGVXNPALNJUSBBLXLJUXBKYZGIJNTLRTZTWJDMRJDNOXFGYCTZXCRYLURHQTSBEZBUNFYPYVYNTZTBKZFLOXYHEMQUDBMVUCSGMIZDKLKJJCINNUNNJ9DYCNTFBSXCYKCURMUHRNHETBKOQHRMVWCQJPPDZFUEQGZYTWXAFXYUNOPIGJEAMUYSCFTBGHOXULL9YHBWXXIYRKFWYJWFXEOGNWDIOXMMGKOOA9QFASNAIXUBGSBINAFGANTGFOBMYCLIGXKZASUQEXTIHK9VBHJNISJWVAGPOLFHLAYHIOPSSYIYGUKCOTQSMOGVZ99Z9LGWVRSMQYOZGRLZMRUDLEKFWDBKPWLDMCQE9VBXCYTNVDAXVRZMHAU9NXYGWHHSYHVSVEXXZ9EZXHNXCMBANKYUABADDQXBMTGQVCMUBDOIIFIDGBAG9QHFHCJQCBHNMGRLTDLCXINNYNJGTWWHQSHOSPAUPLRIFJWEVBDDLH9AQEERAGHNCJGHL9QMFQIUKOCRYYXMFAFKPBOBSVIYRNLMBXAJRCWPHMMOKNYPLNKDLCTWKMOJTNDTM9VODGXBUGRHOOETCAQZRFXFEQQCRUYSRMSGOFNLRYJTIRMGEABTSXFZAODIGTPEAGLAVZWLFXGUSWFWIFAALCQGODFABGWYYAZP9QKSRZEMMUQ9ZIBUPTBVJCJWBPOMPRIJDRTW9UGLCAJHBOHLZRNELILWYKDD9OQHBNC999999999999999999999999999999999999999999999999999999VKUIAAD99B99999999C99999999DIODRCKI9IUWGBTDTILEUVUPLHEMQZAYKWIULYHGPKVYSGCI9ANDOOBQTXAXIHGSVOLLXOKTRCHZFDHIZMMEHMILGJFIUITZLAONHWRLCJKJHXLOHRTDJOMFETXQPBXWHRRJ9S9ZIIVRYHNUCFRQZWGDSGLYSA9999NRBM9KWMOYBKSGKVDTVOXQSDJUTIIPVIAOMOYWFXLOFVP9OP9TBCDTJXZNYZQBALCPJCDKWKQQARZ99999999999999999999999999999999NSRCWPOF999999999K99999999LSB9999999OTB99999999999999",
                "999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999MUN9LXIQBWCSJDSWFARRJMIQGJWZMJQ9AERHUZGLTH9OAMCJBIJHPAOQIECPTNYHUWZLCSIYNKMNFHSWCNSA999999999999999999999999999999999999999999999999999VKUIAAD99C99999999C99999999DIODRCKI9IUWGBTDTILEUVUPLHEMQZAYKWIULYHGPKVYSGCI9ANDOOBQTXAXIHGSVOLLXOKTRCHZFDHIZNRBM9KWMOYBKSGKVDTVOXQSDJUTIIPVIAOMOYWFXLOFVP9OP9TBCDTJXZNYZQBALCPJCDKWKQQARZ9999FJHO9TPBCDABULPM9ERDYUZMQMNRPEFSYBDYWILOXQFRGAASGBQBBZMGICNJEPTFAC9ENSINGMURA9999999999999999999999999999999LKQRCWPOF999999999K99999999ID99999999RUTA9999999999999",
        };
        List<TransactionViewModel> transactions = persistAndMapTxs(trytes);
        final byte[] normalizedBundle = new byte[Curl.HASH_LENGTH / ISS.TRYTE_WIDTH];
        BundleValidator.validateBundleHash(transactions, normalizedBundle);
        BundleValidator.Validity validity = BundleValidator.validateSignatures(transactions, normalizedBundle);
        assertEquals("the signatures should be invalid", BundleValidator.Validity.INVALID, validity);
    }

    @Test
    public void validationModeAll() {
        String[] trytes = {
                "999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999GNXKWQPHMFCEZZCKUCCD9PROQVPCTBVVAPHCLVOPYYQLQRMPGTQXBVZLKGGT9NXHUAASFIAVEOZTBSM9DA99999999999999999999999999RENGLE9BEAT9999999999999999FDKW9AD99999999999B99999999RJPQGE9AXNBBLPQ9IFJXFJTXJAIGDDXAWXGAVU9PJQNYFADJDIDBTJKSAEBBX9NWJGZVAVXYWXPCEFFH9DKZYSMJAQRLXZHCNPTJPJLOONNDZHGNTBIINGYKZQAAWF9LWQTHUQSAXMLQN9DKCQWHIJXNGLGQVA9999XIFVJWCABR9XQKOWCXJAZDZWMWWBVHROBOPISAWDIJTSFPVAUZNJUMNUCOFIBIAAVIOWDTCNIPRVA9999TANGLE9BEAT9999999999999999SVIDBWNOF999999999K99999999POWSRVIO9VMIJ99UGNETMNPNNNE",
                "YU9WINMHSBIJ9HRBKDEHZYOCDGOZ9HZSSVXAYYOD9AMAFBCROMLSFDFIAQKEXAVFDLJYVABRSONSTTXLCQJTSDRFDEXZIORLRSQDZQODNCHAAFUPGBCEVYNRSJQGUZRAQIIEZPFQGWPQIBMDVNZGQAKCU9VLHGYSNDPHCMOCTRYQOYHFPRQSGHSDEF9MSHGXYGUTHSBSF9SOSJQFOZXMQGCUXAYWLBJHXOHTOM9ITZPISEXLAYAZBHTZDDCOIHKDBL9AAXZEDFHDYCPXLDGR9JTVXDXBC9DRDVREEEVGVPWVEZHJBYQYTGDEWQHVEDTAVLWW9WBXOIGDGUAAAVKFMPVKSYBVOIWPYGCMACEAAHGUIQVFLFMSCPKTYQWJDGMDNLMDIUUYI9SZOFQPLKKACESSWIXPFYZWDHETYUGEVASPHBGQPJPWVESSUUEVUYDYNQUQURSMCEPKIHYXNFHZSHIIDTMEZQ9IPSHTBDK9UHRSIIEJRILBCMVUMGAGBMHKEMUUKQDCYAVIAN9MBWJCAUSSJRSAUEUBGEFFCFSOBVGLXBAIDOH9NXWQUSIFUINEVZUWELLVIOSSQRVHMTDBCATBWFSDJJDLURAUKEQEIRICSCXAOJNPWHQKYVTRLCRKHLFHHHPYSMUEAPMQPMPS9CHCIYXEYRNIOOGRWKVHUGIWJZIGPWGZGBGYTVC9UVEJ9JBIYMDHYXLWIDXHZVFCCPLYXDPQPJGMKNZMMONGNXSNNPCGEGRJTMCPTJONGPAEDMSHMGAPGBDWVCSCTJAECSHTEGBMVCDZMQYZ9IHERWGCKAIMFOJRAEDRDSWJASV9XYS9CTOEETPQHRKJZ9FPWTVCGLEJQJXVVDTYZ9DNSHQAINKROQQIPTFGTABEELYPBQHGNNB9NCL9BVTG9MH99BPIRNNGC9MQQRH9YUDYSUJIDSZKCIGEKFSJ9PXUYKVPUZYFIREUAMUZE9EIMJK9YGAZXZBPRXIRDCEVDHWOCFIJTVRCRZRRJGFLILKVNMJAX9MUMTXCWTUTP9NXBZUMAYYY9DNVZTCROBCMMHVKSQRXMGROCMMCDENWQWBV9LEIJONWTQXOUQZOTGEJHJELYZOPICLDWPHVCMBFSYHPIJYZQDEGYITVPYNQMXPRTPKADLUKW9AEMSMGIWCUMOQMUDN9HZGYKTNVVNLOQAFVETEDJMJVKYCE9RE9AJP9RMYFKGDEC9GIGAFXEXIYXPFBOMRPULVJMYTQEPDMMIABDHJGRNNCKADZAUFV9WCWFYFHXLCED9E9SKKYHVKDTGNCHEKFJL9YJHTSRUVKEPHPCQSFNBXKOJNGBSEOZLVVGNUQTRACVGEKDSORUHVSDSQNUZASWXRADGAUDYDPODDEDNDDT9OAEARSBLPVSYAOEYYZJIZIZDENQOKMXATCTD9NEFVQWNCET9N9IXWCCWHYUBDTDJUZFXWMATRYSGJUQAFKAPIQIIXVFFEFNLGDPAIGKONUWLUTQTKZJYDEGPASTOMM9QTGOMYHFUKMNEVWPCMTLPDSOEEWDBRHZPZJIFMBUTY9QPRLPSVURIRMCWLH9YIZBOTJQMMF9ZP9VCCEGWVKSSQNANP9ZXVCAFGAVBXDJHUMKTKUBZRNKUGJTVUPDZMUK9KZI9EKY9DQDUNA9ZVPCROKYYPISSTDOJZJXMXZWSGZBEPKAUYPBPUTDVQKUYXWYTZXLYTCLLKLJUUJGFFCMZFKDTJET9KEDRMWZSAEFCSXLMRHRLG9EKLRZJ9NZQEONGFQSKSQMWRZXWVEGHCF9ZKGQITDLGFTZLCQMXVGVYIPKSUPPAOIKVWARJHAEJUZOOJFCFJTGQZWROSCEQSITQWZTQDFKECATBWSIRDFVWH9TXXUVEBRRKOTFSGBMGCMZDK9BJRVEUYOVNSLZNNSTWOB9CFNDJHJENDWSTIMMSWD9HSA9LDGTJDJFRGQCWOHYJNMFFLLDMVQEMCMNVQWMOGCEZUTK9MPULTDMKTIVFNVWXDNTRHNREHEDWIZCCRFVM9TXCTLBLYEKTRVVWHKZDOSYOBNLEKPNXMDZGLSVBBNBJIBZYBXZCENKVIXMNGUJUYFGFYFBKELSBZROQWKMESZTWDEEUCSXOWFSNJUGGJANMJFCBJV9GMDDJCAJHWKYQFJLFWZESTSIRBZQWYHGQDFUUWF9F9HXSBZRKBDLRWXSMKW99KPWJOQYPMHB9KWALSVLFNANYSMNWSJLUOCBKAWAJHNWMLPLXHVEPTKBPWLWHMDZ99999999999999999999999999999999999999999999999999999FDKW9AD99A99999999B99999999RJPQGE9AXNBBLPQ9IFJXFJTXJAIGDDXAWXGAVU9PJQNYFADJDIDBTJKSAEBBX9NWJGZVAVXYWXPCEFFH99XJLIVAZYJGPKEHANESX9DORLEIOIFL9WVQBBNUDRZDGJMVSRTSFKOJPIMEXPBCPGKUUEKRGAXOB99999XIFVJWCABR9XQKOWCXJAZDZWMWWBVHROBOPISAWDIJTSFPVAUZNJUMNUCOFIBIAAVIOWDTCNIPRVA9999999999999999999999999999999RSIDBWNOF999999999K99999999POWSRVIO9VMIJ99FKKNKGPNNNNP",
                "COSNPEACSPESTKTUS9CSMOCWVUBLERQJQGLLA9AYRRXMOVOBULQZZZJPLNELEX9EVZDAFOHBB9FBAYOTDB9YGJAVTDWNPJVVGEPFJ9QBYLXAYZEETY9GMYQRIRAIPWMJUFMFRSQRCEIOWISMBJKGCIGIIYNMXAYLXZIBNKANT9DSQXPBUPWGUJTOMD9JKSNFZJJFBZYBWRWQIZFOZXQWNJTRZTUPHVEGTAOLMBEPXOB9TCEBNIWXQUHNQJZHAOWGVOOOTSCTEUEMXJUODZP9CDLCMEXAW9YJGVNREENETEYXOAKZVRJVUSCRUSRCNZUGUOLCNHQITWYPJVJGPVULASTONDZRDVCNGJSN9DMMUORCOIBTITSPBXSAVTOHSAXHMGH99APRTQIVCEI9NWYKDOZCCWBNZGGCUCISSMGJHJ9OVSFBZVFMBODKRKSLIDESGFDQITCYFARWYTLFKSPLNVQ9LTYFODCHBAJKCWVZNBLOJH9ABFGDFOXHDNHZILINMYMVZYWTFJJOLADPTZRPJEMGPFQNYTFDGOKMDTDSKPTHIDWLMRSSACZMTHUCWVZHCYSPJRATABZ9JHWEBGTTQORGFOYDWUIYFYGOGGTYGYYI9RPKPMCTYNYKHHNWQKJTDQDHTRUYQPMCDDLVUUHUBPWGPMNQYPKHDHGIUSXJGNUXIYGZRGVYPTTV9KXJDLGVVXRIWIGKZJVCQ9DUWAYNDRKYCGKZDEOKZQCXELSQXLGLAPBDIWRTKGSIRNAZ9XFEGMWOWLPUA9TSGYRDOU9GKY9JJDKCJKKGJCRARGSNECJ9SEVAGPPJMBTMGNWSLNSFBOEYMIQBKOVSCTDIWCOQTHBVTZOFNNIYKKJLAROKIRFFPCLSOWO9BVNNJSXEYLJASPUEFKCEI9SGWADNGS9MZAKFTCAYNRVKGDIGYDTPGJXWFAEFGG9BX9XCNBZGQULH9IPPIQ9VFVAXGELUMCTE9TOFOGCTFYBYEBFOKKAESIIHEWLYLQKWDHPYNELJKMZHDSDSK9ZWFP99FQFLUXGTSVDMGHIFZFUCYTYPVEFEDM9TOHCQVIBXARYWZEKTWEOVSBYZTJZRUFZJCLRBTOWPTKY99CYQTGPMAKFYALIWPEQLUB9RGANTKDDMSDSJOTNPFZCXKJUGTJWWPK9FAJGPJOEBRHL9ZU9XRBDJBVMFIZIZFGKETH9RJUSDIOWDZIXFOJLT9DSIAWSCEYBNOGOAZQPZKVZTBXGACCBVQGFNGXNQFTVPUGUOHNBKTUERLSTDXGRKZSATIRHDBSXARYATBHOLUHCQGPRMQGSJUAXUCWKDXAUGORHFVVVDZQEYYGSV9IUM9VTMHJCIKBQD9TQLLYTZHAKDHPFGYMRGJOEDJKQTBBNFCKDEPYTPWUJEOPRJWHAILMVW9AXS9HAT9GCGRXZEHWNDOVGKGPWFXFC9IKLVZJCTGZUJFRHGL9FZWZYP9TPOWGOUTQ9INYBVTD9N9OV9AM9GYRJ99MRWRWLOAKJXMDTFNS9NZQAYGVZRJ9WVSIDRRQLGKH9VPUVKFWZMSRVVLKXUGJAZESC9LEYDNNDWS9WTWNFPCR9YKPOMIJAVHCRCJVBDFWSTDN9BPJRDMGZFXWTY9GUX9WEPJQMXSECFPREXAJ9DU9OLMNQFTF99QYZOGDUTMBHMNMCNUQTU9FTNEUNBT9NQO9YADGY9C9LQR9DYVJZE9GMMYAOUSWUIVJ9EAR9EEFCO9SZTQ9JQHPIJGXIOQZHOSUSVMHBOLTYSEONVLRISNAN9KJHHFFISTYIHYVAMXLPNALDELETXVSWGUWOIVKNAKZKNNRVNJKE9WMNQBXFGXSYZQQSIODAKINA9CPBOGAYKJ9V9GS9HERXSVYPEILYXC9GURBREBCXRZJVXHUOPGYFLPIFBCOTMHFTAAUQUZVEKOWYFFGSCXDFDBTSGZRMPQR9EYSZYGQETCWFDRXVOXXCUBOQTBQGVLAONSTSLURFYSDPAVNCXNWVPQOUORMVSLYISQUQKXFYYMJSGHQP9VAAZABEAGJMCPIEBZQSYCPS9CNKFBDRDTDA9C9MVKGUISRX9ODVUJNPDWMZ9ESYXJ99ETDGSTJZMZYJEGRUWTORMCLNHLDQ9YIJWPMDYGGJQHMFPJ9VKINJUESTCBJQXFTCJFNUXPZONVKXJRAYGKIWHXSBZRKBDLRWXSMKW99KPWJOQYPMHB9KWALSVLFNANYSMNWSJLUOCBKAWAJHNWMLPLXHVEPTKBPWLWHMD999999999999999999999999999999999999999999999999999999FDKW9AD99B99999999B99999999RJPQGE9AXNBBLPQ9IFJXFJTXJAIGDDXAWXGAVU9PJQNYFADJDIDBTJKSAEBBX9NWJGZVAVXYWXPCEFFH9XIFVJWCABR9XQKOWCXJAZDZWMWWBVHROBOPISAWDIJTSFPVAUZNJUMNUCOFIBIAAVIOWDTCNIPRVA9999FTXZAEQIKGFJABOGCCQGOMKNASGWCQWMNIMRDTHKPJMTKDGMEQNZOAYARIYEWFZYJALRKFODOITTZ9999999999999999999999999999999LLHDBWNOF999999999K99999999POWSRVIO9VMIJ99UMGMTTTPNNNV",
        };
        List<TransactionViewModel> transactions = persistAndMapTxs(trytes);
        try {
            BundleValidator.Validity validity = BundleValidator.validate(tangle, transactions.get(0).getHash(),
                    BundleValidator.MODE_VALIDATE_ALL, new LinkedList<>());
            assertEquals("the bundle should be valid", BundleValidator.Validity.VALID, validity);
        } catch (Exception e) {
            e.printStackTrace();
        }
    }

    /*
        Bundle with invalid semantics used to test partial validation modes.

        [
           {
              "hash": "BRGUEBBTOSEGSBYX9NZUNAEWFTAJAXLBPMRLNRACDSZECBMBRQAPYSPRZKPTVCZQNZDYXPYGHLPGZ9999",
              "signatureMessageFragment": "999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999",
              "address": "999999999999999999999999999999999999999999999999999999999999999999999999999999999",
              "value": 100,
              "obsoleteTag": "VUA999999999999999999999999",
              "timestamp": 1564470943,
              "currentIndex": 4,
              "lastIndex": 5,
              "bundle": "OWBTVEDGRYG9FOGBCRLIFTIRZZEPGVJR9ZWQIHECTHWZHY9XJLKDNYSHBLBJFVIVEPLFKUFXJ9GIBFEWX",
              "trunkTransaction": "PTSKRNBAPGBSLEVWRJJLXXZMI9MYERD9VWWIEDKHELYJADWIHOPNLXZEJXHI9AOTGKSFSPYI9UUHZ9999",
              "branchTransaction": "NBAMUX9VSJWUWSFLXEYOYQJKPMUJGJGHQCWN9SNBPPMKAHJGJUZM9ZXEVPQUFAJXRBGPGMTNCAMJA9999",
              "tag": "999999999999999999999999999",
              "attachmentTimestamp": 1564470945152,
              "attachmentTimestampLowerBound": 0,
              "attachmentTimestampUpperBound": 11,
              "nonce": "QJA9999999RSA99999999999999"
           },
           {
              "hash": "PTSKRNBAPGBSLEVWRJJLXXZMI9MYERD9VWWIEDKHELYJADWIHOPNLXZEJXHI9AOTGKSFSPYI9UUHZ9999",
              "signatureMessageFragment": "RXLDYF9YTHVXKLHXBCDBQBVWUBIAIHCYSWLYJWHKXUDULDPKKFISAAKXLCZ9YRRXEHSNQVSXYDCESIHNDJNUKEGNCNLDYQEIMBWTBLPGYEDZVQJIHOVWSM9BGWDEYWFRWBDSYUJALTQZGQLHMBUDEDBAUIPTLBDBICKWVRHAWSVIJCFZZLLUYQXNXYTMDHX9LACUBBL9WFLRIKLMLQEAKPOZSZELTBPWZDEAKDWQPBYKOSOFPYDFMYBDKKTMD9RTGDIUYBTNMLSZFVMMFKHEZJLVPXWUZQZVWJDHNFBWDLUTLYUGOSBY9TDLISTQVITEHASWQTKDJL9YEVKHZJHKJTVAQKEVJEYHBODAQRXOHZNJEGH9LTPSZDQKERMUMTLJUTXCH9I9CJCPKSPHA9JEDXQUPKETALMMENNEXVDCCVENIDCKASPHYCGINJ9GXYGSCIHQFRFMPWHUSFTAQAQHHFJFKVTEETEFURZBMBYKMRGLRHCDGDJDNI9MXVRCCMVEDMUFUENSRV9TEKHQTTCWB9XUSSDTQBMPQVDDNSCFKHDGWTFLAXYQRZWBMEQ9PRBOFSZBXIGDVGHNUK9DWKJ9KNRDBENFYOOGOSEB9R99X9BGMEUQWKOHCMOOVNCRNEFOVNGPWEE9RTKMNXGCKXLNZSHKVRAMMLBEPELHQLEVAYCNRCIMEJYVP9PXDMWIYQZPT9NELUSEOEXYRTQJAALWINHMXXKEOKAOGLYITQEUJ9XUIBABKCYUDTJXTNIEWTFKVTIINUJII9IUOGULW9B9PQIZNIEGXBSMIWO99NTUWXXZCUGMSLSJKD9VQTOFAOQHZCXTYAKQYECAFGKYFMUFPRZZXRSHJFVFXTFRTNGOXNQB9HDGKD9HLUAWXPDXZFIBJOVUFIMYWKEQZPPEFWAADKYCZMAYUNECVMDTJBLLIDDNU9BIOEADRH9CARXERZVDZAKBMWJOIVMWWEGNCAZYV9KVNLGIVYOLORVBLKRMOYWOXYYZZNPMWOCYABGPFQHWIFLNGACIQ9AQPPXEXZUCNWVNTP9GXLPOEDGVOY9QDHBYAKIWBJETKPQCFNEPCSUOPCWBBQGG9A9QZGIUMZHCGIUIVPN9NEQTHAABBNRWHKRSOAJQOKIARTWFREJVCNADOMQMOPIQSNCVVU9QWB9K9TJQTH9XRKMKTOESYZSGOGMMIHTMS9QDTXMPRIRJGEAXIWQBR9JAUCPOPJGQIG9BMXEMIGVD9GLNDGDH9YRESLXUULJPTPTLDBMNKGEG9TR9PWWVQPEFICAPCFLYYKEMUDAVTUZFTXIYZNXVCNCMVXIWWWLFGYFIN9TUQIBUHLDZJEUNMNFNWLCGAHQSJ9DTFNO9NSOQGAXHDGAPQDPWFH9KTEMCWMNMSCPQHWNWJQOXUOHEJDCZWPNGAUONXANYTLRKNUSRCPRFECJJNDQNYZJUSWQPSDYOEBIVSJYHMMNNSYTYXDXAWPRXPYAPLIVCXHKZHNEBPMNBMIVXGGOQQLINCHNOAPUCJDECBPEATZYXVEXZMEUDXXILFZIKJQFOUZAARYNDIPTPEJFVWDSIT9M9LSCEHSDOFAUUPJUYG9PNEWVSELPWVZVLJNIEQYSXQZMNRDQNLBTDKSJCMWRLOUOBGAFFWLSFQPMFLQPTPBV9PJNZOFFPMRXSSCGCIHUKTDMYLQFCRBT9JHAUXTRBA9NWTULJXZVJYRQGJNTXFNGTJUOZL9PQRPQHOEBSGIVSPKJVRHKBQKWROLXUJGNPEUQ9BMVJCPPVHWHBUEDRRBRSLSECZAIVSSJHCSDEAIFNPFOYRYLTLITHYEKGBSWCKFIDVSIYPQAPQHJDNXAUAEDAYBXOPIDB9XPNBEMFYZDCNHMNTBSBZMANXBGHZTJSWWS9KFEMKQJDLNAACGVSBWVCQHAG9DAMCWUBHLFYZILBQYTBBCPVQVFGNFVZPPSZMGKHZFSMJBLROKKCMZSXBPFA9RYWBDJIXYOJWNMLVRNQCIRJGQQPXHAYTKPDHNVDATYJRJGCNXHJOSEY9YSWIXEMJKYULPPDSASZQWFTK9NJNZKWZAYAAPAGTOZEPJXXWRCNWCYFFCWQ99MI99QBFAQZETMKG9EZ9UNLUGHZIBCILSDCGJIGXFAJMXHKXREUTE9LNBEWWWTMUZFOOWD9BHGXVGL9BXXXKQX",
              "address": "IOSKBLGGNONZVLMFNZEUTABNBIQF9ZTMNRDMPFZKOPCPXJVQHFWTNMBPTPYEDPPVEQHWUJGEWCNYKWABC",
              "value": -1000000,
              "obsoleteTag": "999999999999999999999999999",
              "timestamp": 1564470943,
              "currentIndex": 1,
              "lastIndex": 5,
              "bundle": "OWBTVEDGRYG9FOGBCRLIFTIRZZEPGVJR9ZWQIHECTHWZHY9XJLKDNYSHBLBJFVIVEPLFKUFXJ9GIBFEWX",
              "trunkTransaction": "MAAJVBUWQLZGRECIRXVEGVNJXTFQPNW9RKLUBLIGFDSQNMXZO9VMXLZZ9PATMJQFRICKJSXZBDPRZ9999",
              "branchTransaction": "NBAMUX9VSJWUWSFLXEYOYQJKPMUJGJGHQCWN9SNBPPMKAHJGJUZM9ZXEVPQUFAJXRBGPGMTNCAMJA9999",
              "tag": "999999999999999999999999999",
              "attachmentTimestamp": 1564470945010,
              "attachmentTimestampLowerBound": 0,
              "attachmentTimestampUpperBound": 11,
              "nonce": "BKC9999999XMC99999999999999"
           },
           {
              "hash": "MAAJVBUWQLZGRECIRXVEGVNJXTFQPNW9RKLUBLIGFDSQNMXZO9VMXLZZ9PATMJQFRICKJSXZBDPRZ9999",
              "signatureMessageFragment": "OWHZXN9UYGGFEVPDHVWSEIWWIFCVAPQUOLEWHKKIJHOZFYPDCCPHFTF9GARSNSDCNIYFOHVGHOJUMZWJCGSFWQHCRDBCN9KBPJD9ESKVRGSUBCGIGQKZEWPRFTFBJQBFVJLPU9NBTHVAOLHEHICPYOFARYVM9ZXDYWPNLYIC9VWDDQQKJMEYXMNQVUWZGPEEPBHYUBHQZIHKEUTHHKJFTRQWMXWWWQLNSZOVRSCKQOKZHIMYKXCBPBRDYOOLMMLYIQRNI9LQERYZNYIUTPB9IMWONCRUGMESTUMDTWWXEMLWROGXSWFHWMUMSVPHIDSZJJOWXTJNLNEOLFFDL9GVOFYHOAIPJGQDWEMZLEPIPCYZDAGJ9O9LMTGJEORGQYZASQXUPHWQRJEEABPSNC9TWRIV9DNRQUVVYMMZMVDYIOPQGDBKPVQO9VPJLEJIPOWNOAB9ILZFJH9WYHALVMYYLITQDAQJPZBHYDGNTYMWRFHLOXCWZUKVDUBJBXXYEE9QNPEMGARYLRJPGFWSTLOKISSLWTMUJYWBUVGKHZ9KNXTVXQPUMTNWFCCDFLNMEGMBSYAYNZKVZDNNCGYWAJPKCQCCAVULJGOSNNQLCFKITXORKQILXLHBBDBALSVRDZUHRKEJMMLDCNSBXHGJC9AGKZXATTURIKSYOLHDZVLBMYLCUSRTGIPHYIAIAVMZPJHRCFKXNRJVVWLMITOWXPXDNSWFXARUMRMLMZJTSJQYPBHLILPQQWHDCFKOFSOYDKGMSSTFINMQWARKXCDTZ9SASPKPPAYPZHWBTZTTB9JB9C9FP9IF9HCOKACUBKMPPSRRHMXLWJDNEXZKFX9KSAFPMMOEUVPRROROISLSTWAOVKE9OCCKIAUDFZXM9LCDM9VAJUNBVPHXULVUGZWUBWQITZBZIWREZGNNCCDYVUSQNCBTQARSKYGWHAOTRVMDUXHMWOTD9GACJPAAXFYLDISRDLGFIKJT9QWFZ9NXCDOIAIFDQBDUJBFVNUGTKFZIKZKXBKOLDQXODGGUGOQKGTKXUTGVRNWSDJREWTZUVCIFKULO9TZJSVJOYSAGIJCNBKTXRLVUXJGBHAZJFEDSMNFTADYVJ99PP9KBP9WJWHHZYMYATATVYUOMUETMHFRQUWQNNIESGQOFPNDLQZFCZLQWLSWXGJZFLHKAU9FXOPGDQMKDSSKVPOLCFLWOQBMLAOCGVKWZXWUDXLESJBKBIEGHPKOCDPITIYI9CHTMCLYMBXCLEYBNNEDAWSLDCPCOVCXXHXIRCU9EYYYJWNJARFOIJIJKTOVCJIKGDBAVOYEEBNMCMHSHKPEWVDSSRDDN9PUFQXJIMBLPHRYLTEIEJTIJIVAFXMGDIQNUZWBODOVROBSGMAYBSKQUZEISKZ9AGYAQNFNCVEQJPJCUJUJIKINMDHUOGRCORQKWBCCVV9UKYVYYZVLTUZNGBNGLSJGMD9GUTGJJGTLACCNUQTWRCVXAYDW9YMPEQRWGSIPFCUQZMYKKJMTSQ9ZN9YYYFOBTRLWHSBBJWGOTAZVPDGSI9N9MCJ99YEKQYCAUO9MHUCHMEAUTITOYRQBROKKWFZUILHBFBWCEWSVEPUCJSRR9XGVXAP9QXBZOHMPDNOQNNBPKUSWFQAABPTQH99Z9RMBASNZU9VYY9APLMFBGKW9QBRRHHKJQNOHSLWLHUY9NDUJTQSPIUQDBBK9VCAAVEDPHANDWYPAWVRNLQJPOELZPYNBWAK9KLSPAEESADMRPBAPYFGEWTZQLYTVMYBR9VCQJHZCFKBTPQEQHJOXCSFYQNJTFGTAHLLQGSBGTZOLFMFQEOOMBBURXEWWAHTZIYB9MHMUEKXAYALCFO9HSO9POINVKRVB9QHBANHY9YSAMACWFSHA9UGWI9RGTOMLXXTSNEVILPWJBFWBZUASAGTYWGTXHPUCWNCAVKPCKYFBMZMGAIMFHORQZHHKRQEUHOQEDQFRK9KATJAVCUVLLALKZUREIZOGAKUPZKPIBUQS9QCGVZJMNSBGVFURYKCEPKAPMWAVIRPJMTILBS9IGFOXGWTLTZHXGCTHUEGPRHIT9XZK9HEXRWDGTKMQPQFJPGYGFNYWJVRNREWPAEHGCOSNGUJEAMVJQKHDHKHHHZQTVEFNXGJSQSDPQMCK9QBRMOFVYQATOPYSJQMYLPEZ",
              "address": "IOSKBLGGNONZVLMFNZEUTABNBIQF9ZTMNRDMPFZKOPCPXJVQHFWTNMBPTPYEDPPVEQHWUJGEWCNYKWABC",
              "value": 0,
              "obsoleteTag": "999999999999999999999999999",
              "timestamp": 1564470943,
              "currentIndex": 2,
              "lastIndex": 5,
              "bundle": "OWBTVEDGRYG9FOGBCRLIFTIRZZEPGVJR9ZWQIHECTHWZHY9XJLKDNYSHBLBJFVIVEPLFKUFXJ9GIBFEWX",
              "trunkTransaction": "LYOQDNYZRSTLDWWCHQGERSFIGGMXRLHEVAZLPZXNXNHDPAFMQZ9QMFJDOSNEAGLPSTZMNLGS9X9YA9999",
              "branchTransaction": "NBAMUX9VSJWUWSFLXEYOYQJKPMUJGJGHQCWN9SNBPPMKAHJGJUZM9ZXEVPQUFAJXRBGPGMTNCAMJA9999",
              "tag": "999999999999999999999999999",
              "attachmentTimestamp": 1564470944698,
              "attachmentTimestampLowerBound": 0,
              "attachmentTimestampUpperBound": 11,
              "nonce": "AMA9999999LTH99999999999999"
           },
           {
              "hash": "LYOQDNYZRSTLDWWCHQGERSFIGGMXRLHEVAZLPZXNXNHDPAFMQZ9QMFJDOSNEAGLPSTZMNLGS9X9YA9999",
              "signatureMessageFragment": "999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999",
              "address": "AIUYNRQFJECFGMU9RUDT9MUFVRJZCMTMA9YZ9NWODBUHFQLHPCODTWLPUEPMALFSANRLBCTFAGDGTFUIW",
              "value": 1000,
              "obsoleteTag": "999999999999999999999999999",
              "timestamp": 1564470943,
              "currentIndex": 0,
              "lastIndex": 5,
              "bundle": "OWBTVEDGRYG9FOGBCRLIFTIRZZEPGVJR9ZWQIHECTHWZHY9XJLKDNYSHBLBJFVIVEPLFKUFXJ9GIBFEWX",
              "trunkTransaction": "NBAMUX9VSJWUWSFLXEYOYQJKPMUJGJGHQCWN9SNBPPMKAHJGJUZM9ZXEVPQUFAJXRBGPGMTNCAMJA9999",
              "branchTransaction": "TTDB9HOE9NZMXNYXEKNZVZSMDJUBDCA9ZZAQQFNLTWS9XIJCCIIZPEN9WMFKDHKOEXTCCPOZIKIQA9999",
              "tag": "999999999999999999999999999",
              "attachmentTimestamp": 1564470944390,
              "attachmentTimestampLowerBound": 0,
              "attachmentTimestampUpperBound": 11,
              "nonce": "TA99999999IBH99999999999999"
           }
        ]
     */

    @Test
    public void validationModeAllWithInvalidBundle() {
        // semantics are wrong
        String[] trytes = {
                "999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999SD9999999999999999999999999VUA999999999999999999999999GRJVAAD99D99999999E99999999OWBTVEDGRYG9FOGBCRLIFTIRZZEPGVJR9ZWQIHECTHWZHY9XJLKDNYSHBLBJFVIVEPLFKUFXJ9GIBFEWXPTSKRNBAPGBSLEVWRJJLXXZMI9MYERD9VWWIEDKHELYJADWIHOPNLXZEJXHI9AOTGKSFSPYI9UUHZ9999NBAMUX9VSJWUWSFLXEYOYQJKPMUJGJGHQCWN9SNBPPMKAHJGJUZM9ZXEVPQUFAJXRBGPGMTNCAMJA9999999999999999999999999999999ZFMBREOOF999999999K99999999QJA9999999RSA99999999999999",
                "RXLDYF9YTHVXKLHXBCDBQBVWUBIAIHCYSWLYJWHKXUDULDPKKFISAAKXLCZ9YRRXEHSNQVSXYDCESIHNDJNUKEGNCNLDYQEIMBWTBLPGYEDZVQJIHOVWSM9BGWDEYWFRWBDSYUJALTQZGQLHMBUDEDBAUIPTLBDBICKWVRHAWSVIJCFZZLLUYQXNXYTMDHX9LACUBBL9WFLRIKLMLQEAKPOZSZELTBPWZDEAKDWQPBYKOSOFPYDFMYBDKKTMD9RTGDIUYBTNMLSZFVMMFKHEZJLVPXWUZQZVWJDHNFBWDLUTLYUGOSBY9TDLISTQVITEHASWQTKDJL9YEVKHZJHKJTVAQKEVJEYHBODAQRXOHZNJEGH9LTPSZDQKERMUMTLJUTXCH9I9CJCPKSPHA9JEDXQUPKETALMMENNEXVDCCVENIDCKASPHYCGINJ9GXYGSCIHQFRFMPWHUSFTAQAQHHFJFKVTEETEFURZBMBYKMRGLRHCDGDJDNI9MXVRCCMVEDMUFUENSRV9TEKHQTTCWB9XUSSDTQBMPQVDDNSCFKHDGWTFLAXYQRZWBMEQ9PRBOFSZBXIGDVGHNUK9DWKJ9KNRDBENFYOOGOSEB9R99X9BGMEUQWKOHCMOOVNCRNEFOVNGPWEE9RTKMNXGCKXLNZSHKVRAMMLBEPELHQLEVAYCNRCIMEJYVP9PXDMWIYQZPT9NELUSEOEXYRTQJAALWINHMXXKEOKAOGLYITQEUJ9XUIBABKCYUDTJXTNIEWTFKVTIINUJII9IUOGULW9B9PQIZNIEGXBSMIWO99NTUWXXZCUGMSLSJKD9VQTOFAOQHZCXTYAKQYECAFGKYFMUFPRZZXRSHJFVFXTFRTNGOXNQB9HDGKD9HLUAWXPDXZFIBJOVUFIMYWKEQZPPEFWAADKYCZMAYUNECVMDTJBLLIDDNU9BIOEADRH9CARXERZVDZAKBMWJOIVMWWEGNCAZYV9KVNLGIVYOLORVBLKRMOYWOXYYZZNPMWOCYABGPFQHWIFLNGACIQ9AQPPXEXZUCNWVNTP9GXLPOEDGVOY9QDHBYAKIWBJETKPQCFNEPCSUOPCWBBQGG9A9QZGIUMZHCGIUIVPN9NEQTHAABBNRWHKRSOAJQOKIARTWFREJVCNADOMQMOPIQSNCVVU9QWB9K9TJQTH9XRKMKTOESYZSGOGMMIHTMS9QDTXMPRIRJGEAXIWQBR9JAUCPOPJGQIG9BMXEMIGVD9GLNDGDH9YRESLXUULJPTPTLDBMNKGEG9TR9PWWVQPEFICAPCFLYYKEMUDAVTUZFTXIYZNXVCNCMVXIWWWLFGYFIN9TUQIBUHLDZJEUNMNFNWLCGAHQSJ9DTFNO9NSOQGAXHDGAPQDPWFH9KTEMCWMNMSCPQHWNWJQOXUOHEJDCZWPNGAUONXANYTLRKNUSRCPRFECJJNDQNYZJUSWQPSDYOEBIVSJYHMMNNSYTYXDXAWPRXPYAPLIVCXHKZHNEBPMNBMIVXGGOQQLINCHNOAPUCJDECBPEATZYXVEXZMEUDXXILFZIKJQFOUZAARYNDIPTPEJFVWDSIT9M9LSCEHSDOFAUUPJUYG9PNEWVSELPWVZVLJNIEQYSXQZMNRDQNLBTDKSJCMWRLOUOBGAFFWLSFQPMFLQPTPBV9PJNZOFFPMRXSSCGCIHUKTDMYLQFCRBT9JHAUXTRBA9NWTULJXZVJYRQGJNTXFNGTJUOZL9PQRPQHOEBSGIVSPKJVRHKBQKWROLXUJGNPEUQ9BMVJCPPVHWHBUEDRRBRSLSECZAIVSSJHCSDEAIFNPFOYRYLTLITHYEKGBSWCKFIDVSIYPQAPQHJDNXAUAEDAYBXOPIDB9XPNBEMFYZDCNHMNTBSBZMANXBGHZTJSWWS9KFEMKQJDLNAACGVSBWVCQHAG9DAMCWUBHLFYZILBQYTBBCPVQVFGNFVZPPSZMGKHZFSMJBLROKKCMZSXBPFA9RYWBDJIXYOJWNMLVRNQCIRJGQQPXHAYTKPDHNVDATYJRJGCNXHJOSEY9YSWIXEMJKYULPPDSASZQWFTK9NJNZKWZAYAAPAGTOZEPJXXWRCNWCYFFCWQ99MI99QBFAQZETMKG9EZ9UNLUGHZIBCILSDCGJIGXFAJMXHKXREUTE9LNBEWWWTMUZFOOWD9BHGXVGL9BXXXKQXIOSKBLGGNONZVLMFNZEUTABNBIQF9ZTMNRDMPFZKOPCPXJVQHFWTNMBPTPYEDPPVEQHWUJGEWCNYKWABCZGECY9999999999999999999999999999999999999999999999999GRJVAAD99A99999999E99999999OWBTVEDGRYG9FOGBCRLIFTIRZZEPGVJR9ZWQIHECTHWZHY9XJLKDNYSHBLBJFVIVEPLFKUFXJ9GIBFEWXMAAJVBUWQLZGRECIRXVEGVNJXTFQPNW9RKLUBLIGFDSQNMXZO9VMXLZZ9PATMJQFRICKJSXZBDPRZ9999NBAMUX9VSJWUWSFLXEYOYQJKPMUJGJGHQCWN9SNBPPMKAHJGJUZM9ZXEVPQUFAJXRBGPGMTNCAMJA9999999999999999999999999999999SAMBREOOF999999999K99999999BKC9999999XMC99999999999999",
                "OWHZXN9UYGGFEVPDHVWSEIWWIFCVAPQUOLEWHKKIJHOZFYPDCCPHFTF9GARSNSDCNIYFOHVGHOJUMZWJCGSFWQHCRDBCN9KBPJD9ESKVRGSUBCGIGQKZEWPRFTFBJQBFVJLPU9NBTHVAOLHEHICPYOFARYVM9ZXDYWPNLYIC9VWDDQQKJMEYXMNQVUWZGPEEPBHYUBHQZIHKEUTHHKJFTRQWMXWWWQLNSZOVRSCKQOKZHIMYKXCBPBRDYOOLMMLYIQRNI9LQERYZNYIUTPB9IMWONCRUGMESTUMDTWWXEMLWROGXSWFHWMUMSVPHIDSZJJOWXTJNLNEOLFFDL9GVOFYHOAIPJGQDWEMZLEPIPCYZDAGJ9O9LMTGJEORGQYZASQXUPHWQRJEEABPSNC9TWRIV9DNRQUVVYMMZMVDYIOPQGDBKPVQO9VPJLEJIPOWNOAB9ILZFJH9WYHALVMYYLITQDAQJPZBHYDGNTYMWRFHLOXCWZUKVDUBJBXXYEE9QNPEMGARYLRJPGFWSTLOKISSLWTMUJYWBUVGKHZ9KNXTVXQPUMTNWFCCDFLNMEGMBSYAYNZKVZDNNCGYWAJPKCQCCAVULJGOSNNQLCFKITXORKQILXLHBBDBALSVRDZUHRKEJMMLDCNSBXHGJC9AGKZXATTURIKSYOLHDZVLBMYLCUSRTGIPHYIAIAVMZPJHRCFKXNRJVVWLMITOWXPXDNSWFXARUMRMLMZJTSJQYPBHLILPQQWHDCFKOFSOYDKGMSSTFINMQWARKXCDTZ9SASPKPPAYPZHWBTZTTB9JB9C9FP9IF9HCOKACUBKMPPSRRHMXLWJDNEXZKFX9KSAFPMMOEUVPRROROISLSTWAOVKE9OCCKIAUDFZXM9LCDM9VAJUNBVPHXULVUGZWUBWQITZBZIWREZGNNCCDYVUSQNCBTQARSKYGWHAOTRVMDUXHMWOTD9GACJPAAXFYLDISRDLGFIKJT9QWFZ9NXCDOIAIFDQBDUJBFVNUGTKFZIKZKXBKOLDQXODGGUGOQKGTKXUTGVRNWSDJREWTZUVCIFKULO9TZJSVJOYSAGIJCNBKTXRLVUXJGBHAZJFEDSMNFTADYVJ99PP9KBP9WJWHHZYMYATATVYUOMUETMHFRQUWQNNIESGQOFPNDLQZFCZLQWLSWXGJZFLHKAU9FXOPGDQMKDSSKVPOLCFLWOQBMLAOCGVKWZXWUDXLESJBKBIEGHPKOCDPITIYI9CHTMCLYMBXCLEYBNNEDAWSLDCPCOVCXXHXIRCU9EYYYJWNJARFOIJIJKTOVCJIKGDBAVOYEEBNMCMHSHKPEWVDSSRDDN9PUFQXJIMBLPHRYLTEIEJTIJIVAFXMGDIQNUZWBODOVROBSGMAYBSKQUZEISKZ9AGYAQNFNCVEQJPJCUJUJIKINMDHUOGRCORQKWBCCVV9UKYVYYZVLTUZNGBNGLSJGMD9GUTGJJGTLACCNUQTWRCVXAYDW9YMPEQRWGSIPFCUQZMYKKJMTSQ9ZN9YYYFOBTRLWHSBBJWGOTAZVPDGSI9N9MCJ99YEKQYCAUO9MHUCHMEAUTITOYRQBROKKWFZUILHBFBWCEWSVEPUCJSRR9XGVXAP9QXBZOHMPDNOQNNBPKUSWFQAABPTQH99Z9RMBASNZU9VYY9APLMFBGKW9QBRRHHKJQNOHSLWLHUY9NDUJTQSPIUQDBBK9VCAAVEDPHANDWYPAWVRNLQJPOELZPYNBWAK9KLSPAEESADMRPBAPYFGEWTZQLYTVMYBR9VCQJHZCFKBTPQEQHJOXCSFYQNJTFGTAHLLQGSBGTZOLFMFQEOOMBBURXEWWAHTZIYB9MHMUEKXAYALCFO9HSO9POINVKRVB9QHBANHY9YSAMACWFSHA9UGWI9RGTOMLXXTSNEVILPWJBFWBZUASAGTYWGTXHPUCWNCAVKPCKYFBMZMGAIMFHORQZHHKRQEUHOQEDQFRK9KATJAVCUVLLALKZUREIZOGAKUPZKPIBUQS9QCGVZJMNSBGVFURYKCEPKAPMWAVIRPJMTILBS9IGFOXGWTLTZHXGCTHUEGPRHIT9XZK9HEXRWDGTKMQPQFJPGYGFNYWJVRNREWPAEHGCOSNGUJEAMVJQKHDHKHHHZQTVEFNXGJSQSDPQMCK9QBRMOFVYQATOPYSJQMYLPEZIOSKBLGGNONZVLMFNZEUTABNBIQF9ZTMNRDMPFZKOPCPXJVQHFWTNMBPTPYEDPPVEQHWUJGEWCNYKWABC999999999999999999999999999999999999999999999999999999GRJVAAD99B99999999E99999999OWBTVEDGRYG9FOGBCRLIFTIRZZEPGVJR9ZWQIHECTHWZHY9XJLKDNYSHBLBJFVIVEPLFKUFXJ9GIBFEWXLYOQDNYZRSTLDWWCHQGERSFIGGMXRLHEVAZLPZXNXNHDPAFMQZ9QMFJDOSNEAGLPSTZMNLGS9X9YA9999NBAMUX9VSJWUWSFLXEYOYQJKPMUJGJGHQCWN9SNBPPMKAHJGJUZM9ZXEVPQUFAJXRBGPGMTNCAMJA9999999999999999999999999999999DPMBREOOF999999999K99999999AMA9999999LTH99999999999999",
                "999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999AIUYNRQFJECFGMU9RUDT9MUFVRJZCMTMA9YZ9NWODBUHFQLHPCODTWLPUEPMALFSANRLBCTFAGDGTFUIWAJA999999999999999999999999999999999999999999999999999GRJVAAD99999999999E99999999OWBTVEDGRYG9FOGBCRLIFTIRZZEPGVJR9ZWQIHECTHWZHY9XJLKDNYSHBLBJFVIVEPLFKUFXJ9GIBFEWXNBAMUX9VSJWUWSFLXEYOYQJKPMUJGJGHQCWN9SNBPPMKAHJGJUZM9ZXEVPQUFAJXRBGPGMTNCAMJA9999TTDB9HOE9NZMXNYXEKNZVZSMDJUBDCA9ZZAQQFNLTWS9XIJCCIIZPEN9WMFKDHKOEXTCCPOZIKIQA9999999999999999999999999999999TELBREOOF999999999K99999999TA99999999IBH99999999999999",
        };
        List<TransactionViewModel> transactions = persistAndMapTxs(trytes);
        try {
            BundleValidator.Validity validity = BundleValidator.validate(tangle, transactions.get(0).getHash(),
                    BundleValidator.MODE_VALIDATE_ALL, new LinkedList<>());
            assertEquals("the bundle should be invalid", BundleValidator.Validity.INVALID, validity);
        } catch (Exception e) {
            e.printStackTrace();
        }
    }

    @Test
    public void validationModeBundleHash() {
        // semantics are wrong (indices) but bundle hash is valid
        String[] trytes = {
                "999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999SD9999999999999999999999999VUA999999999999999999999999GRJVAAD99D99999999E99999999OWBTVEDGRYG9FOGBCRLIFTIRZZEPGVJR9ZWQIHECTHWZHY9XJLKDNYSHBLBJFVIVEPLFKUFXJ9GIBFEWXPTSKRNBAPGBSLEVWRJJLXXZMI9MYERD9VWWIEDKHELYJADWIHOPNLXZEJXHI9AOTGKSFSPYI9UUHZ9999NBAMUX9VSJWUWSFLXEYOYQJKPMUJGJGHQCWN9SNBPPMKAHJGJUZM9ZXEVPQUFAJXRBGPGMTNCAMJA9999999999999999999999999999999ZFMBREOOF999999999K99999999QJA9999999RSA99999999999999",
                "RXLDYF9YTHVXKLHXBCDBQBVWUBIAIHCYSWLYJWHKXUDULDPKKFISAAKXLCZ9YRRXEHSNQVSXYDCESIHNDJNUKEGNCNLDYQEIMBWTBLPGYEDZVQJIHOVWSM9BGWDEYWFRWBDSYUJALTQZGQLHMBUDEDBAUIPTLBDBICKWVRHAWSVIJCFZZLLUYQXNXYTMDHX9LACUBBL9WFLRIKLMLQEAKPOZSZELTBPWZDEAKDWQPBYKOSOFPYDFMYBDKKTMD9RTGDIUYBTNMLSZFVMMFKHEZJLVPXWUZQZVWJDHNFBWDLUTLYUGOSBY9TDLISTQVITEHASWQTKDJL9YEVKHZJHKJTVAQKEVJEYHBODAQRXOHZNJEGH9LTPSZDQKERMUMTLJUTXCH9I9CJCPKSPHA9JEDXQUPKETALMMENNEXVDCCVENIDCKASPHYCGINJ9GXYGSCIHQFRFMPWHUSFTAQAQHHFJFKVTEETEFURZBMBYKMRGLRHCDGDJDNI9MXVRCCMVEDMUFUENSRV9TEKHQTTCWB9XUSSDTQBMPQVDDNSCFKHDGWTFLAXYQRZWBMEQ9PRBOFSZBXIGDVGHNUK9DWKJ9KNRDBENFYOOGOSEB9R99X9BGMEUQWKOHCMOOVNCRNEFOVNGPWEE9RTKMNXGCKXLNZSHKVRAMMLBEPELHQLEVAYCNRCIMEJYVP9PXDMWIYQZPT9NELUSEOEXYRTQJAALWINHMXXKEOKAOGLYITQEUJ9XUIBABKCYUDTJXTNIEWTFKVTIINUJII9IUOGULW9B9PQIZNIEGXBSMIWO99NTUWXXZCUGMSLSJKD9VQTOFAOQHZCXTYAKQYECAFGKYFMUFPRZZXRSHJFVFXTFRTNGOXNQB9HDGKD9HLUAWXPDXZFIBJOVUFIMYWKEQZPPEFWAADKYCZMAYUNECVMDTJBLLIDDNU9BIOEADRH9CARXERZVDZAKBMWJOIVMWWEGNCAZYV9KVNLGIVYOLORVBLKRMOYWOXYYZZNPMWOCYABGPFQHWIFLNGACIQ9AQPPXEXZUCNWVNTP9GXLPOEDGVOY9QDHBYAKIWBJETKPQCFNEPCSUOPCWBBQGG9A9QZGIUMZHCGIUIVPN9NEQTHAABBNRWHKRSOAJQOKIARTWFREJVCNADOMQMOPIQSNCVVU9QWB9K9TJQTH9XRKMKTOESYZSGOGMMIHTMS9QDTXMPRIRJGEAXIWQBR9JAUCPOPJGQIG9BMXEMIGVD9GLNDGDH9YRESLXUULJPTPTLDBMNKGEG9TR9PWWVQPEFICAPCFLYYKEMUDAVTUZFTXIYZNXVCNCMVXIWWWLFGYFIN9TUQIBUHLDZJEUNMNFNWLCGAHQSJ9DTFNO9NSOQGAXHDGAPQDPWFH9KTEMCWMNMSCPQHWNWJQOXUOHEJDCZWPNGAUONXANYTLRKNUSRCPRFECJJNDQNYZJUSWQPSDYOEBIVSJYHMMNNSYTYXDXAWPRXPYAPLIVCXHKZHNEBPMNBMIVXGGOQQLINCHNOAPUCJDECBPEATZYXVEXZMEUDXXILFZIKJQFOUZAARYNDIPTPEJFVWDSIT9M9LSCEHSDOFAUUPJUYG9PNEWVSELPWVZVLJNIEQYSXQZMNRDQNLBTDKSJCMWRLOUOBGAFFWLSFQPMFLQPTPBV9PJNZOFFPMRXSSCGCIHUKTDMYLQFCRBT9JHAUXTRBA9NWTULJXZVJYRQGJNTXFNGTJUOZL9PQRPQHOEBSGIVSPKJVRHKBQKWROLXUJGNPEUQ9BMVJCPPVHWHBUEDRRBRSLSECZAIVSSJHCSDEAIFNPFOYRYLTLITHYEKGBSWCKFIDVSIYPQAPQHJDNXAUAEDAYBXOPIDB9XPNBEMFYZDCNHMNTBSBZMANXBGHZTJSWWS9KFEMKQJDLNAACGVSBWVCQHAG9DAMCWUBHLFYZILBQYTBBCPVQVFGNFVZPPSZMGKHZFSMJBLROKKCMZSXBPFA9RYWBDJIXYOJWNMLVRNQCIRJGQQPXHAYTKPDHNVDATYJRJGCNXHJOSEY9YSWIXEMJKYULPPDSASZQWFTK9NJNZKWZAYAAPAGTOZEPJXXWRCNWCYFFCWQ99MI99QBFAQZETMKG9EZ9UNLUGHZIBCILSDCGJIGXFAJMXHKXREUTE9LNBEWWWTMUZFOOWD9BHGXVGL9BXXXKQXIOSKBLGGNONZVLMFNZEUTABNBIQF9ZTMNRDMPFZKOPCPXJVQHFWTNMBPTPYEDPPVEQHWUJGEWCNYKWABCZGECY9999999999999999999999999999999999999999999999999GRJVAAD99A99999999E99999999OWBTVEDGRYG9FOGBCRLIFTIRZZEPGVJR9ZWQIHECTHWZHY9XJLKDNYSHBLBJFVIVEPLFKUFXJ9GIBFEWXMAAJVBUWQLZGRECIRXVEGVNJXTFQPNW9RKLUBLIGFDSQNMXZO9VMXLZZ9PATMJQFRICKJSXZBDPRZ9999NBAMUX9VSJWUWSFLXEYOYQJKPMUJGJGHQCWN9SNBPPMKAHJGJUZM9ZXEVPQUFAJXRBGPGMTNCAMJA9999999999999999999999999999999SAMBREOOF999999999K99999999BKC9999999XMC99999999999999",
                "OWHZXN9UYGGFEVPDHVWSEIWWIFCVAPQUOLEWHKKIJHOZFYPDCCPHFTF9GARSNSDCNIYFOHVGHOJUMZWJCGSFWQHCRDBCN9KBPJD9ESKVRGSUBCGIGQKZEWPRFTFBJQBFVJLPU9NBTHVAOLHEHICPYOFARYVM9ZXDYWPNLYIC9VWDDQQKJMEYXMNQVUWZGPEEPBHYUBHQZIHKEUTHHKJFTRQWMXWWWQLNSZOVRSCKQOKZHIMYKXCBPBRDYOOLMMLYIQRNI9LQERYZNYIUTPB9IMWONCRUGMESTUMDTWWXEMLWROGXSWFHWMUMSVPHIDSZJJOWXTJNLNEOLFFDL9GVOFYHOAIPJGQDWEMZLEPIPCYZDAGJ9O9LMTGJEORGQYZASQXUPHWQRJEEABPSNC9TWRIV9DNRQUVVYMMZMVDYIOPQGDBKPVQO9VPJLEJIPOWNOAB9ILZFJH9WYHALVMYYLITQDAQJPZBHYDGNTYMWRFHLOXCWZUKVDUBJBXXYEE9QNPEMGARYLRJPGFWSTLOKISSLWTMUJYWBUVGKHZ9KNXTVXQPUMTNWFCCDFLNMEGMBSYAYNZKVZDNNCGYWAJPKCQCCAVULJGOSNNQLCFKITXORKQILXLHBBDBALSVRDZUHRKEJMMLDCNSBXHGJC9AGKZXATTURIKSYOLHDZVLBMYLCUSRTGIPHYIAIAVMZPJHRCFKXNRJVVWLMITOWXPXDNSWFXARUMRMLMZJTSJQYPBHLILPQQWHDCFKOFSOYDKGMSSTFINMQWARKXCDTZ9SASPKPPAYPZHWBTZTTB9JB9C9FP9IF9HCOKACUBKMPPSRRHMXLWJDNEXZKFX9KSAFPMMOEUVPRROROISLSTWAOVKE9OCCKIAUDFZXM9LCDM9VAJUNBVPHXULVUGZWUBWQITZBZIWREZGNNCCDYVUSQNCBTQARSKYGWHAOTRVMDUXHMWOTD9GACJPAAXFYLDISRDLGFIKJT9QWFZ9NXCDOIAIFDQBDUJBFVNUGTKFZIKZKXBKOLDQXODGGUGOQKGTKXUTGVRNWSDJREWTZUVCIFKULO9TZJSVJOYSAGIJCNBKTXRLVUXJGBHAZJFEDSMNFTADYVJ99PP9KBP9WJWHHZYMYATATVYUOMUETMHFRQUWQNNIESGQOFPNDLQZFCZLQWLSWXGJZFLHKAU9FXOPGDQMKDSSKVPOLCFLWOQBMLAOCGVKWZXWUDXLESJBKBIEGHPKOCDPITIYI9CHTMCLYMBXCLEYBNNEDAWSLDCPCOVCXXHXIRCU9EYYYJWNJARFOIJIJKTOVCJIKGDBAVOYEEBNMCMHSHKPEWVDSSRDDN9PUFQXJIMBLPHRYLTEIEJTIJIVAFXMGDIQNUZWBODOVROBSGMAYBSKQUZEISKZ9AGYAQNFNCVEQJPJCUJUJIKINMDHUOGRCORQKWBCCVV9UKYVYYZVLTUZNGBNGLSJGMD9GUTGJJGTLACCNUQTWRCVXAYDW9YMPEQRWGSIPFCUQZMYKKJMTSQ9ZN9YYYFOBTRLWHSBBJWGOTAZVPDGSI9N9MCJ99YEKQYCAUO9MHUCHMEAUTITOYRQBROKKWFZUILHBFBWCEWSVEPUCJSRR9XGVXAP9QXBZOHMPDNOQNNBPKUSWFQAABPTQH99Z9RMBASNZU9VYY9APLMFBGKW9QBRRHHKJQNOHSLWLHUY9NDUJTQSPIUQDBBK9VCAAVEDPHANDWYPAWVRNLQJPOELZPYNBWAK9KLSPAEESADMRPBAPYFGEWTZQLYTVMYBR9VCQJHZCFKBTPQEQHJOXCSFYQNJTFGTAHLLQGSBGTZOLFMFQEOOMBBURXEWWAHTZIYB9MHMUEKXAYALCFO9HSO9POINVKRVB9QHBANHY9YSAMACWFSHA9UGWI9RGTOMLXXTSNEVILPWJBFWBZUASAGTYWGTXHPUCWNCAVKPCKYFBMZMGAIMFHORQZHHKRQEUHOQEDQFRK9KATJAVCUVLLALKZUREIZOGAKUPZKPIBUQS9QCGVZJMNSBGVFURYKCEPKAPMWAVIRPJMTILBS9IGFOXGWTLTZHXGCTHUEGPRHIT9XZK9HEXRWDGTKMQPQFJPGYGFNYWJVRNREWPAEHGCOSNGUJEAMVJQKHDHKHHHZQTVEFNXGJSQSDPQMCK9QBRMOFVYQATOPYSJQMYLPEZIOSKBLGGNONZVLMFNZEUTABNBIQF9ZTMNRDMPFZKOPCPXJVQHFWTNMBPTPYEDPPVEQHWUJGEWCNYKWABC999999999999999999999999999999999999999999999999999999GRJVAAD99B99999999E99999999OWBTVEDGRYG9FOGBCRLIFTIRZZEPGVJR9ZWQIHECTHWZHY9XJLKDNYSHBLBJFVIVEPLFKUFXJ9GIBFEWXLYOQDNYZRSTLDWWCHQGERSFIGGMXRLHEVAZLPZXNXNHDPAFMQZ9QMFJDOSNEAGLPSTZMNLGS9X9YA9999NBAMUX9VSJWUWSFLXEYOYQJKPMUJGJGHQCWN9SNBPPMKAHJGJUZM9ZXEVPQUFAJXRBGPGMTNCAMJA9999999999999999999999999999999DPMBREOOF999999999K99999999AMA9999999LTH99999999999999",
                "999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999AIUYNRQFJECFGMU9RUDT9MUFVRJZCMTMA9YZ9NWODBUHFQLHPCODTWLPUEPMALFSANRLBCTFAGDGTFUIWAJA999999999999999999999999999999999999999999999999999GRJVAAD99999999999E99999999OWBTVEDGRYG9FOGBCRLIFTIRZZEPGVJR9ZWQIHECTHWZHY9XJLKDNYSHBLBJFVIVEPLFKUFXJ9GIBFEWXNBAMUX9VSJWUWSFLXEYOYQJKPMUJGJGHQCWN9SNBPPMKAHJGJUZM9ZXEVPQUFAJXRBGPGMTNCAMJA9999TTDB9HOE9NZMXNYXEKNZVZSMDJUBDCA9ZZAQQFNLTWS9XIJCCIIZPEN9WMFKDHKOEXTCCPOZIKIQA9999999999999999999999999999999TELBREOOF999999999K99999999TA99999999IBH99999999999999",
        };
        List<TransactionViewModel> transactions = persistAndMapTxs(trytes);
        try {
            BundleValidator.Validity validity = BundleValidator.validate(tangle, transactions.get(0).getHash(),
                    BundleValidator.MODE_VALIDATE_BUNDLE_HASH |
                            BundleValidator.MODE_SKIP_TAIL_TX_EXISTENCE |
                            BundleValidator.MODE_SKIP_CACHED_VALIDITY, new LinkedList<>());
            assertEquals("the bundle should be valid", BundleValidator.Validity.VALID, validity);
        } catch (Exception e) {
            e.printStackTrace();
        }
    }

    @Test
    public void validationModeSignaturesOnBundleWithInvalidSemantics() {
        // semantics are wrong (indices) but the signature fragments are valid
        String[] trytes = {
                "999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999SD9999999999999999999999999VUA999999999999999999999999GRJVAAD99D99999999E99999999OWBTVEDGRYG9FOGBCRLIFTIRZZEPGVJR9ZWQIHECTHWZHY9XJLKDNYSHBLBJFVIVEPLFKUFXJ9GIBFEWXPTSKRNBAPGBSLEVWRJJLXXZMI9MYERD9VWWIEDKHELYJADWIHOPNLXZEJXHI9AOTGKSFSPYI9UUHZ9999NBAMUX9VSJWUWSFLXEYOYQJKPMUJGJGHQCWN9SNBPPMKAHJGJUZM9ZXEVPQUFAJXRBGPGMTNCAMJA9999999999999999999999999999999ZFMBREOOF999999999K99999999QJA9999999RSA99999999999999",
                "RXLDYF9YTHVXKLHXBCDBQBVWUBIAIHCYSWLYJWHKXUDULDPKKFISAAKXLCZ9YRRXEHSNQVSXYDCESIHNDJNUKEGNCNLDYQEIMBWTBLPGYEDZVQJIHOVWSM9BGWDEYWFRWBDSYUJALTQZGQLHMBUDEDBAUIPTLBDBICKWVRHAWSVIJCFZZLLUYQXNXYTMDHX9LACUBBL9WFLRIKLMLQEAKPOZSZELTBPWZDEAKDWQPBYKOSOFPYDFMYBDKKTMD9RTGDIUYBTNMLSZFVMMFKHEZJLVPXWUZQZVWJDHNFBWDLUTLYUGOSBY9TDLISTQVITEHASWQTKDJL9YEVKHZJHKJTVAQKEVJEYHBODAQRXOHZNJEGH9LTPSZDQKERMUMTLJUTXCH9I9CJCPKSPHA9JEDXQUPKETALMMENNEXVDCCVENIDCKASPHYCGINJ9GXYGSCIHQFRFMPWHUSFTAQAQHHFJFKVTEETEFURZBMBYKMRGLRHCDGDJDNI9MXVRCCMVEDMUFUENSRV9TEKHQTTCWB9XUSSDTQBMPQVDDNSCFKHDGWTFLAXYQRZWBMEQ9PRBOFSZBXIGDVGHNUK9DWKJ9KNRDBENFYOOGOSEB9R99X9BGMEUQWKOHCMOOVNCRNEFOVNGPWEE9RTKMNXGCKXLNZSHKVRAMMLBEPELHQLEVAYCNRCIMEJYVP9PXDMWIYQZPT9NELUSEOEXYRTQJAALWINHMXXKEOKAOGLYITQEUJ9XUIBABKCYUDTJXTNIEWTFKVTIINUJII9IUOGULW9B9PQIZNIEGXBSMIWO99NTUWXXZCUGMSLSJKD9VQTOFAOQHZCXTYAKQYECAFGKYFMUFPRZZXRSHJFVFXTFRTNGOXNQB9HDGKD9HLUAWXPDXZFIBJOVUFIMYWKEQZPPEFWAADKYCZMAYUNECVMDTJBLLIDDNU9BIOEADRH9CARXERZVDZAKBMWJOIVMWWEGNCAZYV9KVNLGIVYOLORVBLKRMOYWOXYYZZNPMWOCYABGPFQHWIFLNGACIQ9AQPPXEXZUCNWVNTP9GXLPOEDGVOY9QDHBYAKIWBJETKPQCFNEPCSUOPCWBBQGG9A9QZGIUMZHCGIUIVPN9NEQTHAABBNRWHKRSOAJQOKIARTWFREJVCNADOMQMOPIQSNCVVU9QWB9K9TJQTH9XRKMKTOESYZSGOGMMIHTMS9QDTXMPRIRJGEAXIWQBR9JAUCPOPJGQIG9BMXEMIGVD9GLNDGDH9YRESLXUULJPTPTLDBMNKGEG9TR9PWWVQPEFICAPCFLYYKEMUDAVTUZFTXIYZNXVCNCMVXIWWWLFGYFIN9TUQIBUHLDZJEUNMNFNWLCGAHQSJ9DTFNO9NSOQGAXHDGAPQDPWFH9KTEMCWMNMSCPQHWNWJQOXUOHEJDCZWPNGAUONXANYTLRKNUSRCPRFECJJNDQNYZJUSWQPSDYOEBIVSJYHMMNNSYTYXDXAWPRXPYAPLIVCXHKZHNEBPMNBMIVXGGOQQLINCHNOAPUCJDECBPEATZYXVEXZMEUDXXILFZIKJQFOUZAARYNDIPTPEJFVWDSIT9M9LSCEHSDOFAUUPJUYG9PNEWVSELPWVZVLJNIEQYSXQZMNRDQNLBTDKSJCMWRLOUOBGAFFWLSFQPMFLQPTPBV9PJNZOFFPMRXSSCGCIHUKTDMYLQFCRBT9JHAUXTRBA9NWTULJXZVJYRQGJNTXFNGTJUOZL9PQRPQHOEBSGIVSPKJVRHKBQKWROLXUJGNPEUQ9BMVJCPPVHWHBUEDRRBRSLSECZAIVSSJHCSDEAIFNPFOYRYLTLITHYEKGBSWCKFIDVSIYPQAPQHJDNXAUAEDAYBXOPIDB9XPNBEMFYZDCNHMNTBSBZMANXBGHZTJSWWS9KFEMKQJDLNAACGVSBWVCQHAG9DAMCWUBHLFYZILBQYTBBCPVQVFGNFVZPPSZMGKHZFSMJBLROKKCMZSXBPFA9RYWBDJIXYOJWNMLVRNQCIRJGQQPXHAYTKPDHNVDATYJRJGCNXHJOSEY9YSWIXEMJKYULPPDSASZQWFTK9NJNZKWZAYAAPAGTOZEPJXXWRCNWCYFFCWQ99MI99QBFAQZETMKG9EZ9UNLUGHZIBCILSDCGJIGXFAJMXHKXREUTE9LNBEWWWTMUZFOOWD9BHGXVGL9BXXXKQXIOSKBLGGNONZVLMFNZEUTABNBIQF9ZTMNRDMPFZKOPCPXJVQHFWTNMBPTPYEDPPVEQHWUJGEWCNYKWABCZGECY9999999999999999999999999999999999999999999999999GRJVAAD99A99999999E99999999OWBTVEDGRYG9FOGBCRLIFTIRZZEPGVJR9ZWQIHECTHWZHY9XJLKDNYSHBLBJFVIVEPLFKUFXJ9GIBFEWXMAAJVBUWQLZGRECIRXVEGVNJXTFQPNW9RKLUBLIGFDSQNMXZO9VMXLZZ9PATMJQFRICKJSXZBDPRZ9999NBAMUX9VSJWUWSFLXEYOYQJKPMUJGJGHQCWN9SNBPPMKAHJGJUZM9ZXEVPQUFAJXRBGPGMTNCAMJA9999999999999999999999999999999SAMBREOOF999999999K99999999BKC9999999XMC99999999999999",
                "OWHZXN9UYGGFEVPDHVWSEIWWIFCVAPQUOLEWHKKIJHOZFYPDCCPHFTF9GARSNSDCNIYFOHVGHOJUMZWJCGSFWQHCRDBCN9KBPJD9ESKVRGSUBCGIGQKZEWPRFTFBJQBFVJLPU9NBTHVAOLHEHICPYOFARYVM9ZXDYWPNLYIC9VWDDQQKJMEYXMNQVUWZGPEEPBHYUBHQZIHKEUTHHKJFTRQWMXWWWQLNSZOVRSCKQOKZHIMYKXCBPBRDYOOLMMLYIQRNI9LQERYZNYIUTPB9IMWONCRUGMESTUMDTWWXEMLWROGXSWFHWMUMSVPHIDSZJJOWXTJNLNEOLFFDL9GVOFYHOAIPJGQDWEMZLEPIPCYZDAGJ9O9LMTGJEORGQYZASQXUPHWQRJEEABPSNC9TWRIV9DNRQUVVYMMZMVDYIOPQGDBKPVQO9VPJLEJIPOWNOAB9ILZFJH9WYHALVMYYLITQDAQJPZBHYDGNTYMWRFHLOXCWZUKVDUBJBXXYEE9QNPEMGARYLRJPGFWSTLOKISSLWTMUJYWBUVGKHZ9KNXTVXQPUMTNWFCCDFLNMEGMBSYAYNZKVZDNNCGYWAJPKCQCCAVULJGOSNNQLCFKITXORKQILXLHBBDBALSVRDZUHRKEJMMLDCNSBXHGJC9AGKZXATTURIKSYOLHDZVLBMYLCUSRTGIPHYIAIAVMZPJHRCFKXNRJVVWLMITOWXPXDNSWFXARUMRMLMZJTSJQYPBHLILPQQWHDCFKOFSOYDKGMSSTFINMQWARKXCDTZ9SASPKPPAYPZHWBTZTTB9JB9C9FP9IF9HCOKACUBKMPPSRRHMXLWJDNEXZKFX9KSAFPMMOEUVPRROROISLSTWAOVKE9OCCKIAUDFZXM9LCDM9VAJUNBVPHXULVUGZWUBWQITZBZIWREZGNNCCDYVUSQNCBTQARSKYGWHAOTRVMDUXHMWOTD9GACJPAAXFYLDISRDLGFIKJT9QWFZ9NXCDOIAIFDQBDUJBFVNUGTKFZIKZKXBKOLDQXODGGUGOQKGTKXUTGVRNWSDJREWTZUVCIFKULO9TZJSVJOYSAGIJCNBKTXRLVUXJGBHAZJFEDSMNFTADYVJ99PP9KBP9WJWHHZYMYATATVYUOMUETMHFRQUWQNNIESGQOFPNDLQZFCZLQWLSWXGJZFLHKAU9FXOPGDQMKDSSKVPOLCFLWOQBMLAOCGVKWZXWUDXLESJBKBIEGHPKOCDPITIYI9CHTMCLYMBXCLEYBNNEDAWSLDCPCOVCXXHXIRCU9EYYYJWNJARFOIJIJKTOVCJIKGDBAVOYEEBNMCMHSHKPEWVDSSRDDN9PUFQXJIMBLPHRYLTEIEJTIJIVAFXMGDIQNUZWBODOVROBSGMAYBSKQUZEISKZ9AGYAQNFNCVEQJPJCUJUJIKINMDHUOGRCORQKWBCCVV9UKYVYYZVLTUZNGBNGLSJGMD9GUTGJJGTLACCNUQTWRCVXAYDW9YMPEQRWGSIPFCUQZMYKKJMTSQ9ZN9YYYFOBTRLWHSBBJWGOTAZVPDGSI9N9MCJ99YEKQYCAUO9MHUCHMEAUTITOYRQBROKKWFZUILHBFBWCEWSVEPUCJSRR9XGVXAP9QXBZOHMPDNOQNNBPKUSWFQAABPTQH99Z9RMBASNZU9VYY9APLMFBGKW9QBRRHHKJQNOHSLWLHUY9NDUJTQSPIUQDBBK9VCAAVEDPHANDWYPAWVRNLQJPOELZPYNBWAK9KLSPAEESADMRPBAPYFGEWTZQLYTVMYBR9VCQJHZCFKBTPQEQHJOXCSFYQNJTFGTAHLLQGSBGTZOLFMFQEOOMBBURXEWWAHTZIYB9MHMUEKXAYALCFO9HSO9POINVKRVB9QHBANHY9YSAMACWFSHA9UGWI9RGTOMLXXTSNEVILPWJBFWBZUASAGTYWGTXHPUCWNCAVKPCKYFBMZMGAIMFHORQZHHKRQEUHOQEDQFRK9KATJAVCUVLLALKZUREIZOGAKUPZKPIBUQS9QCGVZJMNSBGVFURYKCEPKAPMWAVIRPJMTILBS9IGFOXGWTLTZHXGCTHUEGPRHIT9XZK9HEXRWDGTKMQPQFJPGYGFNYWJVRNREWPAEHGCOSNGUJEAMVJQKHDHKHHHZQTVEFNXGJSQSDPQMCK9QBRMOFVYQATOPYSJQMYLPEZIOSKBLGGNONZVLMFNZEUTABNBIQF9ZTMNRDMPFZKOPCPXJVQHFWTNMBPTPYEDPPVEQHWUJGEWCNYKWABC999999999999999999999999999999999999999999999999999999GRJVAAD99B99999999E99999999OWBTVEDGRYG9FOGBCRLIFTIRZZEPGVJR9ZWQIHECTHWZHY9XJLKDNYSHBLBJFVIVEPLFKUFXJ9GIBFEWXLYOQDNYZRSTLDWWCHQGERSFIGGMXRLHEVAZLPZXNXNHDPAFMQZ9QMFJDOSNEAGLPSTZMNLGS9X9YA9999NBAMUX9VSJWUWSFLXEYOYQJKPMUJGJGHQCWN9SNBPPMKAHJGJUZM9ZXEVPQUFAJXRBGPGMTNCAMJA9999999999999999999999999999999DPMBREOOF999999999K99999999AMA9999999LTH99999999999999",
                "999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999AIUYNRQFJECFGMU9RUDT9MUFVRJZCMTMA9YZ9NWODBUHFQLHPCODTWLPUEPMALFSANRLBCTFAGDGTFUIWAJA999999999999999999999999999999999999999999999999999GRJVAAD99999999999E99999999OWBTVEDGRYG9FOGBCRLIFTIRZZEPGVJR9ZWQIHECTHWZHY9XJLKDNYSHBLBJFVIVEPLFKUFXJ9GIBFEWXNBAMUX9VSJWUWSFLXEYOYQJKPMUJGJGHQCWN9SNBPPMKAHJGJUZM9ZXEVPQUFAJXRBGPGMTNCAMJA9999TTDB9HOE9NZMXNYXEKNZVZSMDJUBDCA9ZZAQQFNLTWS9XIJCCIIZPEN9WMFKDHKOEXTCCPOZIKIQA9999999999999999999999999999999TELBREOOF999999999K99999999TA99999999IBH99999999999999",
        };
        List<TransactionViewModel> transactions = persistAndMapTxs(trytes);
        try {
            BundleValidator.Validity validity = BundleValidator.validate(tangle, transactions.get(0).getHash(),
                    BundleValidator.MODE_VALIDATE_SIGNATURES |
                            BundleValidator.MODE_SKIP_TAIL_TX_EXISTENCE |
                            BundleValidator.MODE_SKIP_CACHED_VALIDITY, new LinkedList<>());
            assertEquals("the bundle should be valid", BundleValidator.Validity.VALID, validity);
        } catch (Exception e) {
            e.printStackTrace();
        }
    }

    @Test
    public void validationModeSignaturesOnBundleWithEmptyBundleHash() {
        // semantics (indices) and bundle hash (reset to 9s) are wrong but the signatures are valid
        // however, since this would lead to an infinite loading of the genesis transaction this bundle
        // will be deemed invalid
        String[] trytes = {
                "999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999SD9999999999999999999999999LD9999999999999999999999999S9MVAAD99D99999999E99999999999999999999999999999999999999999999999999999999999999999999999999999999999999999YTFFCTLLBBZ999AFTRHVH9EHCVHMBKQJCBITTJEPQCIINKMGAIUXZME9SXDDTXAYRCGNJVSGWFFAZ9999UTZFHYUVCRYFXFXNQ9E9ER9ARTNMXTZXWVVBBUNQXELPEFQODXSNSQZSBGVGMSOBFSNTNOIHDHAV99999999999999999999999999999999CGIQWEOOF999999999K99999999NMA9999999LL999999999999999",
                "A9BQQJMUET9OYFSPUIRCENECVZVKGAKMLEPDI9IRTTDOKEKDNEEMYRVRXVUHFOTLGUHRWYOOMQKDIZQZ9XDAUTOPAMALZGRWPZMACAMHINQNCRYZQZ9GJFYZXOJNDGNNBYVZPNMIWZEYXWADJWIZJGP9LWQSQAHLX9XUFRJPFLAMYJFOHYCRLKQIAALMSAMRDFRGNIDUODDPXRZAYIKFQUVY9VQVCMPSZ9Z9NYDRUXCASSUPCQ9M9BYDJSATGKTAMOQIRGYEKSUYQMJYAALZOPULJECVOXULAPXI9PJZZXQOQWNESKRGWJQKXAWHDIHTFHZXYORPPIMO9GMJJBZH9SLEYLMWUVOGT9WPVABCFYLGSWYQILJVJUGEVSGUTUEQLEQKQSNPURQSZYEFVR9OWMYJJXOBPYVFOKMDJJYAQZNMXZTTEMCFDTXHJUKXLN9ITY9XBRLWDZSXOPLKSGXVVRPYDR9PAYNVEYJNNAPAFYYJZWILAGZIJWMIKZNILNZRFNVJWQVPETVVSTQTJUGQRAW9UZKURMDQSMUO9WAUTM9ZBNXG9ELJYCDJIQKLDP9FUYUACZZSPUVZVTVZIPPTNLBGQ9DTQNYGCTWHHRYZUAQBX9XRRVHXFHN9TRILFSTRQMRFCIVZAEMIRJUJAPTUOWMEZNYYNWINIZKVZOTQSJTZCCBMXFOTHSBEQWGD9KXVKSIDMNCUACBDLE9WKYPJJ9G9CSNDWNKRGQPBTZXGKLKCRRMSIIYURLFSUMSW9AVHTQ99HDOURXJPGIVUWVMIUMZYUEOFAEOOPXPWUZCAYDCKOSWLWY9AUWEYHLKYSGMA9NINNOGYV9CYEKXJF9CDXMYZDNGLLBMMRROT9VOUHJRZKAVJKHWWMHMGCJCXNLQYWUOETLBYJLUVOYGPYYVZHRBRANGICKVWPWKGHVYLWSJODQYRYGKJWNFRQXFFLBWDEZODOHCGNFDYQZVTOFRUWYOKCNRNIAOXOHUAQXHOCFVFWGPWGFTQVPYN9OFZQMRBLWPSGALDUFEQDP9V9QKUAFLPKFZNCVPPGEDBUCGZGRYPLROTCIHEUH9YMDHLTK9CNT9BHPMZHTERQZGDZMNOSHSKHTZNP9S9EQRYDLUOHIEDACETA99FRHAJPMRIQGXEGLLMMYHQFTHBVAOWLTGKTDIHYKKFKLFD9FQAGTNEFEHGRWBTVSCYTGGZONQCRCXDBXSXFQGCEXZACN9XYPVAYTNSYFBOQYFNIQ9FABR9ZZIZWWJY9GGTWYZEUYGZTFDZQVBAJQCXHLA9OQODYLCBFGTNGXXDYMTIZTOLZELUJTOYFWMQYPGTTQNKUICCODOXXTFEVQSLZYGOKHESQYFGGJUPISMETQFLAEKK9CFYHLCVADXKEQULXQWUAVZ9ZTKNQIBUIT9ELER9SSEBKVEPIHRQKAPRVHAKFBMCFHYDJZKZTNOAVWVKQH9HI9IMHOTDYBDUNVKHSBVIXOFQRNTIJTPOQNUDRJFSYTWCKIBLROGDTREBLETFYEBGVACGJDBT9WWKASXNCGRUAVK9ZDUIMAG9UCSHLIBQIYIITNNIYEXHSYSKFESZTKPDOMITDJJJISDZPZKLXLHWW9HNWOEWNCOKBOHTDCUZ9ZTALACJBOBPNJDZLYNPYHUGTBEEWXILVPGJOVUIYIYAOH9YR9WWKPOFBEGLJDULWYYIZPIXX9MHZRGNCVSXLLKZAOUPDE9APQF9ZYQPEKOCMYTKNJ9VAFBUIOVEHSVPQTSXAYQCOLPVFIGPULKHRYKLZWUUPVJQTWFWZEUGYRVFMHUNNAVHEBHYPSQLOIWFOZDMXDOJV99ZJWDQHQMSPTNA9OQDOJMNVLAULQBYX9XHVAJUDAJWMRDLXFQFWXXXMGOXQHKWK9QWFUFSMS9PSBRI9FGXYJHPICWQWLTEFTFUJDAGVC9SBCUA9GMHSCJRSBDWXSUIY9JTXJCIPTORLP9ZUHEZYLEAGAICYHGE9LPJO9TKJASVBSPARLUPNLAADWYMVBQEDRDFVYXYNAWLLNBGSKQGNNACTZMAWCZEOVRFNEBTBQYNMBNJNFFHZNSRCWVKAMLLDJSVAPDCZSPWLNJDXCRL9FFIPJLLGWOCFAYJMNIULBLNSSSMABCXEHVXKODVDCMXDUI9U9ULTJGRQNICHTJUIHWMFGEOFEFMTIXCMXCPDYALUMYNQBGHWTIUNURNDOXPJKVXSRYKA9XJIJHMTHECRDTDESYOTABNEZLUWNLWGQQCLTJHBB9CZGECY9999999999999999999999999999999999999999999999999S9MVAAD99A99999999E99999999999999999999999999999999999999999999999999999999999999999999999999999999999999999VWVUMNWQAIUBQIMDURVVBPEHFXKCABGQ9VPNNUQPJBLLIGSTJTMANXTSPOTAKOQPINAIRGFBLGSZ99999UTZFHYUVCRYFXFXNQ9E9ER9ARTNMXTZXWVVBBUNQXELPEFQODXSNSQZSBGVGMSOBFSNTNOIHDHAV99999999999999999999999999999999LQHQWEOOF999999999K99999999IVB9999999LRBA9999999999999",
                "SCNZVSIQU9ICDHHHLPPLCQFJQUZLSBYMIYMLSMUQNWLFALLNLNWSSCBAEWP9KEZUHTVWE9JIBBDBELSFXDMFNTIBMPBDJXFJMRZQTDDLPOZHMUZCJFMQGZWOPJCRCBXAGAERFYYI9XTR9RUGQVZMU9F9LLLLQEMMQYGYEZUMLCDLZFGOGJYJCMLFRAPCKGCBQBMPE9QVOBVYFB9NYKZPYNJBRPYHJPKRCVTVEZZLFFIMNTWXNIACGNVUYSKZCELFNJTZJLZVBBMALYGSTZJALTDJAKWCCJLEJKQEGFIIKFKBCPUXUB9ETBQSBAUZ9BEZLZHDNAEGSIECRAQHITSQOEKBTOTHUTRYSPGMIFCEDTBHHYKBXRNGCNONYSISCGIHYRPKNKMARNBWSTWABKAYCBYWURIRTSYOAPBQGZWKJQKKBZGXTYOZPNNSDBJBEQVTCBK9ZPQEXUYFKKD9NQVKIIQYXFIJJGYDKUFNC9GMIZTNVPGCNPNUD9SWJKCLENGBCMEVR9GAZNHLQ9INCPCLULDWSQFFCTJHKWWALPLFYF9VSSOHILTJYXZBPACXMZLV9GL9CRHBDIONQZBVRMWXFXKMVNBJVQDERTAMCRTLDRDESVVOURNZ9YOQNUHSCDLVSDWAPHYYMATPMUFZEDBYEWAXESZTCZT9AHXWNAJFOXNMGRCGKOXROBLVFRFATFOMMKQYQWBPIAJJLDNVORZXDPHOZCUBDQAWHEPCCURUJGXXAHUYYGJVTEFYEEHIGJ9URSIVGULKUIZSUML9NKAQOFBTOWAZBNPPXNYUFQF9JC9A9DOUWFRYVKOZZZSB9HTUTCQRLXLZHLYMLAHLMHLVLAFXRXSCYEEFWTQE9FVNJRM9QDBYJYCHVOGYIGWKBLZCXN9FORL9UN9JVNZCXFQXJYBGXXYWJ9VFPZUCRIXXUCWHMSJJBQHHRIXPYZXYXMPQFQ9HHPSSTSBD9CRWUHT9JBISIOQUPYNWIKKFDBGWVNDGJ9VVGNMPJLWLJGGYIJZQYRGELJLHBWMFNHNTSRNTXFAJKJRU9AJMXPHOAZGJJLHIAJMK9KUHPUSAEGXENREWNZINSBDCQWXPBACPWLPDRUNACTLSXTXLMOSONZEKALTT9CUVSUZNBYPNYRKKLHMZQENXIN9FGYIAXJAFEPSTOAEUBRWDTHVWTUIZTHZDQCUUSLFKKUSUVKRDYHDYRLD99UMKGHJYOBMQAFCIEJVRGFVAFSTVFOHZGHUCRBSIXHHHYOQTFSBHFRMZVAWTTX9GFJTWOWM9AVJRYQOXSIZRKIVAHSJCMK9HA9BOBGLGPWAVQXAVEBOTLAOJKXCPFENYPXHO9ANXGBT9RXJBSYBNPLTQUIOI9QWRCBEDLLDYYIUTHIDTLOUTQYERNM9TBSJIVXZNIWQKWINLSDCUXWXIFZUIEUKAIARKQEPQHYMHXJXMQIVGQYC99DU9KSCBAPNWGJCVXUIADAOXRBUEZBU9AWSDSMLQYMKZOGVBKGIIFHEUIJIMRXNBHKVHTISJTGSBQAYI9LBIRPNCSTNBEPMBPMBIPRFJYCSKVRCOIJCASFQZHCBANQOYEQKQ9ICS9RJKEBFVQRNWWVIVXAPQSNGXFHOOUOAQGSWWE9QGWTAGEXGEWNAHHJAYFXVAWG9JQDRDRAODYVTGDBTJSRAJACIR9MOPVNQULGKJFOQZDAWGFBXHIQTP9JKLTNQJD9CTYQOQPBQTVPZGJCA9LWECGUCZUIIWQYUUOHQGGESQVITQJWKZEJBICUQWAXPOKZEZVUHRAIBLPADDBPOVILY9CHPQKZBEMDNEEZGSUWRZRQPJKIPBXQIZZBNTLPCGD9ZLIYVLQYQUJS9ILQN99SQZZDMEWYLJH9ZGUMVHYJPAQLZUJBSLHWTAPFLOIOTZTATSXPDTK9QKBXSZDADONUZIATXEPSCAUSSYDMKYUEGB9RYUY9AXPKGSQKFGIBBKURKFHRGGP9JJCLNEAVNMGFMSXONGCOCMFUJTHKBMIKACHBLTDVTTKFYVOPQLEJQYZNISL9GYU9PKPLNYR9WUNFYIGKFAZNFODCJURDDSNHAMUJYFNNJNPDFLQVGFLPMJZDSDIUQTTUUWGKWTDGZEGMPJCMDHMTSXNMLPEHDHTHCUAYGBOP9WEENAPPSZNGWWSBANDNFOHRQXJJIQJZWCMXCPDYALUMYNQBGHWTIUNURNDOXPJKVXSRYKA9XJIJHMTHECRDTDESYOTABNEZLUWNLWGQQCLTJHBB9C999999999999999999999999999999999999999999999999999999S9MVAAD99B99999999E99999999999999999999999999999999999999999999999999999999999999999999999999999999999999999SYBDDSJJHSBSYUCVDXIYMWVZWLQNXGREFLIYJUOKNBIPGAQOIRQNBXKSXTYTVFRYLELPOXH9YT9S99999UTZFHYUVCRYFXFXNQ9E9ER9ARTNMXTZXWVVBBUNQXELPEFQODXSNSQZSBGVGMSOBFSNTNOIHDHAV99999999999999999999999999999999RIFQWEOOF999999999K99999999FLA9999999RGXA9999999999999",
                "999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999BNABIW9ZIDVLSREOBEHPNDAXVHDMONVQIOUCXZPLQJEAQ9NGLKSNMQMCBCLLFVJECJXKKOJVFIXTEXSICAJA999999999999999999999999999999999999999999999999999S9MVAAD99999999999E99999999999999999999999999999999999999999999999999999999999999999999999999999999999999999UTZFHYUVCRYFXFXNQ9E9ER9ARTNMXTZXWVVBBUNQXELPEFQODXSNSQZSBGVGMSOBFSNTNOIHDHAV99999II9GJDQDYDHVTGHUPJJP9REYOGBFIVTBSYKDECSXSNFZYGRPURFOVTHCNZCCZXOWDHHCKYWVUNGCZ9999999999999999999999999999999VLCQWEOOF999999999K99999999NB99999999UDZB9999999999999",
        };
        List<TransactionViewModel> transactions = persistAndMapTxs(trytes);
        try {
            BundleValidator.Validity validity = BundleValidator.validate(tangle, transactions.get(0).getHash(),
                    BundleValidator.MODE_VALIDATE_SIGNATURES |
                            BundleValidator.MODE_SKIP_TAIL_TX_EXISTENCE |
                            BundleValidator.MODE_SKIP_CACHED_VALIDITY, new LinkedList<>());
            assertEquals("the bundle should be invalid", BundleValidator.Validity.INVALID, validity);
        } catch (Exception e) {
            e.printStackTrace();
        }
    }

    @Test
    public void validationModeSignaturesOnBundleWithInvalidBundleHashAndSemantics() {
        // semantics (indices) and bundle hash (reset to As) are wrong but the signatures are valid
        String[] trytes = {
                "999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999SD9999999999999999999999999IH99999999999999999999999999KPWAAD99D99999999E99999999AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAHSXBIPEQEIDCLJWXMZVDTRVLMMQ9JCTYLZXAYXDGGHLKXMPMOHVEUSXJEEYOTHLTPIBNRNBVVVBEA9999UZBMW9VKUHJFZKOJAGLEUBKHO9JHUXTHPVVINMHJQOXESCBJYJETNLXEJNUSMVEISIOJVHLFSGRHA9999999999999999999999999999999CHVI9EOOF999999999K99999999JBB9999999UAK99999999999999",
                "FFVAYKZCSBYKZLLQ9VEHIIPXQULZSNSCBDQQTAYEYTPIT9MKXIMIYDKIHKJLAGSJIRKTSTAMZEXANRWBASOWZIPLIZJHOKKREXLYGGHQEK9KSGPBIBHQAYAHQIMGETNCMUJJ9MPVICFOHNXAGQQXUNAGUMBIGTDL9WAQNLYHHFVVADTQXNUNVKMDGLPPFB9HVAERYHDAJE9DSTYLDXZGEQZWGLTLKCZ9LASOELREPANSMXAPSKW9NGXTFZQXXOEWIMBJHPYJMKZMDHWVSSBBGKKSYXSDUPCVGRMXCIHXWDIUHPIFOWWOLKZJDQJQ9HLVHTGCOGIBBNEYMSBXDTQZTKEALLTLCNRVPZJUCPCTSOUJQDLNBOZODPGQHBZSLBAXIMCRFIM9MHZJWJWCEMRGDZHTR9FRCGTNTEYJUANDNDVIMTUZIUUVDQFGYIHKCBERRGEEHP9ARTZH9FRTRVPKKXKZNTLAENPQBFSIXDYKVWPEPF9ZBQGTNTEKQCQUVHBQTLORRFLPDRYLNYURHZQXMGM9MTVOEZVYBVMZGNNAHV9CLGUCNWRMIB9KKOMLKHY9KRALPXJRCUI9ZMCZVGURDARY9NEZCHWSWFWG9MWUVGCWHVGRYXGKQMND9BVYRHIMQRHPZVNWJUAXKXLHXUEJJPWDUICSF9UKQBKTQSEMDORDZODEFI9ROIVNJEDWPZQBGGVKFNSCQTLNDGULTUMVJMIVCNFNC9FVLWSQJNRRLFDPVWIQJQDWQAEGFGWSBKVITTWFMOJRCRIMVMJVUQEUHJRZSFZYIPRZJWXOSHJQTXDTXRTDOYC9TEGAQJLJ9UCXNZSTKFSLUNSNUKBVYLB9JFOPBV9KWDZWVSN9CQDVSBXZYKTKBPITZHMNKYCPVHGZMBWDNHDZMQRHYUSAKZSELHOMGBBMGCQII9HIROJIH9ZM9UQYLOMSUUQ9NRFSSYGEMPACEUQLDJZBPUWZQUAVXWSXQJLUQJKFOSSYOBJILXNLNCZDZXSXISEHJVOTHCWJQQJQOUJCNILHDRSXQXLRO9RFACXC9AFCYDUSJFXJKENPDTAZMMPLRKATFCLAUFPFRXZQX9TRIURKQNIOSCLGTRR9WJDXVMQEPRLGRBAUNQJWI9SURZEEBAPUYANWJAUAUJBSBXILVBOISJDSZJYWUAYDS9AAGXHOEOQOCHYRKVQYQEDZGNSIAGXIPCULYSXZJRROOXRXNNDLQ9VBWBQQEHLLCDSVJENQUTMBHJC9RUKELCHVGKZSWMJSNWDEJIUBQADLTJCAPOAVRRYZZBWODW9YHNJYXEUJLVYRJELVMCGLQDOBDKKUIGJYHXUINADBPWVYJOXZNKSTWCC9URQWOLTNBZRWP9LPDCGXTAQWXPRTNWFPJSBHAYTDHBSMKHVKCCGJFUWMKGB9PMLBDNNYUEHJXIEHPBQQEDBJJQEAXHWJZSFCSAWSNBNACEXPBOTE9USXPLCGUEUVAQ9MJRONFDN9LQFXLLYRTWFPTDRRIVSDZEJSYND9ZZEPZZ9PSRIVOHWO9FJPHIIQWGIC9DMSOCAJBHBQRFPZXJAKYDNKERA9UQDJHIHZMUCYFCKWTOLGV9UKNGRGSPNVVXJJUGCDQFRZLFDHFYECNCCSBYJBUQGSXF9UYOWAAUICX9ZPRXDMTBWWRXSEJIVPMMKFPIWOMLLQLD9KU9M9STWPDD9EX9ROZBVAMQHKB9UKBBPXSUZWRTLJUM9MPEFQKZFOBFYZMEKCY9R9ETOULKDGVICZOQZQBPTZMLE9PACNMWWFPWCVKXSIOXRUDSIWKQUORRVUOKOPQTGZNYEH9LHRGMKCZBBVLAYCBXTLCGEXRKUTKTAIIMTO9FCERELQQTXMTDLQCCEMTFQRNSACAXETSYKROSEPFHWIDXYCBHJWNDBCBGLCDORIDTCAYXGSFPNIMRPL9CS9T9RRBYGVFQP9RBEIAFJCOVXPYMNXKVXKBV9QSJMUUXPUXCAGHZEIPLVFMIJAJU9RMKIEAXOUMKXWFXOFXJS9CMOSCYYADDQTAIAEAROXSDNZECQWUWGGPOMGRAJLRWQTXMTORYTOXAVGPFUFZQYVMOLKJZPIDCCGODYGSQ9VPLJMBBGQQXOYHQJNAXZIBWM9PDEOOLCEUJKKWPMBCAYPXPNELACIIZKPHH9UKPV9LIKOFRFIT9WNKD9GFKYGINTHGVLJFGBAXXHMANDNPML9SSREVDAQYHCJONIOHSXACXIICKLVUGLYJAICGETRJJNDBAHAZGECY99999999999999999999999999999999999999999999999999KPWAAD99A99999999E99999999AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAKERFOUCALHHG99FQCDTMVKAZWABDCTFGGLZLKQQZHDWEXVLHDAEURIBNMCECUFUGNCSVGQCXJEAUZ9999UZBMW9VKUHJFZKOJAGLEUBKHO9JHUXTHPVVINMHJQOXESCBJYJETNLXEJNUSMVEISIOJVHLFSGRHA9999999999999999999999999999999RBVI9EOOF999999999K99999999WOA9999999CMD99999999999999",
                "SCCWBEUZHSISRJJCII9GPSFWV9SMKEWHZAIRL9CPZRPGNAQRMGVWCQD9SBNHISPTXDJ9CVERVVQCCRRMXKECHQHYEDJXGKFWZYXXNSKWPNHDFOCOCSHQPWMJTTUQVOYSMRNLBPJ9ZCSZMX9XDB9GYTLGDUGWKRQEXWFHBWPVIEYMSVCZWSINVLRJJLIJGLQDCCUNOKAHZYAYVUPSANBKHHMSPJLW9SF9JEZFHXFDXWF9XZ9RVBXGUZWKKG9LFY9PYYHHYAKOYI9G9IBLQ9JYTGHKTCRDJCOWTTWBZATCEMWCXWJCVXMK9IKWNOJTFFFAFFXXDQLSQSAMTXMMCVRWOTYRITZNMTOAUMONHIWXH9KXSTKGUMOOAMZVLMTSGDHTHJ9DRZNZUJSRPRHTAMVQASAMALXEDSILBILQMWTUYNTFCPIDVNAZGIJF9HMQFEY9ISBIMFDT9AV9OCVJREMHWDJYVZ9HPMGAWEGSYCDVPTVEXNRTEIPHEINFNLZRJVHTLHRDCQRURYLIUQ9MGYCOZDKPXULMPSDDIHAZFYHH9KLTAFTQIIWRCQWFPWOZOPJDKXOTPKNGPZ99NUVJOSGJFXBHPBIKZAOBOOZYJPIGSFNPIQTXSVWNBATPRPJF9DLXQVLCBLSWXNBUXVRPPBYXFEURQLZASAPM9GZFEAGVVUVWYKDNMQWKYXPMEOHIQ9AHQKDYNXFIMTUVXCTPGVZKCXNQBZASSNHSOYOWNYD9DVBOIIOUXBCP9WEEHAIULBTMLYQMVZHLTFPUDMT9G9IHMUDNYTGFQWRJCB9IBXIFGCEYUS9ZDXPFQFIAXZIJITZISN9NPNAIE9RXQEUSUEOQCZEQPQMWSXHNY9KOQTCGPYWEAOMOXWBN9IPZVEYQTWOCXPNTOZSPWYLKKDIXSMZJHDFCFNY9PVOLEXDNDRSCMGVEXWRAONWAYUINUPCEDNKSYPCHNZEISLGAQRCORHIEQRGMSQKZKRKU9DMXI9WRHYHENYBZLSKLDALMI9ECYKFEGCUYTJMBHYXKWLZNUJNAHENBL9HFBB9OYLDVYAHUCPBCQPXNSIJCS9QRHAVDZNQHLGXNUDKOUNETUALUVODFSVXOESPAHDSRO9OWKMQOLBXR9XBJBUSGWEZIYYGPFOVKDHFHDEBUZGEIGRWMPANQSANQVCFMNWZYD9SIADOFBTXISAUN9UNSXEFGDQTREQCGSM9VMSQINPNWMQHUABRZZVQHRHOB9LVLPWDFBMVPEVS9EHRPPYFYTWGOMIGMVAGYO9YR9VADKKSKYYVWHVBOYOVXVLEVWPXPVXQSLUHRXHRFREWTONWV9JUEWMHJJKAQCYCGHHEIJMMYIUYNEJQCQOCYDJWDETYKDQZBJLSODNSYRLQS9ZIAVDFIHAEOEIPQKOSDFHUUVLOVHOCBXQTMVQYVQOWFXYGDRPAIHGVZVPDGKTLVBXVKJWFGHLAEVSYKVNROEDSEXKJGOWACELHGDDUVAIQHRPP9WWEOE9SIKHGTRVFYEJBFOLFHYQDPMVPLG9XUQJERGEYZBWEGSZRQAESMHLFNPOJNPYEEHDAYMWVDHM9SHGIQ99QGNEAKWQQYWGUZPZRMTBEHTOGYUSXXDRAHFLCBXFFBQJRF9HBSCVSGRCWRCKHZJQKQVOB9ALHRBPTJMYRLXQNJVGCEJACIQNCEVISMUFYGT9FGZODMXQXAMQEKDTOJCG9KP9OXETW9FWWJDVBMPJLRZUXLIJMXCJBTELZWBMDUNECMGLIRIHGHFBHKEEIKFBNUVNUHUSHEVPNEMCVYSKKAOHGKKGMERXWOAPWRUHAOJETQFVZSLFTEKNLTTNOYS9EBPBSRITUYLISBNNZWYENUNSABVRTCE9TXRVAIIFIELJIXNGBLDHCPKAQEFWFRVPJYDNUICISVHEAEOSEHSHWURCKBLQ9TSIUXJCMSZERHWRAAYZQTISVEGATTXPPVSLUBRZYSVMYMDCIBJEYNNGNOYUOTSYQNHRDEQSPDVCEWGOWSLKEAZBV9UREBIOVZHYPJZBZWV9QRUZ9UNKDAVCEZOVUZBYNPYITGZKJ9WPEKBRKWLFJMSDYWORSAZVBGRIIZZZMCR9YWAWMW9NTZXUTDFLYXNEFWVCZLRVK9YLDPO9KSDKWAR9NRHHHVTOYKWFVHNKUAUNWXLOLZICECVXZNKD9GFKYGINTHGVLJFGBAXXHMANDNPML9SSREVDAQYHCJONIOHSXACXIICKLVUGLYJAICGETRJJNDBAHA9999999999999999999999999999999999999999999999999999999KPWAAD99B99999999E99999999AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABGGXCLUAOGRYLHJZBQVSAKWDKQHKRVNHZHQFKMQ99VJIRZNMVCUFPK9AHUVMVGOSIWSWIWRWPNVXZ9999UZBMW9VKUHJFZKOJAGLEUBKHO9JHUXTHPVVINMHJQOXESCBJYJETNLXEJNUSMVEISIOJVHLFSGRHA9999999999999999999999999999999OOVI9EOOF999999999K99999999RY99999999XEJ99999999999999",
                "999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999DYNCIYFOWIXWR9R99JSWSOEQBAXZPUOWUBVBWMA9BIZRJDWGYLOPCNUSOMQTWEYLFDFSRNCKXF9RNZFNCAJA9999999999999999999999999999999999999999999999999999KPWAAD99999999999E99999999AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUZBMW9VKUHJFZKOJAGLEUBKHO9JHUXTHPVVINMHJQOXESCBJYJETNLXEJNUSMVEISIOJVHLFSGRHA9999RGJUFWSOBWHLAOZKOTWBJJSIFSKHPAEHURVCNGQODASYJHDCTBWYTNCFHRMIL9M9SKQCUNOG9LKV99999999999999999999999999999999PDTI9EOOF999999999K99999999FY99999999XIWA9999999999999",
        };
        List<TransactionViewModel> transactions = persistAndMapTxs(trytes);
        try {
            BundleValidator.Validity validity = BundleValidator.validate(tangle, transactions.get(0).getHash(),
                    BundleValidator.MODE_VALIDATE_SIGNATURES |
                            BundleValidator.MODE_SKIP_TAIL_TX_EXISTENCE |
                            BundleValidator.MODE_SKIP_CACHED_VALIDITY, new LinkedList<>());
            assertEquals("the bundle should be valid", BundleValidator.Validity.VALID, validity);
        } catch (Exception e) {
            e.printStackTrace();
        }
    }

    @Test
    public void validationModeSignaturesWithInvalidSignatures() {
        // semantics are wrong (indices) and the signature of the first input transaction is empty (2nd in list)
        String[] trytes = {
                "999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999SD99999999999999999999999999B9999999999999999999999999MPMVAAD99D99999999E99999999LGBWXNJENUHBKLSFZIJVPHSKTIZBDYJCJBWBRWCB9EKZJFTQ9YDHSFSVJJZGJHRLLHEGBKQAXFIDEQOHAAAFFHDLDEYEETSCXIVUFPKFJOPT9PPLOPINUXVTLSBBMOPIALLIMCIN9LMBUYPUZSTYANNWMUUKQZ9999FWTQPWNXKSUOIJOYNGHKQBSKVCPKZCBLPWRRZBVFAAOHJBCQOLSQIFHDNONESCGWMSAQYLNDAJCDA9999999999999999999999999999999WNECVEOOF999999999K99999999BFB9999999RRF99999999999999",
                "999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999NLBKWQUWPCURAVNHPQQTGSSQEAZCQNDCTP9DFOPWKQ9MYHBVDRVSCOJQQKUFPYOSA9DLDCZMNEKBXUAAAZGECY9999999999999999999999999999999999999999999999999MPMVAAD99A99999999E99999999LGBWXNJENUHBKLSFZIJVPHSKTIZBDYJCJBWBRWCB9EKZJFTQ9YDHSFSVJJZGJHRLLHEGBKQAXFIDEQOHATRVUFKZTPCZZNRQFGGXOKIMIIRSMMOMWD9GLJNEAKBXAPFAJKSXESFCFSDVVUIZSRGVXDVFNATVSA9999FWTQPWNXKSUOIJOYNGHKQBSKVCPKZCBLPWRRZBVFAAOHJBCQOLSQIFHDNONESCGWMSAQYLNDAJCDA9999999999999999999999999999999KWDCVEOOF999999999K99999999HB99999999IUM99999999999999",
                "LHIWJUOVFJUGZVYLTCPXJKBSUOJROOGGMCDFKUFFGAKFMSPDBY9MJD9RKJOLDBECTGFARUFGZHUTIBILWZA9XHK9REMDHQQROSQMHPBIECMAAZKNAGRLDSWYCPVHKYRUIXUYLTJYRHJWR9CEMSIBPIPBOIJTGZEKYAXMKRVYWMLVHVITZKFJAHMSYZKCPUFPQOOULABXOLVCHOZUUMIBVP99UGPAYEJPOBKH9BSVBKZMO9DHZRCTOUJFBWEKJBUSIRQFLAVCVJWULFQJD9BIVRHBTCKYPATWQECFZGWJCHDNZDTUQV9BTAUSWG9OX9QYTVAZSD9XMSZDBUOHQYFAVFIHMYDHKBTAADOLZXHPU9A9EMKLGHJEOOPLXRHFTEE9PICXDUPIHPUZUJAHGAXWWBE9ANSVPPOAMSORQXXKERD9TKRHGANIFGOZXMYBSGHJWLBXQSBAQCKNBAPIDKSRCCWMNSCYOQBEKKZUZCWDPGDGAPWTLUOSDVUXDXJROSYDKEGGNKBMZ9KCGQPMEH9TUFGLSGOFZTA9NTEMHHRJCAKTUJELQMCTZIAM9QEZVDQNQWNCUJGG9ZBQXEVACXMVLUQKRPNIXGMHDPTCVOPYMXGF9TKREFWLEAEOERUUVSFRSODFRYPWFXXHWGRNHCS9FNREUERCKWLPYWUHZECNCXPCUFACBWKREAQYHPSMHQEINTVKBFCJ9RXLIERAXDZNVDJW9EMMVKPYYOFLKSANNMEB9KDBT9XYTWNEQJSXGMFTRGSHZVWHODHFHY9UJSEAAIGVDQORTQFHKQMMUKBZNYWU9UCKLDTTGIKCVC9BRUJNPMYWSGUCFIOTGXCFJFQCYUXHNDOFNWMAOS9RGVSMWHCMNLPQLKYGHTYDUPX9JMNYNKKDXAWYL9U9ZLKBZQ9UTD9XZWOWNLRCTAMRMHZIBOWPZPYXRMOPESEFSIMZBTGGT9THAOAGGBAXBPACVEFNK9RXCOPXKSXIGLYSCQGIPYEATHJIWUFGCEQGNGRWYWVXBBSSJRWCI99UKUMNNLRWUM9EGX9SYGHJSCAULFAWZJPVLCMRXNUXAUTLNIUJEIPXYZTFNGDRMBXGIHPQWNFL9KTGCKEOT9MDJHMQUOLSQNGULDDVS9OMGFEBDTROBXSXVHLFCEFPIMCAJAEJATDJJMKBIJLWGAQGDWFGQCN9MCGBGKAGDZLDIILLRQVHJLABQMSWBOFJIUQEDXCLIIGBNBHFSUQBAHEKQNBJCJDEZOBANUYHUJT9SJSVNFQIRAITRCLOLRUP9BCRHDKYMNWGMKVRMHAWWDEZVBHSTVLWDLTGCTCLKLJ9APIFGYTCHK9KSVHAYT9ZNVPSULJZKHOA9FJEDKKPDW9JYQ9XHSHKDEJREQLHMVLPGGPAZJKQNCPWVPAIIJKYGILRUBCPQKLRMXOGXHRTFXXHOTHCTVVAJYWGUBZZKXMDEMOJZTHZFNMCXZBVEBFMOTHMVPWMETPFNXYBZLCNHVH99QMAICKRFJQXPHRCVQIIFYIU9HVBCINDTXWBKDWTWMRC9DCHYVFLHBKMDEFXFZSZNIEY99HIAXLEX9CHSZWBRTLBXJSGOQICJR9WWJQTVARZL9SD9TMDOEOS9BCRKVDWWNLUYQSZAVMSBF9YBRXTVFDKFBWNEKIZBHBAHLQZFSLBFSRVOVTVXZVTEEIKVEK9FUUSWNBDHXQTHCWTIBJWPABPRCKRKLLKRHOGMQWV9YZDTMUXBZSSMZDAZ9ZCHJPLXAMELFOFFROPRS9PSK9DVBD9HJJFFBADYU9RHAODMEBLS9LHKYBGORHZJLFOJNVFAGABNLAOQYVRDJKJCXYYUSPJKSQNTXIBKV9DGBWAD9YTTRPDMDSDOHLEBVEXIWKYKQCLMJTCOBVPNVIK9NKKQAPPKOPVCZYHWIOUQGN9HIXOHCZCAIRSYKDBNLKPFEZTQLQRXLCVCCDJDKRPYCL9CGGUZKITJDHZJJKMOIOOFSODMQHAUZPKCVJZKHWQYRUSBXAV9LAQ9NAOWQQLBAVUBJH9OJYODENPOHAZ9C9RTQZHVJLVUMJQFCKGWLKEMBBIJQSBKVGZYBFQPGGAULBTCLLZTXSZJZGSM9NKWRWBQAFKB9BJZ9AHKBNWJAOPOWDQFQZACZZFLJGXARXUOQPRUCNWYPWCHVKUBGDTTXUEBE9NLBKWQUWPCURAVNHPQQTGSSQEAZCQNDCTP9DFOPWKQ9MYHBVDRVSCOJQQKUFPYOSA9DLDCZMNEKBXUAAA999999999999999999999999999999999999999999999999999999MPMVAAD99B99999999E99999999LGBWXNJENUHBKLSFZIJVPHSKTIZBDYJCJBWBRWCB9EKZJFTQ9YDHSFSVJJZGJHRLLHEGBKQAXFIDEQOHAKDQIVTYRRHJBZVNLZTVDAVAZHJXQZNQJFFURMVTVROWXGPVFFZJBORUCEVDIULTVNBDFWQ9KGNENZ9999FWTQPWNXKSUOIJOYNGHKQBSKVCPKZCBLPWRRZBVFAAOHJBCQOLSQIFHDNONESCGWMSAQYLNDAJCDA9999999999999999999999999999999TUDCVEOOF999999999K99999999GLA9999999CUB99999999999999",
                "999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999CFGBOBZKGLIINF9VYQNDOCLIFFXYRZVY9RFFYQTOJNCZTANHAWCCCDDATWUUNXSBEIEIVUHLYIRGFNIMCAJA999999999999999999999999999999999999999999999999999MPMVAAD99999999999E99999999LGBWXNJENUHBKLSFZIJVPHSKTIZBDYJCJBWBRWCB9EKZJFTQ9YDHSFSVJJZGJHRLLHEGBKQAXFIDEQOHAFWTQPWNXKSUOIJOYNGHKQBSKVCPKZCBLPWRRZBVFAAOHJBCQOLSQIFHDNONESCGWMSAQYLNDAJCDA9999UPFHBXMOACPLIUIQOTGEOQVAKIPGCBHDBPZTACDDCIIPBJWTRKEEKVXI9DKKHZQJOFLQEWMFTQRQZ9999999999999999999999999999999E9CCVEOOF999999999K99999999CAB9999999LMM99999999999999",
        };
        List<TransactionViewModel> transactions = persistAndMapTxs(trytes);
        try {
            BundleValidator.Validity validity = BundleValidator.validate(tangle, transactions.get(0).getHash(),
                    BundleValidator.MODE_VALIDATE_SIGNATURES |
                            BundleValidator.MODE_SKIP_TAIL_TX_EXISTENCE |
                            BundleValidator.MODE_SKIP_CACHED_VALIDITY, new LinkedList<>());
            assertEquals("the bundle should be invalid", BundleValidator.Validity.INVALID, validity);
        } catch (Exception e) {
            e.printStackTrace();
        }
    }
}
